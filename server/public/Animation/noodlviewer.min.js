!function(){function a(a,b,c){return a.call.apply(a.bind,arguments)}function b(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function c(d,e,f){return c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:b,c.apply(null,arguments)}function d(a,b){this.D=a,this.m=b||a,this.F=this.m.document}function e(a,b,c){a=a.F.getElementsByTagName(b)[0],a||(a=document.documentElement),a.insertBefore(c,a.lastChild)}function f(a,b,c){b=b||[],c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}for(b=[],e=0;e<d.length;e+=1){for(f=!1,g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function g(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;e>d;d++)if(c[d]==b)return!0;return!1}function h(a){if("string"==typeof a.da)return a.da;var b=a.m.location.protocol;return"about:"==b&&(b=a.D.location.protocol),"https:"==b?"https:":"http:"}function i(a,b){var c=a.createElement("link",{rel:"stylesheet",href:b,media:"all"}),d=!1;c.onload=function(){d||(d=!0)},c.onerror=function(){d||(d=!0)},e(a,"head",c)}function j(a,b,c,d){var e=a.F.getElementsByTagName("head")[0];if(e){var f=a.createElement("script",{src:b}),g=!1;return f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,c&&c(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f))},e.appendChild(f),setTimeout(function(){g||(g=!0,c&&c(Error("Script load timeout")))},d||5e3),f}return null}function k(a){this.ca=a||"-"}function l(a,b){this.V=a,this.N=4,this.H="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.H=c[1],this.N=parseInt(c[2],10))}function m(a){return a.H+a.N}function n(a){var b=4,c="n",d=null;return a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10)))),c+b}function o(a,b){this.a=a,this.h=a.m.document.documentElement,this.J=b,this.f="wf",this.e=new k("-"),this.Z=!1!==b.events,this.u=!1!==b.classes}function p(a){a.u&&f(a.h,[a.e.d(a.f,"loading")]),r(a,"loading")}function q(a){if(a.u){var b=g(a.h,a.e.d(a.f,"active")),c=[],d=[a.e.d(a.f,"loading")];b||c.push(a.e.d(a.f,"inactive")),f(a.h,c,d)}r(a,"inactive")}function r(a,b,c){a.Z&&a.J[b]&&(c?a.J[b](c.getName(),m(c)):a.J[b]())}function s(){this.t={}}function t(a,b,c){var d,e=[];for(d in b)if(b.hasOwnProperty(d)){var f=a.t[d];f&&e.push(f(b[d],c))}return e}function u(a,b){this.a=a,this.q=b,this.j=this.a.createElement("span",{"aria-hidden":"true"},this.q)}function v(a,b){var c,d=a.j;c=[];for(var e=b.V.split(/,\s*/),f=0;f<e.length;f++){var g=e[f].replace(/['"]/g,"");-1==g.indexOf(" ")?c.push(g):c.push("'"+g+"'")}c=c.join(","),e="normal","o"===b.H?e="oblique":"i"===b.H&&(e="italic"),d.style.cssText="display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+c+";"+("font-style:"+e+";font-weight:"+(b.N+"00")+";")}function w(a){e(a.a,"body",a.j)}function x(a,b,c,d,e,f,g){this.O=a,this.ba=b,this.a=c,this.g=d,this.q=g||"BESbswy",this.s={},this.M=e||3e3,this.T=f||null,this.C=this.B=this.w=this.v=null,this.v=new u(this.a,this.q),this.w=new u(this.a,this.q),this.B=new u(this.a,this.q),this.C=new u(this.a,this.q),v(this.v,new l(this.g.getName()+",serif",m(this.g))),v(this.w,new l(this.g.getName()+",sans-serif",m(this.g))),v(this.B,new l("serif",m(this.g))),v(this.C,new l("sans-serif",m(this.g))),w(this.v),w(this.w),w(this.B),w(this.C)}function y(){if(null===R){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);R=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return R}function z(a,b,c){for(var d in Q)if(Q.hasOwnProperty(d)&&b===a.s[Q[d]]&&c===a.s[Q[d]])return!0;return!1}function A(a){var b,c=a.v.j.offsetWidth,d=a.w.j.offsetWidth;(b=c===a.s.serif&&d===a.s["sans-serif"])||(b=y()&&z(a,c,d)),b?P()-a.ea>=a.M?y()&&z(a,c,d)&&(null===a.T||a.T.hasOwnProperty(a.g.getName()))?C(a,a.O):C(a,a.ba):B(a):C(a,a.O)}function B(a){setTimeout(c(function(){A(this)},a),50)}function C(a,b){setTimeout(c(function(){this.v.remove(),this.w.remove(),this.B.remove(),this.C.remove(),b(this.g)},a),0)}function D(a,b,c){this.a=a,this.o=b,this.K=0,this.X=this.S=!1,this.M=c}function E(a){0==--a.K&&a.S&&(a.X?(a=a.o,a.u&&f(a.h,[a.e.d(a.f,"active")],[a.e.d(a.f,"loading"),a.e.d(a.f,"inactive")]),r(a,"active")):q(a.o))}function F(a){this.D=a,this.p=new s,this.U=0,this.P=this.Q=!0}function G(a,b,d,e,g){var h=0==--a.U;(a.P||a.Q)&&setTimeout(function(){var a=g||null,i=e||null||{};if(0===d.length&&h)q(b.o);else{b.K+=d.length,h&&(b.S=h);var j,k=[];for(j=0;j<d.length;j++){var l=d[j],n=i[l.getName()],o=b.o,p=l;o.u&&f(o.h,[o.e.d(o.f,p.getName(),m(p).toString(),"loading")]),r(o,"fontloading",p),o=null,o=new x(c(b.$,b),c(b.aa,b),b.a,l,b.M,a,n),k.push(o)}for(j=0;j<k.length;j++)k[j].start()}},0)}function H(a,b,c){var d=[],e=c.timeout;p(b);var d=t(a.p,c,a.a),f=new D(a.a,b,e);for(a.U=d.length,b=0,c=d.length;c>b;b++)d[b].load(function(b,c,d){G(a,f,b,c,d)})}function I(a,b,c){this.I=a?a:b+S,this.k=[],this.L=[],this.Y=c||""}function J(a){this.k=a,this.W=[],this.G={}}function K(a,b){this.a=a,this.c=b}function L(a,b){this.a=a,this.c=b,this.R=[]}function M(a,b){this.a=a,this.c=b}function N(a,b){this.a=a,this.c=b}function O(a,b){this.a=a,this.c=b}var P=Date.now||function(){return+new Date};d.prototype.createElement=function(a,b,c){if(a=this.F.createElement(a),b)for(var d in b)b.hasOwnProperty(d)&&("style"==d?a.style.cssText=b[d]:a.setAttribute(d,b[d]));return c&&a.appendChild(this.F.createTextNode(c)),a},k.prototype.d=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.ca)},l.prototype.getName=function(){return this.V},u.prototype.remove=function(){var a=this.j;a.parentNode&&a.parentNode.removeChild(a)};var Q={ga:"serif",fa:"sans-serif"},R=null;x.prototype.start=function(){this.s.serif=this.B.j.offsetWidth,this.s["sans-serif"]=this.C.j.offsetWidth,this.ea=P(),A(this)},D.prototype.$=function(a){var b=this.o;b.u&&f(b.h,[b.e.d(b.f,a.getName(),m(a).toString(),"active")],[b.e.d(b.f,a.getName(),m(a).toString(),"loading"),b.e.d(b.f,a.getName(),m(a).toString(),"inactive")]),r(b,"fontactive",a),this.X=!0,E(this)},D.prototype.aa=function(a){var b=this.o;if(b.u){var c=g(b.h,b.e.d(b.f,a.getName(),m(a).toString(),"active")),d=[],e=[b.e.d(b.f,a.getName(),m(a).toString(),"loading")];c||d.push(b.e.d(b.f,a.getName(),m(a).toString(),"inactive")),f(b.h,d,e)}r(b,"fontinactive",a),E(this)},F.prototype.load=function(a){this.a=new d(this.D,a.context||this.D),this.Q=!1!==a.events,this.P=!1!==a.classes,H(this,new o(this.a,a),a)};var S="//fonts.googleapis.com/css";I.prototype.d=function(){if(0==this.k.length)throw Error("No fonts to load!");if(-1!=this.I.indexOf("kit="))return this.I;for(var a=this.k.length,b=[],c=0;a>c;c++)b.push(this.k[c].replace(/ /g,"+"));return a=this.I+"?family="+b.join("%7C"),0<this.L.length&&(a+="&subset="+this.L.join(",")),0<this.Y.length&&(a+="&text="+encodeURIComponent(this.Y)),a};var T={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},U={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},V={i:"i",italic:"i",n:"n",normal:"n"},W=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;J.prototype.parse=function(){for(var a=this.k.length,b=0;a>b;b++){var c=this.k[b].split(":"),d=c[0].replace(/\+/g," "),e=["n4"];if(2<=c.length){var f,g=c[1];if(f=[],g)for(var g=g.split(","),h=g.length,i=0;h>i;i++){var j;if(j=g[i],j.match(/^[\w-]+$/))if(j=W.exec(j.toLowerCase()),null==j)j="";else{var k;if(k=j[1],null==k||""==k)k="4";else{var m=U[k];k=m?m:isNaN(k)?"4":k.substr(0,1)}j=j[2],j=[null==j||""==j?"n":V[j],k].join("")}else j="";j&&f.push(j)}0<f.length&&(e=f),3==c.length&&(c=c[2],f=[],c=c?c.split(","):f,0<c.length&&(c=T[c[0]])&&(this.G[d]=c))}for(this.G[d]||(c=T[d])&&(this.G[d]=c),c=0;c<e.length;c+=1)this.W.push(new l(d,e[c]))}};var X={Arimo:!0,Cousine:!0,Tinos:!0};K.prototype.load=function(a){for(var b=this.a,c=new I(this.c.api,h(b),this.c.text),d=this.c.families,e=d.length,f=0;e>f;f++){var g=d[f].split(":");3==g.length&&c.L.push(g.pop());var j="";2==g.length&&""!=g[1]&&(j=":"),c.k.push(g.join(j))}d=new J(d),d.parse(),i(b,c.d()),a(d.W,d.G,X)},L.prototype.A=function(a){var b=this.a;return h(this.a)+(this.c.api||"//f.fontdeck.com/s/css/js/")+(b.m.location.hostname||b.D.location.hostname)+"/"+a+".js"},L.prototype.load=function(a){var b=this.c.id,c=this.a.m,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var e=0,f=c.fonts.length;f>e;++e){var g=c.fonts[e];d.R.push(new l(g.name,n("font-weight:"+g.weight+";font-style:"+g.style)))}a(d.R)},j(this.a,this.A(b),function(b){b&&a([])})):a([])},M.prototype.A=function(a){return(this.c.api||"https://use.typekit.net")+"/"+a+".js"},M.prototype.load=function(a){var b=this.c.id,c=this.a.m;b?j(this.a,this.A(b),function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var d=[],e=0;e<b.length;e+=2)for(var f=b[e],g=b[e+1],h=0;h<g.length;h++)d.push(new l(f,g[h]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(i){}a(d)}},2e3):a([])},N.prototype.A=function(a,b){var c=h(this.a),d=(this.c.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+d+"/"+a+".js"+(b?"?v="+b:"")},N.prototype.load=function(a){var b=this.c.projectId,c=this.c.version;if(b){var d=this.a.m;j(this.a,this.A(b,c),function(c){if(c)a([]);else if(d["__mti_fntLst"+b]){c=d["__mti_fntLst"+b]();var e=[];if(c)for(var f=0;f<c.length;f++)e.push(new l(c[f].fontfamily));a(e)}else a([])}).id="__MonotypeAPIScript__"+b}else a([])},O.prototype.load=function(a){var b,c,d=this.c.urls||[],e=this.c.families||[],f=this.c.testStrings||{};for(b=0,c=d.length;c>b;b++)i(this.a,d[b]);for(d=[],b=0,c=e.length;c>b;b++){var g=e[b].split(":");if(g[1])for(var h=g[1].split(","),j=0;j<h.length;j+=1)d.push(new l(g[0],h[j]));else d.push(new l(g[0]))}a(d,f)};var Y=new F(window);Y.p.t.custom=function(a,b){return new O(b,a)},Y.p.t.fontdeck=function(a,b){return new L(b,a)},Y.p.t.monotype=function(a,b){return new N(b,a)},Y.p.t.typekit=function(a,b){return new M(b,a)},Y.p.t.google=function(a,b){return new K(b,a)};var Z={load:c(Y.load,Y)};"function"==typeof define&&define.amd?define(function(){return Z}):"undefined"!=typeof module&&module.exports?module.exports=Z:(window.WebFont=Z,window.WebFontConfig&&Y.load(window.WebFontConfig))}(),function(a){"use strict";var b={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(b.exports={},define(function(){return b.exports})):b.exports=a:b.exports=exports,function(a){if(!b)var b=1e-6;if(!c)var c="undefined"!=typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var e={};e.setMatrixArrayType=function(a){c=a},"undefined"!=typeof a&&(a.glMatrix=e);var f={};f.create=function(){var a=new c(2);return a[0]=0,a[1]=0,a},f.clone=function(a){var b=new c(2);return b[0]=a[0],b[1]=a[1],b},f.fromValues=function(a,b){var d=new c(2);return d[0]=a,d[1]=b,d},f.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},f.set=function(a,b,c){return a[0]=b,a[1]=c,a},f.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},f.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},f.sub=f.subtract,f.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},f.mul=f.multiply,f.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},f.div=f.divide,f.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},f.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},f.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},f.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},f.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},f.dist=f.distance,f.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},f.sqrDist=f.squaredDistance,f.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},f.len=f.length,f.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},f.sqrLen=f.squaredLength,f.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},f.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},f.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},f.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},f.random=function(a,b){b=b||1;var c=2*d()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},f.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},f.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},f.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},f.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},f.forEach=function(){var a=f.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),f.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof a&&(a.vec2=f);var g={};g.create=function(){var a=new c(3);return a[0]=0,a[1]=0,a[2]=0,a},g.clone=function(a){var b=new c(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},g.fromValues=function(a,b,d){var e=new c(3);return e[0]=a,e[1]=b,e[2]=d,e},g.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},g.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},g.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},g.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},g.sub=g.subtract,g.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},g.mul=g.multiply,g.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},g.div=g.divide,g.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},g.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},g.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},g.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},g.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},g.dist=g.distance,g.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},g.sqrDist=g.squaredDistance,g.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},g.len=g.length,g.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},g.sqrLen=g.squaredLength,g.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},g.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},g.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},g.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},g.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},g.random=function(a,b){b=b||1;var c=2*d()*Math.PI,e=2*d()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},g.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12],a[1]=c[1]*d+c[5]*e+c[9]*f+c[13],a[2]=c[2]*d+c[6]*e+c[10]*f+c[14],a},g.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},g.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},g.forEach=function(){var a=g.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),g.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},"undefined"!=typeof a&&(a.vec3=g);var h={};h.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},h.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},h.fromValues=function(a,b,d,e){var f=new c(4);return f[0]=a,f[1]=b,f[2]=d,f[3]=e,f},h.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},h.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},h.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},h.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},h.sub=h.subtract,h.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},h.mul=h.multiply,h.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},h.div=h.divide,h.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},h.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},h.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},h.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},h.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},h.dist=h.distance,h.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},h.sqrDist=h.squaredDistance,h.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},h.len=h.length,h.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},h.sqrLen=h.squaredLength,h.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},h.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=b[0]*g,a[1]=b[1]*g,a[2]=b[2]*g,a[3]=b[3]*g),a},h.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},h.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},h.random=function(a,b){return b=b||1,a[0]=d(),a[1]=d(),a[2]=d(),a[3]=d(),h.normalize(a,a),h.scale(a,a,b),a},h.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},h.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},h.forEach=function(){var a=h.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),h.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.vec4=h);var i={};i.create=function(){var a=new c(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},i.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},i.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},i.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},i.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},i.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},i.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},i.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},i.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+e*j,a[1]=d*i+e*k,a[2]=f*h+g*j,a[3]=f*i+g*k,a},i.mul=i.multiply,i.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=d*-h+e*i,a[2]=f*i+g*h,a[3]=f*-h+g*i,a},i.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*i,a[2]=f*h,a[3]=g*i,a},i.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.mat2=i);var j={};j.create=function(){var a=new c(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},j.clone=function(a){var b=new c(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},j.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},j.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},j.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+e*l,a[1]=d*k+e*m,a[2]=f*j+g*l,a[3]=f*k+g*m,a[4]=j*h+l*i+n,a[5]=k*h+m*i+o,a},j.mul=j.multiply,j.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+e*j,a[1]=-d*j+e*k,a[2]=f*k+g*j,a[3]=-f*j+k*g,a[4]=k*h+j*i,a[5]=k*i-j*h,a},j.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=b[0]*d,a[1]=b[1]*e,a[2]=b[2]*d,a[3]=b[3]*e,a[4]=b[4]*d,a[5]=b[5]*e,a},j.translate=function(a,b,c){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4]+c[0],a[5]=b[5]+c[1],a},j.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},"undefined"!=typeof a&&(a.mat2d=j);var k={};k.create=function(){var a=new c(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},k.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},k.clone=function(a){var b=new c(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},k.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},k.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},k.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},k.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},k.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},k.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},k.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},k.mul=k.multiply,k.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},k.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},k.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},k.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},k.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[3]=k+r,a[6]=l-q,a[1]=k-r,a[4]=1-(j+o),a[7]=n+p,a[2]=l+q,a[5]=n-p,a[8]=1-(j+m),a},k.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},k.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},"undefined"!=typeof a&&(a.mat3=k);var l={};l.create=function(){var a=new c(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.clone=function(a){var b=new c(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},l.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},l.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},l.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},l.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},l.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},l.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},l.mul=l.multiply,l.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},l.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},l.rotate=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<b?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=c[0],j=c[1],k=c[2],l=c[3],m=c[4],n=c[5],o=c[6],p=c[7],q=c[8],r=c[9],s=c[10],t=c[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a)},l.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},l.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,
a},l.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},l.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},l.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[1]=k+r,a[2]=l-q,a[3]=0,a[4]=k-r,a[5]=1-(j+o),a[6]=n+p,a[7]=0,a[8]=l+q,a[9]=n-p,a[10]=1-(j+m),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},l.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},l.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},l.lookAt=function(a,c,d,e){var f,g,h,i,j,k,m,n,o,p,q=c[0],r=c[1],s=c[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];return Math.abs(q-w)<b&&Math.abs(r-x)<b&&Math.abs(s-y)<b?l.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,f=u*o-v*n,g=v*m-t*o,h=t*n-u*m,p=Math.sqrt(f*f+g*g+h*h),p?(p=1/p,f*=p,g*=p,h*=p):(f=0,g=0,h=0),i=n*h-o*g,j=o*f-m*h,k=m*g-n*f,p=Math.sqrt(i*i+j*j+k*k),p?(p=1/p,i*=p,j*=p,k*=p):(i=0,j=0,k=0),a[0]=f,a[1]=i,a[2]=m,a[3]=0,a[4]=g,a[5]=j,a[6]=n,a[7]=0,a[8]=h,a[9]=k,a[10]=o,a[11]=0,a[12]=-(f*q+g*r+h*s),a[13]=-(i*q+j*r+k*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},l.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},"undefined"!=typeof a&&(a.mat4=l);var m={};m.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},m.rotationTo=function(){var a=g.create(),b=g.fromValues(1,0,0),c=g.fromValues(0,1,0);return function(d,e,f){var h=g.dot(e,f);return-.999999>h?(g.cross(a,b,e),g.length(a)<1e-6&&g.cross(a,c,e),g.normalize(a,a),m.setAxisAngle(d,a,Math.PI),d):h>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(g.cross(a,e,f),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+h,m.normalize(d,d))}}(),m.setAxes=function(){var a=k.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=c[0],a[5]=c[1],a[8]=c[2],m.normalize(b,m.fromMat3(b,a))}}(),m.clone=h.clone,m.fromValues=h.fromValues,m.copy=h.copy,m.set=h.set,m.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},m.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},m.add=h.add,m.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},m.mul=m.multiply,m.scale=h.scale,m.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},m.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},m.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},m.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},m.dot=h.dot,m.lerp=h.lerp,m.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},m.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},m.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},m.length=h.length,m.len=m.length,m.squaredLength=h.squaredLength,m.sqrLen=m.squaredLength,m.normalize=h.normalize,m.fromMat3=function(){var a="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(b,c){var d,e=c[0]+c[4]+c[8];if(e>0)d=Math.sqrt(e+1),b[3]=.5*d,d=.5/d,b[0]=(c[7]-c[5])*d,b[1]=(c[2]-c[6])*d,b[2]=(c[3]-c[1])*d;else{var f=0;c[4]>c[0]&&(f=1),c[8]>c[3*f+f]&&(f=2);var g=a[f],h=a[g];d=Math.sqrt(c[3*f+f]-c[3*g+g]-c[3*h+h]+1),b[f]=.5*d,d=.5/d,b[3]=(c[3*h+g]-c[3*g+h])*d,b[g]=(c[3*g+f]+c[3*f+g])*d,b[h]=(c[3*h+f]+c[3*f+h])*d}return b}}(),m.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.quat=m)}(b.exports)}(this);var Torped=Torped||{};Torped.Math=Torped.Math||{},function(){"use strict";var a=[vec2.create(),vec2.create(),vec2.create(),vec2.create()],b=vec2.create(),c=vec2.create(),d=vec2.create();Torped.Math.AABB={create:function(){return{min:vec2.create(),max:vec2.create()}},set:function(a,b,c,d,e){a.min[0]=b,a.min[1]=c,a.max[0]=d,a.max[1]=e},transform:function(e,f,g){a[0][0]=f.min[0],a[0][1]=f.min[1],a[1][0]=f.min[0],a[1][1]=f.max[1],a[2][0]=f.max[0],a[2][1]=f.min[1],a[3][0]=f.max[0],a[3][1]=f.max[1],vec2.transformMat4(c,a[0],g),d[0]=c[0],d[1]=c[1];for(var h=1;4>h;++h)vec2.transformMat4(b,a[h],g),b[0]<c[0]&&(c[0]=b[0]),b[1]<c[1]&&(c[1]=b[1]),b[0]>d[0]&&(d[0]=b[0]),b[1]>d[1]&&(d[1]=b[1]);e.min[0]=c[0],e.min[1]=c[1],e.max[0]=d[0],e.max[1]=d[1]},copy:function(a,b){a.min[0]=b.min[0],a.min[1]=b.min[1],a.max[0]=b.max[0],a.max[1]=b.max[1]},intersects:function(a,b){return a.min[0]>=b.max[0]||a.max[0]<=b.min[0]||a.min[1]>=b.max[1]||a.max[1]<=b.min[1]?!1:!0},union:function(a,b){b.min[0]<a.min[0]&&(a.min[0]=b.min[0]),b.min[1]<a.min[1]&&(a.min[1]=b.min[1]),b.max[0]>a.max[0]&&(a.max[0]=b.max[0]),b.max[1]>a.max[1]&&(a.max[1]=b.max[1])},width:function(a){return a.max[0]-a.min[0]},height:function(a){return a.max[1]-a.min[1]},isPointInside:function(a,b){return b[0]>=a.min[0]&&b[0]<=a.max[0]&&b[1]>=a.min[1]&&b[1]<=a.max[1]},intersection:function(a,b,c){a.min[0]=Math.max(b.min[0],c.min[0]),a.min[1]=Math.max(b.min[1],c.min[1]),a.max[0]=Math.min(b.max[0],c.max[0]),a.max[1]=Math.min(b.max[1],c.max[1])}}}();var Torped=Torped||{};Torped.Color=Torped.Color||{},function(){"use strict";Torped.Color.setArray=function(a,b){var c,d=!1;if("string"==typeof b){var e=0;for("#"===b[0]&&(e=1),c=0;3>c;++c){var f=parseInt(b.substring(e+2*c,e+2*c+2),16)/255;a[c]!==f&&(a[c]=f,d=!0)}}else for(c=0;3>c;++c)a[c]!==b[c]&&(a[c]=b[c],d=!0);return d}}();var Torped=Torped||{};Torped.Math=Torped.Math||{},function(){"use strict";Torped.Math.clamp=function(a,b,c){return a>c?a:c>b?b:c},Torped.Math.isMatrixScaled=function(a){return 1!==a[0]||1!==a[5]||1!==a[10]},Torped.Math.isMatrixRotated=function(a){return 0!==a[1]||0!==a[2]||0!==a[4]||0!==a[6]||0!==a[8]||0!==a[9]},Torped.Math.transformBox=function(a,b,c,d,e,f,g){a[0]=0,a[1]=0,a[2]=0,b[0]=e,b[1]=0,b[2]=0,c[0]=0,c[1]=f,c[2]=0,d[0]=e,d[1]=f,d[2]=0,vec3.transformMat4(a,a,g),vec3.transformMat4(b,b,g),vec3.transformMat4(c,c,g),vec3.transformMat4(d,d,g)}}();var Torped=Torped||{};!function(){"use strict";Torped.FBO=function(a,b){this.texture=b.texture;var c,d,e=a.getParameter(a.FRAMEBUFFER_BINDING),f=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,f),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture.handle,0),d=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,d),a.renderbufferStorage(a.RENDERBUFFER,a.STENCIL_INDEX8,b.width,b.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,d),b.depthBuffer&&(c=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,c),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,b.width,b.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,c));var g=a.checkFramebufferStatus(a.FRAMEBUFFER);switch(g){case a.FRAMEBUFFER_COMPLETE:break;case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.log("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.log("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.log("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case a.FRAMEBUFFER_UNSUPPORTED:console.log("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:console.log("Incomplete framebuffer: "+g)}a.bindFramebuffer(a.FRAMEBUFFER,e),this.fbo=f,this.gl=a,this.width=b.width,this.height=b.height}}();var Torped=Torped||{};!function(){"use strict";Torped.Mesh=function(a,b){b=b||{},void 0===b.vertices&&(b.vertices=new Float32Array(0)),b.vertices instanceof Float32Array==!1&&console.error("Vertices must be of type Float32Array"),b.indices&&b.indices instanceof Uint16Array==!1&&console.error("Indices must be of type Uint16Array"),this.gl=a,this.vertexBuffer=a.createBuffer(),this.vertices=b.vertices,this.indexBuffer=null,this.indices=b.indices,b.primitiveType===Torped.Mesh.PrimitiveType.Triangles?this.primitiveType=a.TRIANGLES:b.primitiveType===Torped.Mesh.PrimitiveType.Lines?this.primitiveType=a.LINES:b.primitiveType===Torped.Mesh.PrimitiveType.LineStrip?this.primitiveType=a.LINE_STRIP:b.primitiveType===Torped.Mesh.PrimitiveType.TriangleFan?this.primitiveType=a.TRIANGLE_FAN:this.primitiveType=a.TRIANGLE_STRIP,this.vertexDataDirty=!0},Torped.Mesh.prototype.bind=function(a,b){var c=this.gl;this.numComponentsPerVertex=b,c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);var d,e=0;for(d=c.numVertexAttribsEnabled;d<a.length;++d)c.enableVertexAttribArray(d);for(d=a.length;d<c.numVertexAttribsEnabled;++d)c.disableVertexAttribArray(d);for(c.numVertexAttribsEnabled=a.length,d=0;d<a.length;++d){var f=a[d];c.vertexAttribPointer(d,f.numComponents,c.FLOAT,!1,4*b,4*e),e+=f.numComponents}null===this.indexBuffer&&this.indices&&this.indices.length>0&&(this.indexBuffer=c.createBuffer()),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer)},Torped.Mesh.prototype.syncVertexData=function(){var a=this.gl;this.vertexDataDirty&&(this.indices&&this.indices.length>0&&a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.STREAM_DRAW),this.vertexDataDirty=!1)},Torped.Mesh.prototype.draw=function(){this.syncVertexData();var a=this.gl,b=0;this.indexBuffer?a.drawElements(this.primitiveType,this.indices.length,a.UNSIGNED_SHORT,0):(b=this.vertices.length/this.numComponentsPerVertex,a.drawArrays(this.primitiveType,0,b))},Torped.Mesh.prototype.drawVertexRange=function(a,b){this.syncVertexData();var c=this.gl;this.indexBuffer?c.drawElements(this.primitiveType,b,c.UNSIGNED_SHORT,2*a):c.drawArrays(this.primitiveType,a,b)},Torped.Mesh.PrimitiveType={TriangleStrip:0,Triangles:1,Lines:2,LineStrip:3,TriangleFan:4}}();var Torped=Torped||{};!function(){"use strict";function a(a,b){var c=new window.XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState&&200===c.status)b(c.responseText);else if(404===c.status)throw new Error("Failed to read shader file: "+a)},c.open("GET",a,!0),c.send()}function b(a,b,d){var e=c(d,"vertex"),f=c(d,"fragment"),g=b.file;b.file=void 0,b.vertexSource=e,b.fragmentSource=f;var h=a.createShader(b);void 0!==b.onCreated&&b.onCreated(h,g)}function c(a,b){function c(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=a.length);for(var e=0,f=a.indexOf(b,c);-1!=f&&d>f;)e++,f=a.indexOf(b,f+1);return e}function d(a,b){for(var c="",d=0;b>d;d++)c+=a;return c}var e,f,g="(^|\\n)\\s*\\["+b+"\\]((\\n|.)*?)(\\n\\s*\\[|$)",h=new RegExp(g);if(e=h.exec(a),null!==e){var i=e[2],j=a.indexOf(i),k=c(a,"\n",0,j),l=c(a,"\n",j+i.length);f=d("\n",k),f+=i,f+=d("\n",l)}return f}Torped.Renderer=function(a,b,c){this.gl=a,this.gl.numVertexAttribsEnabled=0,this.textureCache=new Torped.TextureCache(a),this.screenCameraProjection=mat4.create(),this.screenCameraView=mat4.create(),this.fieldOfView=25,this._whiteTexture=null,this.currentBlendMode=Torped.Renderer.BlendMode.Solid,this.currentRenderTarget=0,this.currentShader=0,this.currentUniformValues=null,this.currentViewMatrix=this.screenCameraView,this.currentProjectionMatrix=this.screenCameraProjection,this.currentDepthTestState=!1,this.currentScissorTestState=!1,this.currentStencilTestState=!1,this.currentBoundMesh=null,this.maskRenderingEnabled=!1,this.currentViewport={width:0,height:0},a.disable(a.CULL_FACE),a.clearColor(0,0,0,0),a.stencilMask(255),a.clearStencil(128),this.supportsEGLImageExternal=a.TEXTURE_EXTERNAL_OES?!0:!1,this.cameraMatricesDirty=!0,this.activeTexture=0,this.setVirtualSize(b,c),this.resourceDirectory="",this._defaultVsSource=["uniform mat4 u_projection;","uniform mat4 u_view;","attribute vec3 a_position;","attribute vec2 a_uv;","attribute vec4 a_color;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","   gl_Position = u_projection * u_view * vec4(a_position, 1.0);","   uv = a_uv;","   color = a_color;","}"].join("\n"),this._defaultFsSource=["uniform sampler2D texture;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","    gl_FragColor = texture2D(texture, uv)*color;","}"].join("\n"),this._videoFsSource=["#extension GL_OES_EGL_image_external : require","uniform samplerExternalOES texture;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","    gl_FragColor = texture2D(texture, uv)*color;","}"].join("\n"),this._imageMaskFsSource=["uniform sampler2D texture;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","    lowp vec4 tex = texture2D(texture, uv);","    if (tex.a < 0.5) {","       discard;","    }","    else {","       gl_FragColor = vec4(vec3(tex.a), 1.);","    }","}"].join("\n")},Torped.Renderer.prototype.setVirtualSize=function(a,b){this.virtualWidth=a,this.virtualHeight=b,this.calculateCamera(this.screenCameraView,this.screenCameraProjection,this.virtualWidth,this.virtualHeight)},Torped.Renderer.prototype.setRenderBufferSize=function(a,b){this.renderWidth=a,this.renderHeight=b,this.gl.viewport(0,0,a,b),this.currentViewport.width=a,this.currentViewport.height=b},Torped.Renderer.prototype.createShader=function(a){return void 0===a.vertexSource&&(a.vertexSource=this._defaultVsSource),void 0===a.fragmentSource&&(a.fragmentSource=this._defaultFsSource),new Torped.Shader(this.gl,a)},Torped.Renderer.prototype.createShaderFromFile=function(c){if(void 0===c.file)throw new Error("createShaderFromFile: no file specified");a(c.file,b.bind(null,this,c))},Torped.Renderer.prototype.createMesh=function(a){return new Torped.Mesh(this.gl,a)},Torped.Renderer.prototype.createTexture=function(a){a.resourceDirectory=this.resourceDirectory;var b;return b=a.path&&Array.isArray(a.path)===!1?this.textureCache.createTexture(a):new Torped.Texture(this.gl,a)},Torped.Renderer.prototype.createFBO=function(a){return a.texture=new Torped.Texture(this.gl,{width:a.width,height:a.height}),new Torped.FBO(this.gl,a)},Torped.Renderer.prototype.calculateCamera=function(a,b,c,d){var e=this.fieldOfView*Math.PI/180,f=.5*d/Math.tan(.5*e);mat4.perspective(b,e,c/d,.05*f,5*f),mat4.identity(a);var g=[.5*-c,.5*d,-f];mat4.translate(a,a,g),a[5]=-1,this.cameraMatricesDirty=!0},Torped.Renderer.prototype.bindScreen=function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.renderWidth,this.renderHeight),this.currentViewport.width=this.renderWidth,this.currentViewport.height=this.renderHeight},Torped.Renderer.prototype.setBlendMode=function(a){if(a!==this.currentBlendMode){var b=this.gl;this.currentBlendMode=a,this.currentBlendMode===Torped.Renderer.BlendMode.Alpha?(b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA),b.enable(b.BLEND)):this.currentBlendMode===Torped.Renderer.BlendMode.Additive?(b.blendFunc(b.ONE,b.ONE),b.enable(b.BLEND)):this.currentBlendMode===Torped.Renderer.BlendMode.Solid?b.disable(b.BLEND):this.currentBlendMode===Torped.Renderer.BlendMode.Multiply&&(b.blendFunc(b.DST_COLOR,b.ONE_MINUS_SRC_ALPHA),b.enable(b.BLEND))}},Torped.Renderer.prototype.setDepthTest=function(a){if(a!==this.currentDepthTestState){var b=this.gl;a?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),this.currentDepthTestState=a}},Torped.Renderer.prototype.setStencilTest=function(a){if(a!==this.currentStencilTestState){var b=this.gl;a?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST),this.currentStencilTestState=a}},Torped.Renderer.prototype.setScissorTest=function(a,b){var c=this.gl;if(this.currentScissorTestState!==a&&(a?c.enable(c.SCISSOR_TEST):c.disable(c.SCISSOR_TEST),this.currentScissorTestState=a),a){var d=this.currentViewport.width/this.virtualWidth,e=this.currentViewport.height/this.virtualHeight,f=0!==this.currentRenderTarget;f&&(d=1,e=1);var g=Math.ceil(b[0]*d),h=Math.ceil(this.currentViewport.height-b[3]*e),i=Math.ceil((b[2]-b[0])*d),j=Math.ceil((b[3]-b[1])*e);c.scissor(g,h,i,j)}},Torped.Renderer.prototype.bindFbo=function(a){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,a.fbo),b.viewport(0,0,a.width,a.height),this.currentViewport.width=a.width,this.currentViewport.height=a.height},Torped.Renderer.prototype.bindRenderTarget=function(a){a!==this.currentRenderTarget&&(this.currentRenderTarget=a,0===this.currentRenderTarget||null===this.currentRenderTarget?(this.bindScreen(),this.currentViewMatrix=this.screenCameraView,this.currentProjectionMatrix=this.screenCameraProjection,this.cameraMatricesDirty=!0):(this.bindFbo(this.currentRenderTarget.fbo),this.currentViewMatrix=this.currentRenderTarget.cameraView,this.currentProjectionMatrix=this.currentRenderTarget.cameraProjection,this.cameraMatricesDirty=!0)),this.setScissorTest(!1),this.setMaskRendering(!1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},Torped.Renderer.prototype.clearStencilBuffer=function(){this.gl.stencilMask(255),this.gl.clear(this.gl.STENCIL_BUFFER_BIT)},Torped.Renderer.prototype.bindTexture=function(a,b){this.activeTexture!==a&&(this.activeTexture=a,this.gl.activeTexture(this.gl.TEXTURE0+a)),this.gl.bindTexture(b.target,b.handle)},Torped.Renderer.prototype.bindShader=function(a,b){var c=this.gl;if(this.currentShader!==a&&(this.currentShader=a,this.currentBoundMesh=null,c.useProgram(this.currentShader.program),void 0!==a.standardUniforms.texture&&c.uniform1i(a.standardUniforms.texture,0),this.cameraMatricesDirty=!0,a.hasDirtyUniforms=!0),b!==this.currentUniformValues&&(this.currentUniformValues=b,a.hasDirtyUniforms=!0),this.currentShader.hasDirtyUniforms){for(var d=1,e=this.currentShader._uniforms,f=0,g=a.uniformNames.length;g>f;f++){var h=a.uniformNames[f],i=e[h],j=i.value;null!==b[h].value&&(j=b[h].value),"float"===i.type||"f"===i.type?c.uniform1f(i.location,j):"vec2"===i.type?c.uniform2f(i.location,j[0],j[1]):"vec3"===i.type?c.uniform3f(i.location,j[0],j[1],j[2]):"vec4"===i.type?c.uniform4f(i.location,j[0],j[1],j[2],j[3]):"sampler2D"===i.type&&(this.bindTexture(d,j),c.uniform1i(i.location,d),d++)}a.hasDirtyUniforms=!1}this.cameraMatricesDirty&&(void 0!==a.standardUniforms.u_projection&&c.uniformMatrix4fv(a.standardUniforms.u_projection,!1,this.currentProjectionMatrix),void 0!==a.standardUniforms.u_view&&c.uniformMatrix4fv(a.standardUniforms.u_view,!1,this.currentViewMatrix),this.cameraMatricesDirty=!1)},Torped.Renderer.prototype.bindMesh=function(a){this.currentBoundMesh!==a&&(a.bind(this.currentShader.attributes,this.currentShader.numComponentsPerVertex),this.currentBoundMesh=a)},Torped.Renderer.prototype.beginFrame=function(){this.textureCache.flushUnused()},Torped.Renderer.prototype.setMaskRendering=function(a,b){var c=this.gl;this.setStencilTest(!0),a?(this.maskRenderingEnabled===!1&&(c.colorMask(!1,!1,!1,!1),c.depthMask(!1),c.stencilFunc(c.NEVER,1,255),this.maskRenderingEnabled=!0),b?c.stencilOp(c.INCR,c.INCR,c.INCR):c.stencilOp(c.DECR,c.DECR,c.DECR)):this.maskRenderingEnabled===!0&&(c.colorMask(!0,!0,!0,!0),c.depthMask(!0),c.stencilFunc(c.LEQUAL,128,255),c.stencilOp(c.KEEP,c.KEEP,c.KEEP),this.maskRenderingEnabled=!1)},Torped.Renderer.prototype.executeRenderCommand=function(a){var b=this.gl;this.setBlendMode(a.blendMode),this.setDepthTest(a.depthTest),this.setMaskRendering(a.writeToStencil,a.maskIsPositive),this.setScissorTest(a.scissorTest,a.scissorRect),this.bindShader(a.shader,a.shaderUniforms),this.bindTexture(0,a.texture);var c=this.currentShader.standardUniforms.u_world;void 0!==c&&a.worldTransform&&b.uniformMatrix4fv(c,!1,a.worldTransform);var d=this.currentShader.standardUniforms.u_opacity;void 0!==d&&b.uniform1f(d,a.opacity);var e=this.currentShader.standardUniforms.u_color;void 0!==e&&b.uniform3f(e,a.color[0],a.color[1],a.color[2]);var f=this.currentShader.standardUniforms.u_srcRect;void 0!==f&&b.uniform4f(f,a.srcRect[0],a.srcRect[1],a.srcRect[2],a.srcRect[3]);var g=this.currentShader.standardUniforms.u_flipTexCoordY;void 0!==g&&b.uniform1f(g,a.flipTexCoordY),this.bindMesh(a.mesh),-1===a.vertexIndex?a.mesh.draw():a.mesh.drawVertexRange(a.vertexIndex,4)},Torped.Renderer.prototype.whiteTexture=function(){return null===this._whiteTexture&&(this._whiteTexture=this.createTexture({pixels:new Uint8Array([255,255,255,255]),width:1,height:1})),this._whiteTexture},Torped.Renderer.prototype.setFieldOfView=function(a){this.fieldOfView=a,this.calculateCamera(this.screenCameraView,this.screenCameraProjection,this.virtualWidth,this.virtualHeight)},Torped.Renderer.BlendMode={Alpha:0,Solid:1,Additive:2,Multiply:3}}();var Torped=Torped||{};!function(){"use strict";function a(a,b,c){var d=a.createShader(c);if(a.shaderSource(d,b),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))throw new Error("An error occurred compiling a shader: "+a.getShaderInfoLog(d));return d}function b(a,b){var c=1;switch(b.type){case"float":c=1;break;case"vec2":c=2;break;case"vec3":c=3;break;case"vec4":c=4}return{name:b.name,numComponents:c}}function c(a,b){var c,d=[],e=new RegExp(b+"\\s*([^;]*)","g");do if(c=e.exec(a)){var f=c[1].split(" ");3===f.length&&f.splice(0,1),d.push({type:f[0],name:f[1]})}while(c);return d}function d(a,b,d){var e,f=c(d,"attribute"),g=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES),h={};for(e=0;g>e;++e)h[a.getActiveAttrib(b,e).name]=!0;for(e=0;e<f.length;)h[f[e].name]!==!0?f.splice(e,1):e++;return f}function e(a,b){function d(a){a.forEach(function(a){e.some(function(b){return b.name===a.name})===!1&&e.push(a)})}var e=[];return d(c(a,"uniform")),d(c(b,"uniform")),e}function f(a){switch(a){case"float":return 0;case"vec2":return[0,0];case"vec3":return[0,0,0];case"vec4":return[0,0,0,0]}return 0}function g(a,b,c){function d(d,e,g){Object.defineProperty(d,e,{set:function(d){null===c.value&&(c.value=f(b)),c.value[g]=d,a.hasDirtyUniforms=!0},get:function(){return c.value[g]}})}for(var e=Number(b[b.length-1]),g={},h=0;e>h;h++)for(var j=0;j<i[h].length;j++)d(g,i[h][j],h);return Object.defineProperty(g,"array",{get:function(){return c.value},set:function(a){if(a.length!==e)throw new Error("Uniform array: Array must be of size "+e);c.value=a}}),Object.freeze(g)}var h={texture:!0,u_view:!0,u_projection:!0,u_world:!0,u_opacity:!0,u_color:!0,u_srcRect:!0,u_flipTexCoordY:!0},i=[["x","r","u"],["y","g","v"],["z","b"],["w","a"]];Torped.Shader=function(c,g){if(!g.vertexSource)throw new Error("No vertex shader source");if(!g.fragmentSource)throw new Error("No fragment shader source");if(g.uniforms&&Array.isArray(g.uniforms))throw new Error("Shader: old style uniforms is unsupported");this.program=c.createProgram(),this.attributes=[];var i=a(c,g.vertexSource,c.VERTEX_SHADER),j=g.fragmentSource+"\nvoid _haxAndroidShaderCache() { lowp float hax="+Math.random()+";}",k=a(c,j,c.FRAGMENT_SHADER);if(c.attachShader(this.program,i),c.attachShader(this.program,k),c.linkProgram(this.program),!c.getProgramParameter(this.program,c.LINK_STATUS))throw new Error("Unable to initialize the shader program.");var l=0,m=this,n=d(c,this.program,g.vertexSource);n.forEach(function(a,d){c.bindAttribLocation(m.program,d,a.name);var e=b(c,a);m.attributes.push(e),l+=e.numComponents}),c.linkProgram(this.program),this.numComponentsPerVertex=l,this.standardUniforms={},this._uniforms={};var o=e(g.vertexSource,g.fragmentSource);o.forEach(function(a){var b=c.getUniformLocation(m.program,a.name);h[a.name]?m.standardUniforms[a.name]=b:m._uniforms[a.name]={type:a.type,location:b,value:f(a.type)}}),this.uniforms=this.createUniformSetters(this._uniforms),this.uniformNames=Object.keys(this._uniforms),this.hasDirtyUniforms=!0},Torped.Shader.prototype.createUniformSetters=function(a){var b={},c=this;return Object.keys(this._uniforms).forEach(function(d){var e=c._uniforms[d];"vec"!==e.type.substring(0,3)?Object.defineProperty(b,d,{set:function(b){a[d].value=b,c.hasDirtyUniforms=!0},get:function(){return a[d].value}}):b[d]=g(c,e.type,a[d])}),b}}();var Torped=Torped||{};!function(){"use strict";var a=0;Torped.Texture=function(a,b){this.handle=0,this.size=[0,0],this.loaded=!1,this.path=null,this.target=null,this.gl=a,this.refCount=0,this.preloadedAndUnused=!1,this.keepForever=!1,this.sizeCallbacks=[],this._pixelDataChangedListeners=[],b.wrapMode=b.wrapMode||Torped.Texture.WrapMode.Clamp,b.filter=b.filter||Torped.Texture.Filter.Linear,b.pixels?this._uploadPixelData(b.pixels,b.width,b.height,b.wrapMode,b.filter):b.path instanceof Array?6==b.path.length?this._uploadCubemap(b.resourceDirectory,b.path,b.wrapMode,b.filter):console.error("Cubemap requries six image paths"):b.path?this._uploadImageData(b.resourceDirectory,b.path,b.wrapMode,b.filter):b.canvas?this._uploadCanvas(b.canvas,b.wrapMode,b.filter):b.video?this._uploadVideo(b.video,b.wrapMode,b.filter):this._uploadEmptyTexture(b.width,b.height,b.wrapMode,b.filter)},Torped.Texture.prototype._uploadEmptyTexture=function(a,b,c,d){var e=this.gl;this._createAndBindHandle(e.TEXTURE_2D,c,d),e.texImage2D(this.target,0,e.RGBA,a,b,0,e.RGBA,e.UNSIGNED_BYTE,null),this._textureDataLoaded(a,b)},Torped.Texture.prototype._uploadPixelData=function(a,b,c,d,e){if(Array.isArray(a))a=new Uint8Array(a);else if(a instanceof Uint8Array==!1)throw new Error("pixels must be an array or Uint8Array");var f=this.gl;this._createAndBindHandle(f.TEXTURE_2D,d,e),f.bindTexture(this.target,this.handle),f.texImage2D(this.target,0,f.RGBA,b,c,0,f.RGBA,f.UNSIGNED_BYTE,a),this._textureDataLoaded(b,c)},Torped.Texture.prototype._uploadVideo=function(a,b,c){this.videoDOMNode=a,this._createAndBindHandle(this.getTextureTargetVideo(),b,c)},Torped.Texture.prototype._uploadImageData=function(a,b,c,d){var e=this.gl;this._createAndBindHandle(e.TEXTURE_2D,c,d);var f="http"===b.substring(0,4).toLowerCase(),g=new Image;f&&(g.crossOrigin="anonymous");var h=this;g.onload=function(){e.bindTexture(h.target,h.handle),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(h.target,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this),h._textureDataLoaded(this.width,this.height)},g.src=a+b,this.path=b},Torped.Texture.prototype._uploadCubemap=function(a,b,c,d){var e=this.gl;this._createAndBindHandle(e.TEXTURE_CUBE_MAP,c,d);for(var f=[e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z],g=this,h=0;6>h;++h){var i=new Image;i.crossOrigin="anonymous",i.onload=function(a){return function(){e.bindTexture(g.target,g.handle),e.texImage2D(f[a],0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this),g._textureDataLoaded(this.width,this.height)}}(h),i.src=a+b[h]}},Torped.Texture.prototype._uploadCanvas=function(a,b,c){var d=this.gl;this._createAndBindHandle(d.TEXTURE_2D,b,c),d.bindTexture(this.target,this.handle),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),d.texImage2D(this.target,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,a);var e=window.devicePixelRatio||1;this._textureDataLoaded(a.width/e,a.height/e)},Torped.Texture.prototype.updateVideoTexture=function(){var a=this.videoDOMNode;if(a.readyState===a.HAVE_ENOUGH_DATA){var b=this.gl;b.bindTexture(this.target,this.handle),b.texImage2D(this.target,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a),this.loaded===!1&&this._textureDataLoaded(a.videoWidth,a.videoHeight),this._notifyPixleDataChangedListeners()}},Torped.Texture.prototype.getTextureTargetVideo=function(){return this.gl.TEXTURE_EXTERNAL_OES||this.gl.TEXTURE_2D},Torped.Texture.prototype.addPixelDataChangedListener=function(a){this._pixelDataChangedListeners.push(a)},Torped.Texture.prototype.removePixelDataChangedListener=function(a){var b=this._pixelDataChangedListeners.indexOf(a);if(-1===b)throw new Error("Listener is not added");this._pixelDataChangedListeners.splice(b,1)},Torped.Texture.prototype._notifyPixleDataChangedListeners=function(){for(var a=0;a<this._pixelDataChangedListeners.length;++a)this._pixelDataChangedListeners[a].onTexturePixelDataChanged(this)},Torped.Texture.prototype._createAndBindHandle=function(a,b,c){var d=this.gl;this.handle=d.createTexture(),this.target=a,d.bindTexture(a,this.handle);var e;c===Torped.Texture.Filter.Nearest?e=d.NEAREST:c===Torped.Texture.Filter.Linear&&(e=d.LINEAR),d.texParameteri(a,d.TEXTURE_MAG_FILTER,e),d.texParameteri(a,d.TEXTURE_MIN_FILTER,e),b===Torped.Texture.WrapMode.Repeat?(d.texParameteri(a,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(a,d.TEXTURE_WRAP_T,d.REPEAT)):(d.texParameteri(a,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(a,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE)),this.wrapMode=b},Torped.Texture.prototype._textureDataLoaded=function(b,c){this.size=[b,c],this.loaded=!0,this._notifySizeCallbacks(this.size),a+=b*c*4},Torped.Texture.prototype.addSizeCallback=function(a,b){return this.loaded?void a(this.size):void this.sizeCallbacks.push({id:b,callback:a})},Torped.Texture.prototype.removeSizeCallback=function(a){this.sizeCallbacks=this.sizeCallbacks.filter(function(b){return b.id!==a})},Torped.Texture.prototype._notifySizeCallbacks=function(a){if(0!==this.sizeCallbacks.length){for(var b=0;b<this.sizeCallbacks.length;++b)this.sizeCallbacks[b].callback(a);this.sizeCallbacks.length=0}},Torped.Texture.WrapMode={Clamp:0,Repeat:1},Torped.Texture.Filter={Nearest:1,Linear:2}}();var Torped=Torped||{};!function(){"use strict";Torped.TextureCache=function(a){this.gl=a,this.textureCache=[]},Torped.TextureCache.prototype.createTexture=function(a){var b;return"string"==typeof a.path||a.path instanceof String?(b=this.textureCache[a.path],b?a.callback&&(b.loaded===!1?b.callbacks.push(a.callback):a.callback(b)):(b=new Torped.Texture(this.gl,a),this.textureCache[a.path]=b),b):void console.log("Texture - path is not a string: "+a.path)},Torped.TextureCache.prototype.flushUnused=function(){for(var a in this.textureCache){var b=this.textureCache[a];0===b.refCount&&b.preloadedAndUnused===!1&&b.keepForever===!1&&delete this.textureCache[a]}},Torped.TextureCache.prototype.evict=function(a){this.textureCache[a]?delete this.textureCache[a]:console.log("TextureCache.evict: texture doesn't exist: "+a)}}();var Torped=Torped||{};Torped.UI=Torped.UI||{},Torped.UI.DragGestureRecognizer=function(){"use strict";function a(){}function b(){return this._velocity}function c(){return this._touchPosition-this._startPosition}function d(){return this._deltaPosition}function e(a){if(a.isDown)this._touchPosition=a.pos[this.axis],this._hasPressedDown=!0,this._velocity=0,this._deltaPosition=0,this._startPosition=this._touchPosition;else if(a.isMove&&this._hasPressedDown){var b=a.pos[this.axis];if(this._isDragging===!1?Math.abs(b-this._touchPosition)>this.threshold&&(this._isDragging=!0,this._startPosition=b,this._touchPosition=b,this.onDragStart()):(a.deltaTime>0&&(this._velocity=(b-this._touchPosition)/a.deltaTime),
this._touchPosition=b,this._deltaPosition=a.delta[this.axis],this.onDrag()),this._isDragging&&this.track)return Torped.Touch.StartTracking}else(a.isUp||a.isExit)&&this._isDragging&&(this._isDragging=!1,this._hasPressedDown=!1,this._deltaPosition=0,this.onDragEnd())}return{create:function(f){return Object.create(null,{axis:{value:f.axis||0,writable:!0},track:{value:f.hasOwnProperty("track")?f.track:!0,writable:!0},threshold:{value:f.threshold,writable:!0},onDragStart:{value:f.onDragStart||a,writable:!0},onDrag:{value:f.onDrag||a,writable:!0},onDragEnd:{value:f.onDragEnd||a,writable:!0},velocity:{get:b},dragDistance:{get:c},dragDelta:{get:d},onTouch:{value:e,writable:!1},_startPosition:{value:0,writable:!0},_touchPosition:{value:0,writable:!0},_hasPressedDown:{value:!1,writable:!0},_isDragging:{value:!1,writable:!0},_velocity:{value:0,writable:!0},_deltaPosition:{value:0,writable:!0}})}}}();var Torped=Torped||{};Torped.UI=Torped.UI||{},Torped.UI.AnimatedImage=function(){"use strict";var a={create:function(a,b){function c(a){var c=a%b.framesX,d=Math.floor(a/b.framesX);e._srcRect[0]=c*f,e._srcRect[1]=d*g,e._srcRect[2]=(c+1)*f,e._srcRect[3]=(d+1)*g,e.contentDirty=!0}if(b=b||{},void 0===b.image)throw new Error("Image property must be set");var d=b.image;b.image=void 0;var e=a.createControl(b);e.setImage(d,function(a){b.width||(e.width=a[0]/b.framesX),b.height||(e.height=a[1]/b.framesY)});var f=1/b.framesX,g=1/b.framesY,h=void 0!==b.numFrames?b.numFrames:b.framesX*b.framesY;c(0);var i=a.createTimer({duration:b.duration?b.duration:1e3,repeatCount:0,onRunning:function(a){e.position=a}}),j=0;return Object.defineProperties(e,{position:{set:function(a){j=Torped.Math.clamp(0,1,a);var b=Torped.Math.clamp(0,.9999,a);c(Math.floor(b*h))},get:function(){return j}},curFrame:{set:function(a){this.position=Torped.Math.clamp(0,1,a/h)},get:function(){return Math.floor(j*h)}},play:{get:function(){return i.start.bind(i)}},stop:{get:function(){return i.stop.bind(i)}},duration:{get:function(){return i.duration},set:function(a){i.duration=a}}}),e}};return a}();var Torped=Torped||{};Torped.UI=Torped.UI||{},Torped.UI.Circle=function(){"use strict";function a(a){var b=["uniform mat4 u_projection;","uniform mat4 u_view;","uniform mat4 u_world;","uniform mediump vec4 u_srcRect;","uniform lowp float u_flipTexCoordY;","attribute vec2 a_position;","attribute vec2 a_uv;","attribute float aBlur;","attribute float aVertexOpacity;","varying mediump vec2 uv;","varying lowp float blur;","varying lowp float vertexOpacity;","void main(void) {","   gl_Position = u_projection * u_view * u_world * vec4(a_position, 0.0, 1.0);","   uv = u_srcRect.xy + a_uv * (u_srcRect.zw - u_srcRect.xy);","   if(u_flipTexCoordY > 0.0) { uv.y = 1.0 - uv.y; }","   blur = aBlur;","   vertexOpacity = aVertexOpacity;","}"].join("\n"),c=["uniform sampler2D texture;","uniform lowp vec3 u_color;","uniform lowp float u_opacity;","varying mediump vec2 uv;","varying lowp float blur;","varying lowp float vertexOpacity;","void main(void) {","   lowp float intensity = smoothstep(0.0, 1.0, blur*vertexOpacity);","   gl_FragColor = texture2D(texture, uv)*vec4(u_color,1.0)*(u_opacity*intensity);","}"].join("\n"),d=a.renderer.createShader({vertexSource:b,fragmentSource:c});return d}var b={circleShader:null,create:function(c,d){function e(){function a(a,b,d,e){var f=Math.cos(d-.5*Math.PI),h=Math.sin(d-.5*Math.PI);g[r++]=a+c*f,g[r++]=b+c*h,g[r++]=(g[r-3]+l)/(2*c),g[r++]=(g[r-3]+l)/(2*c),g[r++]=0,g[r++]=e,g[r++]=a+j*f,g[r++]=b+j*h,g[r++]=(g[r-3]+l)/(2*c),g[r++]=(g[r-3]+l)/(2*c),g[r++]=1,g[r++]=e,g[r++]=a+s*f,g[r++]=b+s*h,g[r++]=(g[r-3]+l)/(2*c),g[r++]=(g[r-3]+l)/(2*c),g[r++]=1,g[r++]=e,g[r++]=a+t*f,g[r++]=b+t*h,g[r++]=(g[r-3]+l)/(2*c),g[r++]=(g[r-3]+l)/(2*c),g[r++]=0,g[r++]=e}var b=d.error||.075,c=j+l,e=Math.acos(2*(1-b/c)*(1-b/c)-1),f=Math.ceil(m/e),n=24,o=m<2*Math.PI;m>0&&4>f&&(f=2);var p=f;o&&(p+=2);var q=p*n;g&&g.length===q||(g=new Float32Array(q));var r=0,s=j-k,t=s-l,u=j,v=j;i&&(s=0,t=0),o&&a(u,v-l,0,0);var w;for(w=0;f>w;++w){var x=w/(f-1),y=m*x;a(u,v,y,1)}o&&a(u-Math.sin(m)*l,v+Math.cos(m)*l,m,0);var z=8*(p-1);for(h&&h.length===z||(h=new Uint16Array(z)),r=0,w=0;p-1>w;++w){var A;if(w%2===0)for(A=0;4>A;++A)h[r++]=4*w+A,h[r++]=4*(w+1)+A;else for(A=0;4>A;++A)h[r++]=4*w+3-A,h[r++]=4*(w+1)+3-A}}function f(){e(),n.vertices=g,n.indices=h,n.vertexDataDirty=!0,o.contentDirty=!0}d=d||{};var g,h,i=d.hasOwnProperty("solid")?d.solid:!0,j=d.size/2||100,k=d.lineWidth||1,l=d.hasOwnProperty("blur")?d.blur:2,m=d.hasOwnProperty("arcAngle")?Torped.Math.clamp(0,2*Math.PI,d.arcAngle):2*Math.PI;e();var n=c.renderer.createMesh({vertices:g,indices:h,primitiveType:Torped.Mesh.PrimitiveType.TriangleStrip});null===b.circleShader&&(b.circleShader=a(c)),d.color=d.color||"ffffff",d.mesh=n,d.shader=b.circleShader,d.width=d.size,d.height=d.size;var o=c.createControl(d);return Object.defineProperties(o,{size:{set:function(a){this.width=a,this.height=a},get:function(){return 2*j}},lineWidth:{set:function(a){k=a,f()},get:function(){return k}},solid:{set:function(a){i=a,f()},get:function(){return i}},blur:{set:function(a){l=a,f()},get:function(){return l}},arcAngle:{set:function(a){m=Torped.Math.clamp(0,2*Math.PI,a),f()},get:function(){return m}},setImplicitWidth:{value:function(a){this.width!==a&&(Torped.Control.prototype.setImplicitWidth.call(this,a),Torped.Control.prototype.setImplicitHeight.call(this,a),j=a/2,f())}},setImplicitHeight:{value:function(a){this.height!==a&&(Torped.Control.prototype.setImplicitWidth.call(this,a),Torped.Control.prototype.setImplicitHeight.call(this,a),j=a/2,f())}}}),o}};return b}();var Torped=Torped||{};Torped.UI=Torped.UI||{},function(){"use strict";Torped.UI.DirectTouchScrollHandler={create:function(a){var b=a.axis,c=a.scrollEndedHandler,d=4;return a.rubberLength&&(d=a.rubberLength),{scrollViewSize:0,scrollObjectSize:0,paddingTop:0,paddingBottom:0,hasMoved:!1,downStartPos:0,scrollThreshold:0,shouldRubber:!0,scrollSpeed:1,scrollEndedHandler:c,onTouch:function(a,e){var f=0;if(c&&(c.paddingTop=this.paddingTop,c.paddingBottom=this.paddingBottom,c.scrollViewSize=this.scrollViewSize,c.scrollObjectSize=this.scrollObjectSize,c.scrollThreshold=this.scrollThreshold,c.scrollSpeed=this.scrollSpeed,c.scrollEndedAnimationDuration=this.scrollEndedAnimationDuration),e.isDown||e.isEnter)this.hasMoved=!1,this.downStartPos=e.pos[b],c&&c.onTouch(a,e);else if(e.isMove&&(this.hasMoved||Math.abs(e.pos[b]-this.downStartPos)>this.scrollThreshold)){this.hasMoved=!0;var g=0,h=a+e.delta[b],i=Math.min(0,-this.scrollObjectSize+this.scrollViewSize);if(h>this.paddingTop?g=h-this.paddingTop:h<i-this.paddingBottom&&(g=i-this.paddingBottom-h),g>0&&this.shouldRubber){var j=Math.max(0,1-g/this.scrollViewSize*d);f=e.delta[b]*j}else f=h>this.paddingTop?this.paddingTop-a:h<i-this.paddingBottom?i-this.paddingBottom-a:e.delta[b];c&&c.onTouch(a,e)}else(e.isUp||e.isExit)&&this.hasMoved===!0&&(this.hasMoved=!1,c&&c.onTouch(a,e));return f}}}}}();var Torped=Torped||{};Torped.List=function(a){"use strict";function b(a){var b=this.positionToIndex(-a.currentPosition),c=0;return c=a.speed<0?b+1:b,c=Torped.Math.clamp(0,this.items.length-1,c),-this.indexToPosition(c)}function c(b){function c(c){var d;return d=c?c:0===b.axis?a.layouts.stackHorizontal:a.layouts.stackVertical}function d(a,c){if(b.shouldLoop&&void 0!==c&&0!==c)if(0>c)for(;u[k]<-u.firstChild[m];)v-=u.firstChild[m],u[k]+=u.firstChild[m],u.add(u.firstChild);else for(;u[k]+u.lastChild[l]>p[m];)v+=u.lastChild[m],u[k]-=u.lastChild[m],u.addAtIndex(0,u.lastChild);b.onScroll&&(w.position=u[k]+v,w.delta=c,b.onScroll.call(p,w))}function e(){b.onScrollEnded&&b.onScrollEnded()}function f(a){(void 0===a||null===a)&&console.error("Invalid index",a),b.shouldLoop||(0>a||a>=q.length)&&console.error("Invalid index",a)}function g(a){u.clear(),q=a,q.forEach(function(a){u.add(a)}),s=!0,t.start()}function h(a){function b(a){for(var b=0,c=0;a>c;c++)b+=q[a][m];return b}var c=a%q.length,d=a-c;return 0>c?b(q.length+c)+(d/q.length-1)*u[m]:b(c)+d/q.length*u[m]}function i(b){s?a.createTimer({duration:1,onFinish:b}).start():b()}function j(c,f){b.shouldLoop||(c=Torped.Math.clamp(0,Math.max(0,u[m]-p[m]),c));var g=u[k]+v,h=g;a.createTimer({duration:void 0!==f?f:y.scrollEndedAnimationDuration,onRunning:function(a){var b=Torped.easeOut(g,-c,a);u[k]=b-v,d(u[k],b-h),h=b},onFinish:e}).start()}if(0!==b.axis&&1!==b.axis)throw new Error("Axis must be set to 0 or 1");var k=0===b.axis?"x":"y",l=0===b.axis?"layoutX":"layoutY",m=0===b.axis?"width":"height",n=b.hasOwnProperty("track")?b.track:!0,o=b.fill;void 0===b.fill&&(void 0===b.width&&void 0===b.height?o="bounds":void 0===b.width?o="width":void 0===b.height&&(o="height"));var p=a.createControl({x:b.x,y:b.y,width:b.width,height:b.height,align:b.align,alignX:b.alignX,alignY:b.alignY,fill:o,clip:b.clip});p.id="list";var q=b.items||[],r=!0,s=!1,t=a.createTimer({duration:1,onFinish:function(){s=!1}}),u=a.createControl({fill:0===b.axis?"height":"width",layout:c(b.layout)}),v=0,w={position:0};a.scheduleAfterLayout(function(){d(0,0)}),p.add(u),g(q);var x={targetPosition:0,speed:0,currentPosition:0},y=a.uiComponents.createKineticScroller({axis:b.axis,callback:d,scrollEndedPositionCallback:function(a,c){return b.getScrollDestination&&(x.targetPosition=c,x.speed=a,x.currentPosition=u[k]+v,c=b.getScrollDestination.call(p,x),b.shouldLoop&&(c-=v)),c},onScrollEnded:e,scrollEndedAnimationDuration:b.scrollEndedDuration,bounceOnPositionEndedOverride:!1,shouldRubber:b.shouldRubber});return p.onTouch=function(a){if(r!==!1){var b=y.onTouch(u,a);return n?b:void 0}},p.scrollToIndex=function(a,c){f(a),i(function(){var d;b.shouldLoop?d=h(a):(a=Torped.Math.clamp(0,q.length-1,a),d=q[a][l]),j(d,c)})},p.scrollToPosition=function(a,b){i(j.bind(this,a,b))},p.positionToIndex=function(a){a-=v,b.shouldLoop&&(a=(a%u[m]+u[m])%u[m]);for(var c=0,d=q.length;d>c;++c){var e=q[c];if(e[l]+e[m]>a)return c}return console.error("Invalid position",a),-1},p.indexToPosition=function(a){return f(a),b.shouldLoop?h(a):q[a][l]},p.addItem=function(a){q.push(a),u.add(a),s=!0,t.start()},Object.defineProperties(p,{itemContainer:{get:function(){return u}},items:{get:function(){return q},set:function(a){g(a)}},scrollEnabled:{get:function(){return r},set:function(a){r=a===!0?!0:!1}},scroller:{get:function(){return y},set:function(a){y=a}},track:{get:function(){return n},set:function(a){n=a}}}),p}return{create:c,scrollDestinationOneItem:b}};var Torped=Torped||{};Torped.UI=Torped.UI||{},Torped.UI.MaskedControl=function(){"use strict";return{create:function(a,b){function c(b,c,f){if(0===c||0===f)throw new Error("Error! Can't create masked image without size");var g,i,j="string"!=typeof d&&"string"==typeof e||"string"==typeof d&&"string"!=typeof e,k=["uniform mat4 u_projection;","uniform mat4 u_view;","attribute vec3 a_position;","attribute vec2 a_uv;","attribute vec4 a_color;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","   gl_Position = u_projection * u_view * vec4(a_position, 1.0);","   uv = a_uv;","   color = a_color;","}"].join("\n"),l=["uniform sampler2D texture;","uniform sampler2D clipTexture;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","    lowp vec4 clipColor = texture2D(clipTexture, [uv_coord]);","    lowp vec4 realColor = texture2D(texture, uv);","    gl_FragColor = [clipColor]*realColor*color;","}"].join("\n"),m="uv";j&&(m="vec2(uv.x, 1.0 - uv.y)"),l=l.replace("[uv_coord]",m);var n="clipColor";h&&(n="clipColor.r*clipColor.g*clipColor.b*clipColor.a"),l=l.replace("[clipColor]",n);var o;if("string"==typeof e)g=a.renderer.createTexture({path:e});else if(e instanceof Torped.RenderTarget)g=e.texture,o=a.createControl({width:1,height:1,opacity:.01,depth:-1,image:e});else{if(!(e instanceof Torped.Control))throw new Error("Error! Unknown type for mask "+typeof e);e.width=c,e.height=f;var p=a.createRenderTarget({rootControl:e});g=p.texture,o=a.createControl({width:1,height:1,depth:-1,opacity:.01,image:p})}if(o&&a.addControl(o),"string"==typeof d)i=d;else if(d instanceof Torped.RenderTarget)i=d;else{if(!(d instanceof Torped.Control))throw new Error("Error! Unknown type for source");i=a.createRenderTarget({rootControl:d})}var q=a.renderer.createShader({vertexSource:k,fragmentSource:l});q.uniforms.clipTexture=g,b.width=c,b.height=f,b.image=i,b.shader=q}var d=b.source,e=b.mask,f=b.width,g=b.height,h=b.useGrayscaleMask,i=a.createControl({});if("string"!=typeof d||f||g){var j=void 0===f?d.width:f,k=void 0===g?d.height:g;c(i,j,k)}else{var l=a.createControl();l.setImage(d,function(a){c(i,a[0],a[1])})}return i}}}();var Torped=Torped||{};Torped.UI=Torped.UI||{},Torped.UI.MeshControl=function(){"use strict";function a(a,b){var c={},d={};return b.forEach(function(a){d[a]=!0}),Object.keys(a).filter(function(a){return d[a]!==!0}).forEach(function(b){c[b]=a[b]}),c}function b(a){function b(a,b){this._mesh=a,this._offset=b}function c(a,c){Object.defineProperty(b.prototype,a,{set:function(a){this._mesh.vertices[this._offset+c]=a,this._mesh.vertexDataDirty=!0},get:function(){return this._mesh.vertices[this._offset+c]}})}for(var d=0;a>d;d++)for(var f=e[d],g=0;g<f.length;g++)c(f[g],d);return b}function c(a,b,c){function d(d){var g=this,h=0;b.forEach(function(b){var i=b.numComponents;if(i>f.length)throw new Error("MeshControl: Vertex attributes with over "+e.length+" components aren't supported");var j=c*d+h;if(1===i)Object.defineProperty(g,b.name,{set:function(b){a.vertices[j]=b,a.vertexDataDirty=!0},get:function(){return a.vertices[j]}});else{var k=new f[i-2](a,j);g[b.name]=Object.freeze(k)}h+=b.numComponents})}return d}function d(b,d){if(!d.shader)throw new Error("MeshControl: A shader must be specified");var e=d.primitiveType||Torped.Mesh.PrimitiveType.TriangleStrip,f=b.renderer.createMesh({primitiveType:e}),g=a(d,["primitiveType","numVertices","numIndices"]);g.mesh=f;var h=b.createControl(g);h.vertices=[];var i=c(f,d.shader.attributes,d.shader.numComponentsPerVertex);return Object.defineProperties(h,{numVertices:{set:function(a){f.vertices=new Float32Array(a*this.shader.numComponentsPerVertex);var b=this.numVertices;this.vertices.length=a;for(var c=b;a>c;c++)this.vertices[c]=new i(c)},get:function(){return this.vertices.length}},numIndices:{set:function(a){f.indices=new Uint16Array(a)},get:function(){return this.mesh.indices?this.mesh.indices.length:0}},indices:{set:function(a){this.mesh.indices=a,this.mesh.vertexDataDirty=!0},get:function(){return this.mesh.indices}},setSizeFromAttribute:{value:function(a){for(var b=this.vertices[0][a].x,c=this.vertices[0][a].y,d=1;d<this.vertices.length;d++){var e=this.vertices[d];b=Math.max(b,e[a].x),c=Math.max(c,e[a].y)}this.width=b,this.height=c}}}),d.numVertices&&(h.numVertices=d.numVertices),d.numIndices&&(h.numIndices=d.numIndices),h}for(var e=[["x","r","u"],["y","g","v"],["z","b"],["w","a"]],f=[],g=1;g<e.length;g++)f[g-1]=b(g+1);return{create:d}}();var Torped=Torped||{};Torped.UI=Torped.UI||{},Torped.UI.Rectangle=function(){"use strict";function a(a){var b=["uniform mat4 u_projection;","uniform mat4 u_view;","uniform mat4 u_world;","uniform mediump vec4 u_srcRect;","uniform lowp float u_flipTexCoordY;","attribute vec2 a_position;","attribute vec2 a_uv;","attribute float a_blur;","varying mediump vec2 uv;","varying lowp float blur;","void main(void) {","   gl_Position = u_projection * u_view * u_world * vec4(a_position, 0.0, 1.0);","   uv = u_srcRect.xy + a_uv * (u_srcRect.zw - u_srcRect.xy);","   if(u_flipTexCoordY > 0.0) { uv.y = 1.0 - uv.y; }","   blur = a_blur;","}"].join("\n"),c=["uniform sampler2D texture;","uniform lowp vec3 u_color;","uniform lowp float u_opacity;","varying mediump vec2 uv;","varying lowp float blur;","void main(void) {","   lowp float intensity = smoothstep(0.0, 1.0, blur);","   gl_FragColor = texture2D(texture, uv)*vec4(u_color,1.0)*(u_opacity*intensity);","}"].join("\n"),d=a.renderer.createShader({vertexSource:b,fragmentSource:c});return d}var b={rectangleShader:null,create:function(c,d){function e(){function a(a){return(a.numSegments+1)*w}function b(){var b=0;return i.forEach(function(c){b+=a(c)*t}),b}function d(){(void 0===q||q.length!==x)&&(q=new Float32Array(x))}function e(){var a=0;i.forEach(function(b){a+=b.numSegments});var b=4,c=6,d=5,e=c*b+d,f=6;return a*f+e}function f(){(void 0===r||r.length!==y)&&(r=new Uint16Array(y))}function g(a,b,c,d){for(var e=a.radius+h,f=v/a.numSegments,g=0;g<=a.numSegments;++g){var i=Math.cos(d+g*f),k=Math.sin(d+g*f);q[s++]=b,q[s++]=c,q[s++]=q[s-3]/j.width,q[s++]=q[s-3]/j.height,q[s++]=1,q[s++]=b+a.radius*i,q[s++]=c-a.radius*k,q[s++]=q[s-3]/j.width,q[s++]=q[s-3]/j.height,q[s++]=1,q[s++]=b+e*i,q[s++]=c-e*k,q[s++]=q[s-3]/j.width,q[s++]=q[s-3]/j.height,q[s++]=0}}function k(){g(i[0],i[0].radius,i[0].radius,Math.PI/2),g(i[1],i[1].radius,j.height-i[1].radius,Math.PI),g(i[2],j.width-i[2].radius,j.height-i[2].radius,3*Math.PI/2),g(i[3],j.width-i[3].radius,i[3].radius,0)}function l(a,b){for(var c=b.startFromVertexIndex,d=b.startFromInnerEdge===!0?0:1,e=0;e<a.numSegments;++e){var f;if(e%2===d){for(f=0;w>f;++f)r[s++]=e*w+f+c,r[s++]=(e+1)*w+f+c;b.startFromInnerEdge=!1}else{for(f=0;w>f;++f)r[s++]=e*w+(w-1)-f+c,r[s++]=(e+1)*w+(w-1)-f+c;b.startFromInnerEdge=!0}}b.startFromVertexIndex=r[s-1]}function m(a){var b,c,d=x/t;a.startFromInnerEdge===!0?(b=a.startFromVertexIndex+w,c=a.startFromVertexIndex,r[s++]=c,r[s++]=b%d,r[s++]=c+1,r[s++]=(b+1)%d,r[s++]=c+2,r[s++]=(b+2)%d,a.startFromInnerEdge=!1):a.startFromInnerEdge===!1&&(b=a.startFromVertexIndex+1,c=a.startFromVertexIndex,r[s++]=c,r[s++]=(b+2)%d,r[s++]=c-1,r[s++]=(b+1)%d,r[s++]=c-2,r[s++]=b%d,a.startFromInnerEdge=!0),a.startFromVertexIndex=b}function n(){var b=[a(i[0]),a(i[1]),a(i[2]),a(i[3])];r[s++]=0,r[s++]=0,r[s++]=b[0]+b[1]+b[2],r[s++]=b[0],r[s++]=b[0]+b[1]}function o(){var a={startFromInnerEdge:!0,startFromVertexIndex:0};s=0,l(i[0],a),m(a),l(i[1],a),m(a),l(i[2],a),m(a),l(i[3],a),m(a),n()}function p(){i.forEach(function(a){if(0===a.radius)a.numSegments=1;else{var b=1-u/(a.radius+h),c=Math.acos(2*b*b-1);a.numSegments=Math.ceil(v/c)}})}var q,r,s=0,t=5,u=.2,v=Math.PI/2,w=3;p();var x=b();d(),k();var y=e();f(),o();var z=c.renderer.createMesh({vertices:q,indices:r,primitiveType:Torped.Mesh.PrimitiveType.TriangleStrip});return z.vertexDataDirty=!0,z}function f(a){var b;b=Array.isArray(a)?a:isNaN(a)?[0,0,0,0]:[a,a,a,a],i=[],b.forEach(function(a){i.push({radius:a})}),i.forEach(function(a){a.radius=Math.max(0,a.radius)})}function g(){var d=.1,f=i.every(function(a){return a.radius+h<d});f?null!==j.mesh&&null!==j.shader&&(j.mesh=null,j.shader=null):(j.mesh=e(),null===b.rectangleShader&&(b.rectangleShader=a(c)),j.shader=b.rectangleShader)}d=d||{};var h=d.blur||0,i=[];d.color=d.color||"ffffff";var j=c.createControl(d);return f(d.cornerRadius),g(),Object.defineProperties(j,{setImplicitWidth:{value:function(a){this.width!==a&&(Torped.Control.prototype.setImplicitWidth.call(this,a),g())}},setImplicitHeight:{value:function(a){this.height!==a&&(Torped.Control.prototype.setImplicitHeight.call(this,a),g())}},blur:{set:function(a){h=a,g()},get:function(){return h}},cornerRadius:{set:function(a){f(a),g()},get:function(){var a=i[0].radius,b=i.every(function(b){return b.radius===a});return b?a:[i[0].radius,i[1].radius,i[2].radius,i[3].radius]}}}),j}};return b}();var Torped=Torped||{};Torped.UI=Torped.UI||{},function(){"use strict";Torped.UI.Scroller={create:function(a,b,c){function d(a){return 0===l?a.width:a.height}function e(a){return 0===l?a.x:a.y}function f(a,b){0===l?a.x=b:a.y=b}function g(a){this._enabled=a,o.scrollEndedHandler&&(o.scrollEndedHandler.enabled=a)}function h(){return this._enabled}function i(a){this._bounceOnPositionEndedOverride=a,o.scrollEndedHandler&&(o.scrollEndedHandler.bounceOnPositionEndedOverride=a)}function j(){return this._bounceOnPositionEndedOverride}var k,l=c.axis,m=c.callback,n=c.createScrollEndedHandler({axis:l,scrollCallback:function(a){f(k,a),m&&m(a,0)},scrollThreshold:c.scrollThreshold,onScrollEnded:c.onScrollEnded,scrollEndedPositionCallback:c.scrollEndedPositionCallback}),o=Torped.UI.DirectTouchScrollHandler.create({axis:l,scrollEndedHandler:n,rubberLength:c.rubberLength,scrollThreshold:c.scrollThreshold}),p={paddingTop:c.paddingTop||0,paddingBottom:c.paddingBottom||0,scrollThreshold:c.scrollThreshold,shouldRubber:void 0!==c.shouldRubber?c.shouldRubber:!0,scrollSpeed:void 0!==c.scrollSpeed?c.scrollSpeed:1,scrollEndedAnimationDuration:c.scrollEndedAnimationDuration||300,_bounceOnPositionEndedOverride:!0,_enabled:!0,trackId:-1,onTouch:function(a,b){if(this.enabled!==!1&&(-1===this.trackId||b.id===this.trackId)){k=a;var c=d(a.parent),g=d(a);o.scrollThreshold=this.scrollThreshold,o.paddingTop=this.paddingTop,o.paddingBottom=this.paddingBottom,o.scrollViewSize=c,o.scrollObjectSize=g,o.shouldRubber=this.shouldRubber,o.scrollSpeed=this.scrollSpeed,o.scrollEndedAnimationDuration=this.scrollEndedAnimationDuration,o.enabled=this.enabled;var h=e(a),i=o.onTouch(h,b);return 0!==i&&(h+=i,f(k,h),m&&m(h,i)),o.hasMoved?(this.trackId=b.id,Torped.Touch.StartTracking):void(this.trackId=-1)}}};return Object.defineProperties(p,{enabled:{get:h,set:g},bounceOnPositionEndedOverride:{get:j,set:i}}),p.enabled=void 0!==c.enabled?c.enabled:!0,p.bounceOnPositionEndedOverride=void 0!==c.bounceOnPositionEndedOverride?c.bounceOnPositionEndedOverride:!0,p}}}();var Torped=Torped||{};Torped.UI=Torped.UI||{},Torped.UI.TapHandler=function(){"use strict";return{create:function(a,b){var c=[0,0],d=!1;return{callback:b||null,onTouch:function(b,e){if(null!==this.callback)if(e.isDown)c[0]=e.pos[0],c[1]=e.pos[1],d=!0;else if(e.isMove)(Math.abs(e.pos[0]-c[0])>a||Math.abs(e.pos[1]-c[1])>a)&&(d=!1);else if(e.isUp&&d===!0)return this.callback(b,e),d=!1,Torped.Touch.StopPropagation}}}}}();var Torped=Torped||{};Torped.TextField=function(a){"use strict";function b(b){b=b||{};var e=a.createControl({width:b.width,height:b.height});b.maxWidth=b.width;var f,g=a.createTextControl(b);e.add(g),g.observe("height",function(a){e.height=Math.max(b.height,a)}),e.onKey=function(a){return d!==this?!1:a.specialKey?8===a.keyCode?(g.text.length>0&&(g.text=g.text.slice(0,-1)),!0):void 0:13===a.keyCode?(f?f.call(g):g.text+="\n",!0):(g.text+=String.fromCharCode(a.keyCode),!0)};var h=a.uiComponents.createTapHandler(function(){e.requestFocus()});return e.onTouch=function(a){return h.onTouch(this,a)},Object.defineProperties(e,{requestFocus:{value:function(){TorpedRuntime.Device.showKeyboard(),d!==this&&(c(),d=this,this.notifyEventListeners("focusChanged",!0))}},onEnterPressed:{set:function(a){f=a}},text:{get:function(){return g.text},set:function(a){g.text=a}}}),b.onEnterPressed&&(e.onEnterPressed=b.onEnterPressed),e}function c(){null!==d&&(TorpedRuntime.Device.hideKeyboard(),d.notifyEventListeners("focusChanged",!1),d=null)}var d=null;return{create:b,releaseFocus:c}};var Torped=Torped||{};!function(){"use strict";Torped.UIComponents=function(a){this.scrollThreshold=50,this.core=a},Torped.UIComponents.prototype.setScrollThreshold=function(a){this.scrollThreshold=a},Torped.UIComponents.prototype.createKineticScroller=function(a){return a.scrollThreshold=a.scrollThreshold||this.scrollThreshold,a.createScrollEndedHandler=Torped.UIComponents.prototype.createKineticScrollEndedHandler.bind(this),Torped.UI.Scroller.create(this.core.touch,this.core.timerScheduler,a)},Torped.UIComponents.prototype.createKineticScrollEndedHandler=function(a){return Torped.UI.KineticScrollEndedHandler.create(this.core.timerScheduler,a)},Torped.UIComponents.prototype.createTapHandler=function(a){return Torped.UI.TapHandler.create(this.scrollThreshold,a)},Torped.UIComponents.prototype.createMaskedControl=function(a){return Torped.UI.MaskedControl.create(this.core,a)},Torped.UIComponents.prototype.createCircle=function(a){return Torped.UI.Circle.create(this.core,a)},Torped.UIComponents.prototype.createRectangle=function(a){return Torped.UI.Rectangle.create(this.core,a)},Torped.UIComponents.prototype.createDragGestureRecognizer=function(a){return a.hasOwnProperty("threshold")===!1&&(a.threshold=this.scrollThreshold),Torped.UI.DragGestureRecognizer.create(a)},Torped.UIComponents.prototype.createMeshControl=function(a){return Torped.UI.MeshControl.create(this.core,a)},Torped.UIComponents.prototype.createAnimatedImage=function(a){return Torped.UI.AnimatedImage.create(this.core,a)}}();var Torped=Torped||{};Torped.UI=Torped.UI||{},function(){"use strict";Torped.UI.KineticScrollEndedHandler={create:function(a,b){var c=b.axis,d=b.scrollCallback,e=b.onScrollEnded,f=b.scrollEndedPositionCallback,g=0,h=0,i=null;return{scrollViewSize:0,scrollObjectSize:0,paddingTop:0,paddingBottom:0,scrollSpeed:1,scrollEndedAnimationDuration:0,enabled:!0,bounceOnPositionEndedOverride:!0,onTouch:function(b,j){if(j.isDown)g=b,i&&i.stop(),h=0;else if(j.isMove)j.deltaTime>0?h=j.delta[c]/j.deltaTime:console.log("deltaTime was "+j.deltaTime);else if(j.isExit||j.isUp){var k=this.scrollEndedAnimationDuration,l=b+h*k/3*this.scrollSpeed,m=b+h*k/3,n=Math.min(0,this.scrollViewSize-this.scrollObjectSize-this.paddingBottom);if(l>this.paddingTop?(l=this.paddingTop,m=this.paddingTop):n>l&&(l=n,m=l),f&&(l=f(h,l),this.bounceOnPositionEndedOverride===!1&&(m=l)),this.enabled===!1)return;i=a.createTimer({duration:k,p0:b,p1:m,p2:l,p3:l,onRunning:function(a){d(Torped.bezier(this.p0,this.p1,this.p2,this.p3,a))},onFinish:function(){e&&e()}}).start()}}}}}}();var Torped=Torped||{};!function(){"use strict";function a(a,b){var c=a.getContext("experimental-webgl",{alpha:b,stencil:!0,preserveDrawingBuffer:!1});if(!c)throw new Torped.Errors.NoWebGLSupport;return c}function b(a){null===a._eventRecorder&&(a._eventRecorder=new Torped.EventRecorder({core:a,onTouchPlaybackEvent:function(b){a.touch.injectEvent(b)}}),a.touch.setEventQueuedCallback(function(b){a._eventRecorder.mode===Torped.EventRecorderMode.Recording&&a._eventRecorder.addTouchEvent(b)}))}function c(a,b){a.z=b,a.clip=!1;for(var d=0;d<a._children.length;++d)c(a._children[d],b)}function d(a){for(var b=0,c=0;c<a._children.length;++c){var e=d(a._children[c]);e>b&&(b=e)}return 1+b}Torped.Errors={},Torped.Errors.NoWebGLSupport=function(){this.message="WebGL not supported"},Torped.Errors.NoWebGLSupport.prototype=Object.create(Error.prototype),Torped.Errors.NoWebGLSupport.prototype.constructor=Torped.Errors.NoWebGLSupport;var e={AspectFit:"aspectFit",Fill:"fill"};Torped.Core=function(c){function d(a){g._currentOrientation=c[a],c.canvas?g._setVirtualSize(g._currentOrientation.width,g._currentOrientation.height):(g._onCanvasOrWindowSizeChanged(),g._resizeCanvasBuffer()),g.notifyEventListeners("orientationChanged",a)}if(!c.portrait&&!c.landscape)throw new Error("must have at least one orientation (portrait/landscape)");var f,g=this;f=window.innerWidth>window.innerHeight?c.landscape||c.portrait:c.portrait||c.landscape,this.fpsCallback=c.fpsCallback,c.hasOwnProperty("renderSizeSameAsVirtualSize")?this.renderSizeSameAsVirtualSize=c.renderSizeSameAsVirtualSize:this.renderSizeSameAsVirtualSize=TorpedRuntime.isBrowser?!0:!1,c.canvas?this.canvas=c.canvas:this.setupAndCreateCanvas({resizeCanvasBufferWithDelay:c.resizeCanvasBufferWithDelay||!1}),this.resourceDirectory="",this.videoTextures=[],this._afterLayoutCallbacks=[],TorpedRuntime.Device.addEventListener("orientationChanged",d);var h=a(this.canvas,c.hasOwnProperty("transparentContext")?c.transparentContext:!1);this._eventListeners={},this.externalMainLoop=!1,this.renderer=new Torped.Renderer(h,f.width,f.height),this.layoutEngine=new Torped.LayoutEngine,this.renderCommandList=new Torped.RenderCommandList(this.renderer,this.layoutEngine),this.boundRequestFrame=Torped.Core.prototype.requestFrame.bind(this),this.boundDoFrame=Torped.Core.prototype.doFrame.bind(this),this.touch=new Torped.Touch(this.canvas,this.boundRequestFrame,f.width,f.height),c.useKeyHandler!==!1&&(this.keyHandler=new Torped.KeyHandler(this.canvas,this.boundRequestFrame)),this.timerScheduler=new Torped.TimerScheduler(this.boundRequestFrame),this.textEngine=new Torped.TextEngine(this.renderer),this.uiComponents=new Torped.UIComponents(this),this.list=new Torped.List(this),this.textField=new Torped.TextField(this),this._root=this.createControl(),this._root._parent=this.createControl(),this.inspector=new Torped.Inspector(this,{useIgnoreList:!0}),this._eventRecorder=null,this._currentOrientation=f,this._canvasFillMode=void 0,this.setCanvasFillMode(c._canvasFillMode||e.AspectFit),this.frameQueued=!1,this.renderFrameQueued=!1,this.currentFrameTime=0,this._root.onKey=function(a){function e(a){115===a.keyCode?g.inspector._isEnabled?g.inspector.disable():g.inspector.enable(g._root,function(a){console.log(a)}):a.keyCode===f.ESC_OR_CAM?g.inspector._isEnabled&&g.inspector.disable():a.keyCode===f.R_OR_BACK?(b(g),g._eventRecorder.mode!==Torped.EventRecorderMode.Recording?g._eventRecorder.startRecording():g._eventRecorder.stopRecording()):a.keyCode===f.P_OR_VOL_DOWN&&(b(g),g._eventRecorder.stopRecording(),g._eventRecorder.startPlayback())}var f={O:79,P_OR_VOL_DOWN:112,R_OR_BACK:114,ESC_OR_CAM:27};a.keyCode===f.O&&(g._currentOrientation===c.portrait&&c.landscape?d("landscape"):g._currentOrientation===c.landscape&&c.portrait&&d("portrait")),TorpedRuntime.isBrowser===!0&&e(a)}},Object.defineProperties(Torped.Core.prototype,{screenWidth:{get:function(){return this._screenWidth}},screenHeight:{get:function(){return this._screenHeight}}}),Torped.Core.create=function(a){return new Torped.Core(a)},Torped.Core.prototype._onCanvasOrWindowSizeChanged=function(){this._canvasFillMode===e.AspectFit?this._setVirtualSize(this._currentOrientation.width,this._currentOrientation.height):this._fillVirtualSizeToWindow(),this._resizeCanvasDimensions(),this.requestRender()},Torped.Core.prototype._fillVirtualSizeToWindow=function(){this._setVirtualSize(window.innerWidth,window.innerHeight)},Torped.Core.prototype.setCanvasFillMode=function(a){this._canvasFillMode=a,this._onCanvasOrWindowSizeChanged(),this._resizeCanvasBuffer()},Torped.Core.prototype.setupAndCreateCanvas=function(a){this.canvas=document.createElement("canvas"),this.canvas.style.paddingLeft=0,this.canvas.style.paddingRight=0,this.canvas.style.marginLeft="auto",this.canvas.style.marginRight="auto",this.canvas.style.display="block",this.canvas.style.position="absolute",document.body.appendChild(this.canvas);var b,c=this;window.onresize=function(){c._onCanvasOrWindowSizeChanged(),a.resizeCanvasBufferWithDelay?(b&&window.clearTimeout(b),b=window.setTimeout(function(){c._resizeCanvasBuffer(),b=void 0,c.notifyEventListeners("canvasResized")},500)):(c._resizeCanvasBuffer(),c.notifyEventListeners("canvasResized"))},window.addEventListener("orientationchange",function(){c._onCanvasOrWindowSizeChanged(),c._resizeCanvasBuffer(),c.notifyEventListeners("canvasResized")})},Torped.Core.prototype.scheduleAfterLayout=function(a){if(this._afterLayoutCallbacks.length>1e5)throw new Error("too many after layout callbacks scheduled, cyclic dependencies?");this._afterLayoutCallbacks.push(a),this.requestRender()},Torped.Core.prototype.removeCallbackScheduledAfterLayout=function(a){for(var b=this._afterLayoutCallbacks.length-1;b>=0;--b)this._afterLayoutCallbacks[b]===a&&this._afterLayoutCallbacks.splice(b,1)},Torped.Core.prototype.callAfterLayoutCallbacks=function(){if(this._afterLayoutCallbacks.length>0){for(var a=0;a<this._afterLayoutCallbacks.length;++a)this._afterLayoutCallbacks[a]();this._afterLayoutCallbacks.length=0}},Torped.Core.prototype.addEventListener=function(a,b){this._eventListeners[a]||(this._eventListeners[a]=[]),this._eventListeners[a].push(b)},Torped.Core.prototype.notifyEventListeners=function(a,b){var c=this._eventListeners[a];if(c)for(var d=0;d<c.length;++d)c[d](b)},Torped.Core.prototype.removeEventListener=function(a,b){var c=this._eventListeners[a];if(!c)return void console.error("no event named"+a+" registered");var d=c.indexOf(b);-1!==d?c.splice(d,1):console.error("callback not registered for event "+a)},Torped.Core.prototype.addVideoTexture=function(a){-1===this.videoTextures.indexOf(a)&&this.videoTextures.push(a);
},Torped.Core.prototype._updateVideoTextures=function(){if(this.videoTextures.length>0){for(var a=this.videoTextures.length-1;a>=0;--a)this.videoTextures[a].videoDOMNode.isDestroyed?this.videoTextures.splice(a,1):this.videoTextures[a].updateVideoTexture();this.requestRender()}},Torped.Core.prototype._resizeCanvasDimensions=function(){var a=1,b=1,c=this.screenWidth/this.screenHeight,d=window.innerWidth/window.innerHeight;c/d>1?b=d/c:a=c/d;var e=window.innerWidth*a,f=window.innerHeight*b,g=Math.floor(e),h=Math.floor(f);this.canvas.style.width=g+"px",this.canvas.style.height=h+"px",this.canvas.style.left=(window.innerWidth-g)/2+"px",this.canvas.style.top=(window.innerHeight-h)/2+"px",TorpedRuntime.isBrowser||(this.canvas.scrollWidth=g,this.canvas.scrollHeight=h)},Torped.Core.prototype._resizeCanvasBuffer=function(){var a=this._screenWidth,b=this._screenHeight;if(this.renderSizeSameAsVirtualSize)this.canvas.width=a,this.canvas.height=b;else{var c=1,d=1,e=a/b,f=window.innerWidth/window.innerHeight;e/f>1?d=f/e:c=e/f;var g=window.innerWidth*c,h=window.innerHeight*d,i=window.devicePixelRatio||1;this.canvas.width=g*i,this.canvas.height=h*i}this.renderer.setRenderBufferSize(this.canvas.width,this.canvas.height),this.requestRender()},Torped.Core.prototype.preloadImage=function(a,b){function c(a){var c=d.createTexture({path:a});c.preloadedAndUnused=!0,c.keepForever=void 0===b?!1:b}var d=this.renderer;a instanceof Array?a.forEach(c):c(a)},Torped.Core.prototype.createControl=function(a){return new Torped.Control(this,a)},Torped.Core.prototype.createTextControl=function(a){return new Torped.TextControl(this,a)},Torped.Core.prototype.createTextField=function(a){return this.textField.create(a)},Torped.Core.prototype.createRenderTarget=function(a){return new Torped.RenderTarget(this,a)},Torped.Core.prototype.createTimer=function(a){return this.timerScheduler.createTimer(a)},Torped.Core.prototype._setVirtualSize=function(a,b){(this._screenWidth!==a||this._screenHeight!==b)&&(this._screenWidth=a,this._screenHeight=b,this._root.width=a,this._root.height=b,Torped.Math.AABB.set(this._root._clipRect,0,0,a,b),Torped.Math.AABB.set(this._root._worldBoundingBox,0,0,a,b),Torped.Math.AABB.set(this._root._parent._clipRect,0,0,a,b),Torped.Math.AABB.set(this._root._parent._worldBoundingBox,0,0,a,b),this.renderer.setVirtualSize(a,b),this.touch.screenWidth=a,this.touch.screenHeight=b,this._screenWidth===a&&this._screenHeight===b&&this.notifyEventListeners("virtualSizeChanged"))},Torped.Core.prototype.processInput=function(){this.touch.hasPendingEvents()&&this.touch.handleEvents(this._root),this.keyHandler&&this.keyHandler.hasPendingEvents()&&this.keyHandler.handleEvents(this._root)},Torped.Core.prototype.layoutFrame=function(){for(var a=0;this._root._localBoundingBoxDirty||this._root._localTransformDirty||this._afterLayoutCallbacks.length>0;)if(this.layoutEngine.layout(this._root,!1),this.callAfterLayoutCallbacks(),++a,a>1e6){console.error("cyclic dependency in observers");break}return a},Torped.Core.prototype.renderFrame=function(){this._updateVideoTextures();var a=!1;return this.renderFrameQueued&&(this.renderFrameQueued=!1,this.renderCommandList.buildList(this._root),a=!0),this.renderer.beginFrame(),this.renderCommandList.renderList(),a},Torped.Core.prototype.processTimers=function(){this.timerScheduler.hasPendingTimers()?(this.scheduleFrame(),this.timerScheduler.runTimers(this.currentFrameTime)):this.frameQueued=!1},Torped.Core.prototype.doFrame=function(){this.currentFrameTime=window.performance.now(),void 0!==this.fpsCallback&&(void 0===this.fpsStartTime&&(this.fpsStartTime=this.currentFrameTime,this.frameCounter=0),this.frameCounter++),this.processInput(),this.processTimers();var a=this.layoutFrame(),b=this.renderFrame();if(a>0&&b===!0&&null!==this._eventRecorder&&this._eventRecorder.mode===Torped.EventRecorderMode.Recording&&this._eventRecorder.addRenderedFrame(this.currentFrameTime),void 0!==this.fpsCallback&&100===this.frameCounter){var c=window.performance.now();this.fpsCallback(1e5/(c-this.fpsStartTime)),this.fpsStartTime=c,this.frameCounter=0}},Torped.Core.prototype.addControl=function(a){this._root.add(a)},Torped.Core.prototype.removeControl=function(a){this._root.remove(a)},Torped.Core.prototype.scheduleFrame=function(){this.frameQueued=!0,this.notifyEventListeners("frameRequested"),this.externalMainLoop!==!0&&window.requestAnimFrame(this.boundDoFrame)},Torped.Core.prototype.requestFrame=function(){this.frameQueued===!1&&this.scheduleFrame()},Torped.Core.prototype.requestRender=function(){this.renderFrameQueued===!1&&(this.renderFrameQueued=!0,this.requestFrame())},Torped.Core.prototype.toggleDebugView=function(){var a=1e3/d(this._root);c(this._root,a),this._root.x=500,this._root.z=-1e3,this._root.ry=-.8,this.requestFrame()},Torped.Core.prototype.playLog=function(a,c){b(this),this._eventRecorder.playExternalLog(a),void 0!==c&&this._eventRecorder.jumpToPosition(c)},Torped.Core.prototype.setScrollThreshold=function(a){this.uiComponents.setScrollThreshold(a)},Torped.Core.prototype.setResourceDirectory=function(a){this.resourceDirectory=a,this.renderer.resourceDirectory=a}}();var Torped=Torped||{};Torped.Core.prototype.layouts=Torped.Core.prototype.layouts||{},function(){"use strict";function a(a,b){function c(){for(var b=0;b<j.length;b++){var c=j[b];Torped.Layouting.doAlignX(c,a),Torped.Layouting.doFillX(c,a)}}function d(){for(var b=0;b<j.length;b++){var c=j[b];Torped.Layouting.doAlignY(c,a),Torped.Layouting.doFillY(c,a)}}function e(b){b.observe("width",Torped.Layouting.doAlignX.bind(null,b,a),i),b.observe("height",Torped.Layouting.doAlignY.bind(null,b,a),i),b.observe("alignX",Torped.Layouting.doAlignX.bind(null,b,a),i),b.observe("alignY",Torped.Layouting.doAlignY.bind(null,b,a),i),b.observe("fill",Torped.Layouting.doFillX.bind(null,b,a),i),b.observe("fill",Torped.Layouting.doFillY.bind(null,b,a),i),b.observe("width",Torped.Layouting.doFillX.bind(null,b,a),i),b.observe("height",Torped.Layouting.doFillY.bind(null,b,a),i)}function f(a){e(a)}function g(a){a.removeObserverById(i)}function h(){a.removeObserverById(i),j.forEach(function(a){a.removeObserverById(i)}),a.removeEventListener(k,f),a.removeEventListener(l,g)}var i={};b=b||{};var j=b.children||a.children,k=b.addedEventName||"childAdded",l=b.removedEventName||"childRemoved";return a.observe("contentWidth",c,i),a.observe("contentHeight",d,i),j.forEach(e),a.addEventListener(k,f),a.addEventListener(l,g),{cleanup:h}}Torped.Core.prototype.layouts.dockLayout=function(b,c){return a(b,c)}}();var Torped=Torped||{};Torped.Core.prototype.layouts=Torped.Core.prototype.layouts||{},function(){"use strict";function a(a,b,c){function d(){var c=0;a.children.forEach(function(a){c+=a[i]});for(var d=a.children.length,e=a[i],f=(e-c)/(d+1),g=f,h=0;d>h;h++)a.children[h][b]=g,g+=a.children[h][i]+f}function e(a){a.observe(i,d,h)}function f(a){a.removeObserverById(h),d()}function g(){a.children.forEach(function(a){a.removeObserverById(h)}),a.removeObserverById(h),a.removeEventListener("childAdded",e),a.removeEventListener("childRemoved",f)}var h={id:c},i="layoutX"===b?"width":"height";return a.children.forEach(function(a){a.observe(i,d,h)}),a.addEventListener("childAdded",e),a.addEventListener("childRemoved",f),a.observe(i,d,h),{cleanup:g}}var b=0;Torped.Core.prototype.layouts.evenlySpacedVertical=function(c){return a(c,"layoutY",b++)},Torped.Core.prototype.layouts.evenlySpacedHorizontal=function(c){return a(c,"layoutX",b++)}}();var Torped=Torped||{};Torped.Core.prototype.layouts=Torped.Core.prototype.layouts||{},function(){"use strict";function a(a,b,c){function d(){for(var c=0,d=0,e=a.children.length,f=0,g=0;e>g;g++){var h=a.children[g];c+h[i]>a[i]&&(d+=f,c=0,f=0),f=Math.max(h[j],f),h[b]=c,h[l]=d,c+=h[i]}}function e(a){a.observe("width",d,h),a.observe("height",d,h)}function f(a){a.removeObserverById(h),d()}function g(){a.removeObserverById(h),a.children.forEach(function(a){a.removeObserverById(h)}),a.removeEventListener("childAdded",e),a.removeEventListener("childRemoved",f)}var h={id:c},i="layoutX"===b?"width":"height",j="layoutX"===b?"height":"width",k="layoutX"===b?"contentHeight":"contentWidth",l="layoutX"===b?"layoutY":"layoutX";return a.observe(k,d,h),a.children.forEach(function(a){a.observe("width",d,h),a.observe("height",d,h)}),a.addEventListener("childAdded",e),a.addEventListener("childRemoved",f),{cleanup:g}}var b=0;Torped.Core.prototype.layouts.flowVertical=function(c){return a(c,"layoutY",b++)},Torped.Core.prototype.layouts.flowHorizontal=function(c){return a(c,"layoutX",b++)}}();var Torped=Torped||{};Torped.Layouting=Torped.Layouting||{},function(){"use strict";function a(a,b){if(0!==a.width&&0!==a.height&&0!==b.contentWidth&&0!==b.contentHeight){var c=b.contentWidth/a.width,d=b.contentHeight/a.height,e=Math.max(c,d);a.setImplicitWidth(a.width*e),a.setImplicitHeight(a.height*e),a._sizeSet[0]=Torped.Control.SizeSetState.FromFill,a._sizeSet[1]=Torped.Control.SizeSetState.FromFill}}function b(a,b){if(0!==a.width&&0!==a.height&&0!==b.contentWidth&&0!==b.contentHeight){var c=b.contentWidth/a.width,d=b.contentHeight/a.height,e=Math.min(c,d);a.setImplicitWidth(a.width*e),a.setImplicitHeight(a.height*e),a._sizeSet[0]=Torped.Control.SizeSetState.FromFill,a._sizeSet[1]=Torped.Control.SizeSetState.FromFill}}Torped.Layouting.doAlignX=function(a,b){a.alignX&&("left"===a.alignX?a.layoutX=0:"center"===a.alignX?a.layoutX=(b.contentWidth-a.width)/2:"right"===a.alignX&&(a.layoutX=b.contentWidth-a.width))},Torped.Layouting.doAlignY=function(a,b){a.alignY&&("top"===a.alignY?a.layoutY=0:"center"===a.alignY?a.layoutY=(b.contentHeight-a.height)/2:"bottom"===a.alignY&&(a.layoutY=b.contentHeight-a.height))},Torped.Layouting.doFillX=function(c,d){c.fill&&("width"===c.fill||"parent"===c.fill?(c.setImplicitWidth(d.contentWidth*c.parentFillFactorX),c._sizeSet[0]=Torped.Control.SizeSetState.FromFill):"aspectFill"===c.fill?a(c,d):"aspectFit"===c.fill&&b(c,d))},Torped.Layouting.doFillY=function(c,d){c.fill&&("height"===c.fill||"parent"===c.fill?(c.setImplicitHeight(d.contentHeight*c.parentFillFactorY),c._sizeSet[1]=Torped.Control.SizeSetState.FromFill):"aspectFill"===c.fill?a(c,d):"aspectFit"===c.fill&&b(c,d))}}();var Torped=Torped||{};Torped.Core.prototype.layouts=Torped.Core.prototype.layouts||{},function(){"use strict";function a(a,b){function c(){for(var c=0,d=a.children.length,e=0;d>e;e++)a.children[e][b]=c,c+=a.children[e][i]}function d(b){b.observe(i,c,h),"width"===i?(b.observe("alignY",Torped.Layouting.doAlignY.bind(null,b,a),h),b.observe("height",Torped.Layouting.doAlignY.bind(null,b,a),h),b.observe("fill",Torped.Layouting.doFillY.bind(null,b,a),h)):(b.observe("alignX",Torped.Layouting.doAlignX.bind(null,b,a),h),b.observe("width",Torped.Layouting.doAlignX.bind(null,b,a),h),b.observe("fill",Torped.Layouting.doFillX.bind(null,b,a),h))}function e(a){d(a)}function f(a){a.removeObserverById(h),c()}function g(){a.removeObserverById(h),a.children.forEach(function(a){a.removeObserverById(h)}),a.removeEventListener("childAdded",e),a.removeEventListener("childRemoved",f)}var h={},i="layoutX"===b?"width":"height";return"layoutX"===b?a.observe("contentHeight",function(){for(var b=0,c=a.children.length;c>b;b++){var d=a.children[b];Torped.Layouting.doAlignY(d,a),Torped.Layouting.doFillY(d,a)}},h):a.observe("contentWidth",function(){for(var b=0,c=a.children.length;c>b;b++){var d=a.children[b];Torped.Layouting.doAlignX(d,a),Torped.Layouting.doFillX(d,a)}},h),a.children.forEach(d),a.addEventListener("childAdded",e),a.addEventListener("childRemoved",f),{cleanup:g}}Torped.Core.prototype.layouts.stackVertical=function(b){return a(b,"layoutY")},Torped.Core.prototype.layouts.stackHorizontal=function(b){return a(b,"layoutX")}}();var Torped=Torped||{};!function(){"use strict";Torped.Core.prototype._animateTarget=function(a,b){var c=b.attribute,d=b.to,e=b.hasOwnProperty("duration")&&void 0!==b.duration?b.duration:300,f=b.delay||0,g=b.ease||Torped.easeOut,h=b.onRunning,i=b.onFinish,j=b.onStart,k=b.onStop;return a._attribAnims||(a._attribAnims={}),a._attribAnims[c]&&a._attribAnims[c].to===d?void 0:(a._attribAnims[c]&&a._attribAnims[c].stop(),a[c]!==d||h||i||j?void(a._attribAnims[c]=this.createTimer({duration:e,delay:f,to:d,startValue:a[c],repeatCount:b.repeatCount,onStart:j,onRunning:function(b){var d=g(this.startValue,this.to,b);a[c]=d,h&&h(d)},onFinish:function(){a._attribAnims[c]=null,i&&i()},onStop:k}).start()):void(a._attribAnims[c]=void 0))},Torped.Core.prototype.animate=function(a){var b=this;Array.isArray(a.target)?a.target.forEach(function(c){b._animateTarget(c,a)}):this._animateTarget(a.target,a)},Torped.Core.prototype.animateOpacity=function(a,b,c){this.animate({target:a,attribute:"opacity",to:b,duration:c})},Torped.Core.prototype.animateScale=function(a,b,c){this.animate({target:a,attribute:"scale",to:b,duration:c})},Torped.Core.prototype.animateScaleX=function(a,b,c){this.animate({target:a,attribute:"scaleX",to:b,duration:c})},Torped.Core.prototype.animateScaleY=function(a,b,c){this.animate({target:a,attribute:"scaleY",to:b,duration:c})},Torped.Core.prototype.animateX=function(a,b,c){this.animate({target:a,attribute:"x",to:b,duration:c})},Torped.Core.prototype.animateY=function(a,b,c){this.animate({target:a,attribute:"y",to:b,duration:c})},Torped.Core.prototype.animateWidth=function(a,b,c){this.animate({target:a,attribute:"width",to:b,duration:c})},Torped.Core.prototype.animateHeight=function(a,b,c){this.animate({target:a,attribute:"height",to:b,duration:c})},Torped.Core.prototype.animateColor=function(a,b,c){var d=[0,0,0];if("string"==typeof b){var e=0;"#"===b[0]&&(e=1);for(var f=0;3>f;++f)d[f]=parseInt(b.substring(e+2*f,e+2*f+2),16)/255}else d=b;if(a._color[0]!==d[0]||a._color[1]!==d[1]||a._color[2]!==d[2]){if(a._attribAnims){if(a._attribAnims.color){var g=a._attribAnims.color.to;if(g[0]===d[0]&&g[1]===d[1]&&g[2]===d[2])return}}else a._attribAnims={};a._attribAnims.color&&a._attribAnims.color.stop(),a._attribAnims.color=this.createTimer({duration:void 0!==c?c:300,startR:a._color[0],startG:a._color[1],startB:a._color[2],to:d,onRunning:function(b){a._color[0]=Torped.easeOut(this.startR,d[0],b),a._color[1]=Torped.easeOut(this.startG,d[1],b),a._color[2]=Torped.easeOut(this.startB,d[2],b),a.contentDirty=!0,a.notifyObservers("color")},onFinish:function(){a._attribAnims.color=null}}).start()}},Torped.Core.prototype.stopAnimation=function(a,b){a._attribAnims&&a._attribAnims[b]&&(a._attribAnims[b].stop(),a._attribAnims[b]=null)}}();var Torped=Torped||{};!function(){"use strict";function a(a){a._renderTarget?(a._renderTarget.removeDirtyListener(a),a._renderTarget=null):a._texture&&a._texture.videoDOMNode&&(a._texture.removePixelDataChangedListener(a),a._texture=null)}function b(a){this.addAtIndex(this._children.length,a)}function c(a,b){a._texture&&(a._texture.refCount+=b)}function d(a,b){if(void 0===b)throw new Error("addAtIndex: child is undefined");b.parent&&b.parent.remove(b),a===this._children.length?this._children.push(b):this._children.splice(a,0,b);var d=b._parent;b._parent=this,b.notifyObservers("parent"),b._localTransformDirty=!0,b.notifyEventListeners("parentChanged",{oldParent:d,newParent:this}),this.notifyObservers("children"),this.notifyEventListeners("childAdded",b),this.localBoundingBoxDirty=!0,this.contentDirty=!0,c(b,1)}function e(a){if(0>a||a>=this._children.length)return void console.log("removeAtIndex: index out of bounds");var b=this._children[a];b._parent=null,b.notifyObservers("parent"),b.notifyEventListeners("parentChanged",{oldParent:this,newParent:null}),this._children.splice(a,1),this.notifyObservers("children"),this.notifyEventListeners("childRemoved",b),this.localBoundingBoxDirty=!0,this.contentDirty=!0,c(b,-1),this.core.touch.onControlRemoved(b)}function f(a){if(a){var b=this._children.indexOf(a);if(-1===b)throw console.log("remove: control is not a child"),new Error("remove: control is not a child");this.removeAtIndex(b)}}function g(a){for(var b=[],c=this.numChildren,d=0;c>d;++d)a(this._children[d])&&b.push(d);for(var e=b.length,f=e-1;f>=0;--f)this.removeAtIndex(b[f])}function h(){for(;this.lastChild;)this.remove(this.lastChild)}function i(a,b){a._sizeSet[0]!==tb.Explicit&&(a.setImplicitWidth(b[0]),a._sizeSet[0]=tb.FromImage),a._sizeSet[1]!==tb.Explicit&&(a.setImplicitHeight(b[1]),a._sizeSet[1]=tb.FromImage)}function j(){this._sizeSet[0]=tb.NotSet,this._sizeSet[1]=tb.NotSet,this.localBoundingBoxDirty=!0,this.contentDirty=!0}function k(){a(this),this._texture=null,this.contentDirty=!0,this._sizeSet[0]===tb.FromImage&&(this._sizeSet[0]=tb.NotSet,this.setImplicitWidth(0)),this._sizeSet[1]===tb.FromImage&&(this._sizeSet[1]=tb.NotSet,this.setImplicitHeight(0))}function l(a){return this._children.indexOf(a)}function m(a){return this._children[a]}function n(){return this._pos[0]}function o(a){this._pos[0]!==a&&(this._pos[0]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("x"))}function p(){return this._pos[1]}function q(a){this._pos[1]!==a&&(this._pos[1]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("y"))}function r(){return this._pos[2]}function s(a){this._pos[2]!==a&&(this._pos[2]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("z"))}function t(){return this._rotation[0]}function u(a){this._rotation[0]!==a&&(this._rotation[0]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("rx"))}function v(){return this._rotation[1]}function w(a){this._rotation[1]!==a&&(this._rotation[1]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("ry"))}function x(){return this._rotation[2]}function y(a){this._rotation[2]!==a&&(this._rotation[2]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("rz"))}function z(){return this._size[0]}function A(a){this._size[0]!==a&&(this._size[0]=a,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this._pivotSet[0]===!1&&(this._localTransformDirty=!0),this.notifyObservers("width"),this.notifyObservers("contentWidth"))}function B(a){this._sizeSet[0]=tb.Explicit,this.setImplicitWidth(a)}function C(){return this._size[1]}function D(a){this._size[1]!==a&&(this._size[1]=a,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this._pivotSet[1]===!1&&(this._localTransformDirty=!0),this.notifyObservers("height"),this.notifyObservers("contentHeight"))}function E(a){this._sizeSet[1]=tb.Explicit,this.setImplicitHeight(a)}function F(){return this._pivotSet[0]?this._pivot[0]:.5*this.width}function G(){return this._pivotSet[1]?this._pivot[1]:.5*this.height}function H(){return this._pivotSet[2]?this._pivot[2]:0}function I(a){(this._pivotSet[0]===!1||this._pivot[0]!==a)&&(this._pivot[0]=a,this._pivotSet[0]=!0,this.localBoundingBoxDirty=!0,this._localTransformDirty=!0,this.contentDirty=!0)}function J(a){(this._pivotSet[1]===!1||this._pivot[1]!==a)&&(this._pivot[1]=a,this._pivotSet[1]=!0,this.localBoundingBoxDirty=!0,this._localTransformDirty=!0,this.contentDirty=!0)}function K(a){(this._pivotSet[2]===!1||this._pivot[2]!==a)&&(this._pivot[2]=a,this._pivotSet[2]=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0)}function L(){return this._scale[0]}function M(a){this.scaleX=a,this.scaleY=a,this.notifyObservers("scale")}function N(){return this._scale[0]}function O(){return this._scale[1]}function P(a){this._scale[0]!==a&&(this._scale[0]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("scaleX"))}function Q(a){this._scale[1]!==a&&(this._scale[1]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("scaleY"))}function R(a){this._layoutPosition[0]!==a&&(this._layoutPosition[0]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("layoutX"))}function S(){return this._layoutPosition[0]}function T(a){this._layoutPosition[1]!==a&&(this._layoutPosition[1]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("layoutY"))}function U(){return this._layoutPosition[1]}function V(a){this._layoutPosition[2]!==a&&(this._layoutPosition[2]=a,this._localTransformDirty=!0,this.localBoundingBoxDirty=!0,this.contentDirty=!0,this.notifyObservers("layoutZ"))}function W(){return this._layoutPosition[2]}function X(){return Torped.Math.transformBox(ub,vb,wb,xb,this.width,this.height,this._worldTransform),Math.min(ub[0],Math.min(vb[0],Math.min(wb[0],xb[0])))}function Y(){return Torped.Math.transformBox(ub,vb,wb,xb,this.width,this.height,this._worldTransform),Math.min(ub[1],Math.min(vb[1],Math.min(wb[1],xb[1])))}function Z(){return this._worldTransform[14]}function $(){return this._pos[0]+this._layoutPosition[0]}function _(){return this._pos[1]+this._layoutPosition[1]}function aa(){return this._pos[2]+this._layoutPosition[2]}function ba(){return this._opacity}function ca(a){this._opacity!==a&&(0===this._opacity&&a>0&&this._children.length>0&&(this.localBoundingBoxDirty=!0,this._localTransformDirty=!0),this._opacity=a,this.contentDirty=!0,this.notifyObservers("opacity"))}function da(a){this._localBoundingBoxDirty!==a&&(this._localBoundingBoxDirty=a,a===!0&&this._parent&&(this._parent.localBoundingBoxDirty=!0))}function ea(){return this._contentDirty}function fa(a){if(this._contentDirty!==a){this._contentDirty=a;for(var b=0;b<this._dirtyListeners.length;++b)this._dirtyListeners[b].onControlDirtyChanged(this,a);a===!0&&this._parent&&(this._parent.contentDirty=!0),a===!0&&this.core.requestRender()}}function ga(){return this._parent}function ha(a){this._clip!==a&&(this._clip=a,this.contentDirty=!0)}function ia(){return this._clip}function ja(b,c){function d(a){i(e,a),e.contentDirty=!0,c&&c(a)}if((!this._texture||this._texture.path!==b&&this._texture!==b)&&this._renderTarget!==b){var e=this;a(this),this.texture&&this.texture.loaded===!1&&this.texture.removeSizeCallback(this),"string"==typeof b&&b.length>0?(this.texture=this.core.renderer.createTexture({path:b}),this.texture.addSizeCallback(d,this)):b instanceof Torped.RenderTarget?(this._renderTarget=b,i(this,this._renderTarget.texture.size),e.contentDirty=!0,c&&c(this._renderTarget.texture.size),this._renderTarget.addDirtyListener(this)):b instanceof Torped.Texture?(b.videoDOMNode&&(this.core.addVideoTexture(b),b.addPixelDataChangedListener(this)),this.texture=b,b.addSizeCallback(d,this)):b instanceof HTMLVideoElement&&(this.texture=this.core.renderer.createTexture({video:b}),this.core.addVideoTexture(this.texture),this.texture.addPixelDataChangedListener(this),this.texture.addSizeCallback(d,this))}}function ka(){return this._texture?this._texture.path?this._texture.path:this._texture:this._renderTarget?this._renderTarget:null}function la(a){var b=Torped.Color.setArray(this._color,a);(b!==!1||null===this._texture)&&(this.contentDirty=!0,this.notifyObservers("color"),null===this._texture&&(this._texture=this.core.renderer.whiteTexture()))}function ma(){return this._color}function na(){return this._children}function oa(){return this._children[0]}function pa(){return this._children[this._children.length-1]}function qa(a){this.shader!==a&&(this._shader=a,null!==a?this._addShaderUniformsProperties():(this._shaderUniforms={},this._shaderUniformValues={}),this.contentDirty=!0)}function ra(){return this._shaderUniforms}function sa(){return this._shader}function ta(){return this._children.length}function ua(b){this._texture!==b&&(a(this),b.preloadedAndUnused=!1,this._texture=b,this.contentDirty=!0)}function va(){return this._texture}function wa(a){this._mesh!==a&&(this._mesh=a,this.contentDirty=!0)}function xa(){return this._mesh}function ya(){return this._visible}function za(a){this._visible!==a&&(this._visible=a,this.contentDirty=!0,a===!0&&(this.localBoundingBoxDirty=!0,this._localTransformDirty=!0))}function Aa(){return this.visible===!1||0===this.opacity?!1:Torped.Math.AABB.intersects(this._worldBoundingBox,this._parent._clipRect)}function Ba(a){this._dirtyListeners.push(a)}function Ca(a){var b=this._dirtyListeners.indexOf(a);if(-1===b)throw new Error("Listener is not added");this._dirtyListeners.splice(b,1)}function Da(a,b){b&&(this.contentDirty=!0)}function Ea(a){this._texture!==a&&console.error("onTexturePixelDataChanged texture mismatch"),this.contentDirty=!0}function Fa(a,b,c,d){if(void 0===a._pendingObserverCallbacks[d]){var e=function(){var e=a[c];switch(b.call(a,e),c){case"worldX":a._oldWorldPosition[0]=e;break;case"worldY":a._oldWorldPosition[1]=e;break;case"worldZ":a._oldWorldPosition[2]=e}a._pendingObserverCallbacks[d]=void 0};a._pendingObserverCallbacks[d]=e,a.core.scheduleAfterLayout(e)}}function Ga(a,b){var c=[];for(var d in a._observerCallbacks)for(var e=a._observerCallbacks[d],f=e.length-1;f>=0;--f)e[f].id===b&&c.push(e[f].key);c.forEach(function(b){void 0!==a._pendingObserverCallbacks[b]&&(a.core.removeCallbackScheduledAfterLayout(a._pendingObserverCallbacks[b]),a._pendingObserverCallbacks[b]=void 0)})}function Ha(a,b,c){var d={callback:b,id:c,key:yb};++yb,this._observerCallbacks[a]?this._observerCallbacks[a].push(d):this._observerCallbacks[a]=[d],Fa(this,b,a,d.key)}function Ia(a){var b=this._observerCallbacks[a];if(void 0!==b)for(var c=0,d=b.length;d>c;++c)Fa(this,b[c].callback,a,b[c].key)}function Ja(a){var b=this._observerCallbacks[a];return void 0!==b&&b.length>0}function Ka(a){Ga(this,a);for(var b in this._observerCallbacks)for(var c=this._observerCallbacks[b],d=c.length-1;d>=0;--d)c[d].id===a&&c.splice(d,1)}function La(a,b){this._eventListeners[a]||(this._eventListeners[a]=[]),this._eventListeners[a].push(b)}function Ma(a,b){if(this._eventListeners[a]){var c=this._eventListeners[a].indexOf(b);-1!==c&&this._eventListeners[a].splice(c,1)}}function Na(a,b){var c=this._eventListeners[a];if(c)for(var d=c.length-1;d>=0;--d)c[d](b)}function Oa(a){this._depthSet=!0,this._depth=a}function Pa(){return this._depth}function Qa(){this._depth=0,this._depthSet=!1}function Ra(a){this._layout&&(void 0===this._layout.cleanup?console.log("Warning! Setting a new layout on control without a cleanup on the old layout"):this._layout.cleanup(),this._layout=null),a&&(this._layout=a(this))}function Sa(a){"bounds"===a&&(a="parent"),this._fill!==a&&(a||(a=null),this._fill=a,"parent"!==a&&"width"!==a&&"height"!==a&&"aspectFill"!==a&&"aspectFit"!==a&&null!==a&&console.error("Unknown value on fill: "+a),this.notifyObservers("fill"))}function Ta(){return this._fill}function Ua(a){this.alignX!==a&&(a||(a=null,this.layoutX=null),"left"!==a&&"center"!==a&&"right"!==a&&null!==a&&console.error("invalid alignX",a,"Possible values are left, center, right or null/undefined"),this._alignX=a,this.notifyObservers("alignX"))}function Va(){return this._alignX}function Wa(a){this._alignY!==a&&(a||(a=null,this.layoutY=null),"top"!==a&&"center"!==a&&"bottom"!==a&&null!==a&&console.error("invalid alignY",a,"Possible values are top, center, bottom or null/undefined"),this._alignY=a,this.notifyObservers("alignY"))}function Xa(){return this._alignY}function Ya(a){if(this._alignX!==a||this._alignY!==a){if(a&&"center"!==a)return void console.error("Invalid align:",a,"align must be null/undefined or 'center'");this.alignX=a,this.alignY=a}}function Za(a){this._parentFillFactor[0]=a,this.notifyObservers("parentFillFactorX"),"parent"!==this.fill&&"width"!==this.fill||!this.parent||this.setImplicitWidth(this.parent.contentWidth*a)}function $a(){return this._parentFillFactor[0]}function _a(a){this._parentFillFactor[1]=a,this.notifyObservers("parentFillFactorY"),"parent"!==this.fill&&"height"!==this.fill||!this.parent||this.setImplicitHeight(this.parent.contentHeight*a)}function ab(){return this._parentFillFactor[1]}function bb(a,b){if(void 0===b)throw new Error("addMaskAtIndex: child is undefined");if(b.parent)throw new Error("addMaskAtIndex: Control already has a parent");0===this._masks.length&&(this._maskLayout=this.core.layouts.dockLayout(this,{children:this._masks,addedEventName:"maskAdded",removedEventName:"maskRemoved"})),a===this._masks.length?this._masks.push(b):this._masks.splice(a,0,b);var c=b._parent;b._parent=this,b.notifyObservers("parent"),b._localTransformDirty=!0,b.notifyEventListeners("parentChanged",{oldParent:c,newParent:this}),this.notifyEventListeners("maskAdded",b),this.contentDirty=!0}function cb(a){a._maskIsPositive=!0,bb.call(this,this._masks.length,a)}function db(a){a._maskIsPositive=!1,bb.call(this,this._masks.length,a)}function eb(a){var b=this._masks.indexOf(a);if(-1===b)throw new Error("removeMask: control is not a mask");a._parent=null,a.notifyObservers("parent"),a.notifyEventListeners("parentChanged",{oldParent:this,newParent:null}),this._masks.splice(b,1),this.notifyEventListeners("maskRemoved",a),0===this._masks.length&&(this._maskLayout.cleanup(),this._maskLayout=null),this.contentDirty=!0}function fb(){var a={};this._shader.uniformNames.forEach(function(b){a[b]={value:null}}),this._shaderUniformValues=a,this._shaderUniforms=this._shader.createUniformSetters(this._shaderUniformValues)}function gb(a){this._padding[0]=a,this._padding[1]=a,this._padding[2]=a,this._padding[3]=a;for(var b=0;b<this._children.length;b++){var c=this._children[b];c._localTransformDirty=!0,c.localBoundingBoxDirty=!0}this.contentDirty=!0,this.notifyObservers("padding"),this.notifyObservers("contentWidth"),this.notifyObservers("contentHeight")}function hb(){return this._padding[0]}function ib(a,b,c){a._padding[b]=c;for(var d=0;d<a._children.length;d++){var e=a._children[d];e._localTransformDirty=!0,e.localBoundingBoxDirty=!0}a.contentDirty=!0}function jb(a){ib(this,0,a),this.notifyObservers("paddingLeft"),this.notifyObservers("contentWidth")}function kb(){return this._padding[0]}function lb(a){ib(this,1,a),this.notifyObservers("paddingRight"),this.notifyObservers("contentWidth")}function mb(){return this._padding[1]}function nb(a){ib(this,2,a),this.notifyObservers("paddingTop"),this.notifyObservers("contentHeight")}function ob(){return this._padding[2]}function pb(a){ib(this,3,a),this.notifyObservers("paddingBottom"),this.notifyObservers("contentHeight")}function qb(){return this._padding[3]}function rb(){return this.width-this.paddingLeft-this.paddingRight}function sb(){return this.height-this.paddingTop-this.paddingBottom}Torped.Control=function(a,b){b=b||{},Object.defineProperties(this,{_pos:{value:[b.x||0,b.y||0,b.z||0],writable:!1},_size:{value:[0,0],writable:!1},_sizeSet:{value:[tb.NotSet,tb.NotSet],writable:!1},_pivot:{value:[b.pivotX||0,b.pivotY||0,b.pivotZ||0],writable:!1},_pivotSet:{value:[void 0!==b.pivotX,void 0!==b.pivotY,void 0!==b.pivotZ],writable:!1},_children:{value:[],writable:!1},_parent:{value:null,writable:!0},_texture:{value:null,writable:!0},_opacity:{value:void 0!==b.opacity?b.opacity:1,writable:!0},_color:{value:[1,1,1],writable:!0},_rotation:{value:[b.rx||0,b.ry||0,b.rz||0],writable:!1},_localTransform:{value:mat4.create(),writable:!1},_localTransformDirty:{value:!0,writable:!0},_localBoundingBox:{value:Torped.Math.AABB.create(),writable:!1},_localBoundingBoxDirty:{value:!0,writable:!0},_worldTransform:{value:mat4.create(),writable:!1},_worldBoundingBox:{value:Torped.Math.AABB.create(),writable:!1},_srcRect:{value:b.srcRect||[0,0,1,1],writable:!1},_clip:{value:b.clip||!1,writable:!0},_clipRect:{value:Torped.Math.AABB.create(),writable:!1},_visible:{value:void 0!==b.visible?b.visible:!0,writable:!0},blendMode:{value:b.blendMode||Torped.Renderer.BlendMode.Alpha,writable:!0},touchPropagation:{value:void 0!==b.touchPropagation?b.touchPropagation:!0,writable:!0},blockTouch:{value:void 0!==b.blockTouch?b.blockTouch:!1,writable:!0},onTouch:{value:b.onTouch||null,writable:!0},onHover:{value:b.onHover||null,writable:!0},onKey:{value:b.onKey||null,writable:!0},_renderTarget:{value:null,writable:!0},_shader:{value:null,writable:!0},keyInputEnabled:{value:void 0!==b.keyInputEnabled?b.keyInputEnabled:!0,
writable:!0},_mesh:{value:b.mesh||null,writable:!0},depthTest:{value:void 0!==b.depthTest?b.depthTest:!1,writable:!0},core:{value:a,writable:!1},_contentDirty:{value:!1,writable:!0},_scale:{value:[1,1,1],writable:!1},_dirtyListeners:{value:[],writable:!1},_observerCallbacks:{value:{},writable:!1},_eventListeners:{value:{},writable:!1},_depth:{value:b.depth||0,writable:!0},_depthSet:{value:void 0!==b.depth,writable:!0},_pendingObserverCallbacks:{value:{},writable:!1},_fill:{value:null,writable:!0},_alignX:{value:null,writable:!0},_alignY:{value:null,writable:!0},_layoutPosition:{value:[b.layoutX||0,b.layoutY||0,b.layoutZ||0],writable:!1},_masks:{value:[],writable:!1},_shaderUniforms:{value:{},writable:!0},_parentFillFactor:{value:[1,1],writable:!1},_padding:{value:[0,0,0,0],writable:!1},_oldWorldPosition:{value:[0,0,0],writable:!1}}),b.layout=b.layout||a.layouts.dockLayout,void 0!==b.width&&(this.width=b.width),void 0!==b.height&&(this.height=b.height),void 0!==b.scale?(this._scale[0]=b.scale,this._scale[1]=b.scale):(void 0!==b.scaleX&&(this._scale[0]=b.scaleX),void 0!==b.scaleY&&(this._scale[1]=b.scaleY)),b.image?this.image=b.image:b.texture&&(this.texture=b.texture),b.color&&(this.color=b.color),b.shader&&(this.shader=b.shader),this.layout=b.layout,b.fill&&(this.fill=b.fill),b.align?this.align=b.align:(b.alignX&&(this.alignX=b.alignX),b.alignY&&(this.alignY=b.alignY)),b.padding&&(this.padding=b.padding),b.paddingLeft&&(this.paddingLeft=b.paddingLeft),b.paddingTop&&(this.paddingTop=b.paddingTop),b.paddingRight&&(this.paddingRight=b.paddingRight),b.paddingBottom&&(this.paddingBottom=b.paddingBottom)},Object.defineProperties(Torped.Control.prototype,{add:{value:b,writable:!1},addAtIndex:{value:d,writable:!1},removeAtIndex:{value:e,writable:!1},remove:{value:f,writable:!1},removeWithFilter:{value:g,writable:!1},clear:{value:h,writable:!1},resetSize:{value:j,writable:!1},resetImage:{value:k,writable:!1},indexOf:{value:l,writable:!1},at:{value:m,writable:!1},setImage:{value:ja,writable:!1},isVisible:{value:Aa,writable:!1},addDirtyListener:{value:Ba,writable:!1},removeDirtyListener:{value:Ca,writable:!1},onRenderTargetDirtyChanged:{value:Da,writable:!1},onTexturePixelDataChanged:{value:Ea,writable:!1},observe:{value:Ha,writable:!1},removeObserverById:{value:Ka,writable:!1},notifyObservers:{value:Ia,writable:!1},hasObservers:{value:Ja,writable:!1},addEventListener:{value:La,writable:!1},notifyEventListeners:{value:Na,writable:!1},removeEventListener:{value:Ma,writable:!1},setImplicitWidth:{value:A,writable:!1},setImplicitHeight:{value:D,writable:!1},resetDepth:{value:Qa,writable:!1},addPositiveMask:{value:cb,writable:!1},addNegativeMask:{value:db,writable:!1},removeMask:{value:eb,writable:!1},_addShaderUniformsProperties:{value:fb,writable:!1},x:{get:n,set:o},y:{get:p,set:q},z:{get:r,set:s},rx:{get:t,set:u},ry:{get:v,set:w},rz:{get:x,set:y},width:{get:z,set:B},height:{get:C,set:E},pivotX:{get:F,set:I},pivotY:{get:G,set:J},pivotZ:{get:H,set:K},scaleX:{get:N,set:P},scaleY:{get:O,set:Q},scale:{get:L,set:M},layoutX:{get:S,set:R},layoutY:{get:U,set:T},layoutZ:{get:W,set:V},parentX:{get:$},parentY:{get:_},parentZ:{get:aa},worldX:{get:X},worldY:{get:Y},worldZ:{get:Z},opacity:{get:ba,set:ca},localBoundingBoxDirty:{set:da},parent:{get:ga},clip:{get:ia,set:ha},image:{get:ka,set:ja},color:{get:ma,set:la},children:{get:na},firstChild:{get:oa},lastChild:{get:pa},numChildren:{get:ta},shader:{get:sa,set:qa},shaderUniforms:{get:ra},texture:{get:va,set:ua},mesh:{get:xa,set:wa},contentDirty:{get:ea,set:fa},visible:{get:ya,set:za},depth:{get:Pa,set:Oa},layout:{set:Ra},fill:{set:Sa,get:Ta},alignX:{set:Ua,get:Va},alignY:{set:Wa,get:Xa},align:{set:Ya},parentFillFactorX:{set:Za,get:$a},parentFillFactorY:{set:_a,get:ab},padding:{set:gb,get:hb},paddingLeft:{set:jb,get:kb},paddingRight:{set:lb,get:mb},paddingTop:{set:nb,get:ob},paddingBottom:{set:pb,get:qb},contentWidth:{get:rb},contentHeight:{get:sb}});var tb={NotSet:0,Explicit:1,FromImage:2,FromFill:3};Torped.Control.SizeSetState=tb;var ub=[0,0],vb=[0,0],wb=[0,0],xb=[0,0],yb=0}();var Torped=Torped||{};!function(){"use strict";function a(a){var b=Torped.TextEngine.Alignment.Left;return a===Torped.TextControl.Alignment.Center?b=Torped.TextEngine.Alignment.Center:a===Torped.TextControl.Alignment.Right&&(b=Torped.TextEngine.Alignment.Right),b}function b(a,b,c,d,e){a.textTextureCache||(a.textTextureCache={});var f=a.textTextureCache,g=b.toString()+c.family+c.size+"-"+(d||0)+e,h=f[g];if(!h){var i=Object.keys(f);if(i.length>=64){var j,k=a.currentFrameTime+1;i.forEach(function(a){k>f[a].timeUsed&&(k=f[a].timeUsed,j=a)}),j&&delete f[j]}h={texture:a.textEngine.createTexture(b.toString(),c,d||0,e),timeUsed:a.currentFrameTime},f[g]=h}return h.timeUsed=a.currentFrameTime,h.texture}function c(c){if(this._text!==c){if(""===c||void 0===c||null===c)this.resetImage(),this.setImplicitWidth(0),this.setImplicitHeight(this._font.size);else{var d=a(this.alignment);this.texture=b(this.core,c,this._font,this.maxWidth,d),this.setImplicitWidth(this._texture.size[0]),this.setImplicitHeight(this._texture.size[1]),this._sizeSet[0]=Torped.Control.SizeSetState.FromImage,this._sizeSet[1]=Torped.Control.SizeSetState.FromImage}this._text=c,this.contentDirty=!0,this.notifyObservers("text")}}function d(){return this._text}function e(){var a=this.text;this.text=null,this.text=a}function f(){return this._maxWidth}function g(a){this._maxWidth!==a&&(this._maxWidth=a,e.call(this))}function h(){return this._alignment}function i(a){return a===Torped.TextControl.Alignment.Left||a===Torped.TextControl.Alignment.Center||a===Torped.TextControl.Alignment.Right}function j(a){if(this._alignment!==a){if(i(a)===!1)return void console.log("TextControl: Unknown alignment:",a);this._alignment=a,e.call(this)}}function k(a){this._font!==a&&(this._font=a,e.call(this))}function l(){return this._font}function m(a){var b=["uniform sampler2D texture;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","    gl_FragColor = texture2D(texture, uv).a*color;","}"].join("\n"),c=a.createShader({vertexSource:o,fragmentSource:b});return c}var n={family:"Helvetica",size:40};Torped.TextControl=function(a,b){b=b||{},b.shader||(void 0===this.defaultTextShader&&(Torped.TextControl.prototype.defaultTextShader=m(a.renderer)),b.shader=this.defaultTextShader),Torped.Control.call(this,a,b),Object.defineProperties(this,{_maxWidth:{value:0,writable:!0},_font:{value:b.font||n,writable:!0},_text:{value:"",writable:!0},_alignment:{value:Torped.TextControl.Alignment.Left,writable:!0}}),b.maxWidth&&(this.maxWidth=b.maxWidth),void 0!==b.text&&(this.text=b.text),void 0!==b.alignment&&(this.alignment=b.alignment)},Torped.TextControl.Alignment={Left:"left",Center:"center",Right:"right"},Torped.TextControl.prototype=Object.create(Torped.Control.prototype,{maxWidth:{get:f,set:g},text:{get:d,set:c},alignment:{get:h,set:j},font:{get:l,set:k}}),Torped.TextControl.prototype.constructor=Torped.TextControl;var o=["uniform mat4 u_projection;","uniform mat4 u_view;","attribute vec3 a_position;","attribute vec2 a_uv;","attribute vec4 a_color;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","   gl_Position = u_projection * u_view * vec4(a_position, 1.0);","   uv = a_uv;","   color = a_color;","}"].join("\n")}();var Torped=Torped||{};!function(){"use strict";Torped.easeOutQuartic=function(a,b,c){return c--,-(b-a)*(c*c*c*c-1)+a},Torped.easeInQuartic=function(a,b,c){return(b-a)*(c*c*c*c)+a},Torped.easeInOutQuartic=function(a,b,c){return c*=2,1>c?(b-a)/2*c*c*c*c+a:(c-=2,-(b-a)/2*(c*c*c*c-2)+a)},Torped.easeOutCubic=function(a,b,c){return c--,(b-a)*(c*c*c+1)+a},Torped.easeInCubic=function(a,b,c){return(b-a)*(c*c*c)+a},Torped.easeInOutCubic=function(a,b,c){return c*=2,1>c?(b-a)/2*c*c*c+a:(c-=2,(b-a)/2*(c*c*c+2)+a)},Torped.easeOutQuadratic=function(a,b,c){return-(b-a)*c*(c-2)+a},Torped.easeInQuadratic=function(a,b,c){return(b-a)*(c*c)+a},Torped.easeInOutQuadratic=function(a,b,c){return c*=2,1>c?(b-a)/2*c*c+a:(c-=1,-(b-a)/2*(c*(c-2)-1)+a)},Torped.linear=function(a,b,c){return a+(b-a)*c},Torped.bezier=function(a,b,c,d,e){var f=1-e;return f*f*f*a+3*f*f*e*b+3*f*e*e*c+e*e*e*d},Torped.easeIn=Torped.easeInCubic,Torped.easeOut=Torped.easeOutCubic,Torped.easeInOut=Torped.easeInOutCubic,Torped.Core.prototype.easeOutQuartic=Torped.easeOutQuartic,Torped.Core.prototype.easeInQuartic=Torped.easeInQuartic,Torped.Core.prototype.easeInOutQuartic=Torped.easeInOutQuartic,Torped.Core.prototype.easeOutCubic=Torped.easeOutCubic,Torped.Core.prototype.easeInCubic=Torped.easeInCubic,Torped.Core.prototype.easeInOutCubic=Torped.easeInOutCubic,Torped.Core.prototype.easeOutQuadratic=Torped.easeOutQuadratic,Torped.Core.prototype.easeInQuadratic=Torped.easeInQuadratic,Torped.Core.prototype.easeInOutQuadratic=Torped.easeInOutQuadratic,Torped.Core.prototype.easeIn=Torped.easeInCubic,Torped.Core.prototype.easeOut=Torped.easeOutCubic,Torped.Core.prototype.easeInOut=Torped.easeInOutCubic,Torped.Core.prototype.linear=Torped.linear,Torped.Core.prototype.bezier=Torped.bezier}();var Torped=Torped||{};!function(){"use strict";function a(b,c){if(b.keyInputEnabled!==!1){for(var d=b._children.length-1;d>=0;--d)if(a(b._children[d],c))return!0;return b._renderTarget&&b._renderTarget.rootControl&&a(b._renderTarget.rootControl,c)?!0:b.onKey&&b.onKey(c)===!0?!0:!1}}Torped.KeyHandler=function(a,b){this.eventQueue=[];var c=this;window.addEventListener("keydown",function(a){var d=8===a.keyCode||a.keyCode>=112&&a.keyCode<=123;if(TorpedRuntime.isBrowser===!0&&27===a.keyCode&&(d=!0),d===!0){a.preventDefault();var e={keyCode:a.keyCode,specialKey:!0};c.eventQueue.push(e),b()}}),window.addEventListener("keypress",function(a){a.preventDefault();var d={keyCode:a.keyCode,specialKey:!1};c.eventQueue.push(d),b()})},Torped.KeyHandler.prototype.handleEvents=function(b){for(var c=0;c<this.eventQueue.length;++c)a(b,this.eventQueue[c]);this.eventQueue.length=0},Torped.KeyHandler.prototype.hasPendingEvents=function(){return this.eventQueue.length>0}}();var Torped=Torped||{};!function(){"use strict";function a(a){Torped.Math.AABB.transform(a._worldBoundingBox,a._localBoundingBox,a.parent._worldTransform)}function b(a){if(mat4.multiply(a._worldTransform,a.parent._worldTransform,a._localTransform),a.hasObservers("worldX")){var b=a.worldX;a._oldWorldPosition[0]!==b&&a.notifyObservers("worldX")}if(a.hasObservers("worldY")){var c=a.worldY;a._oldWorldPosition[1]!==c&&a.notifyObservers("worldY")}if(a.hasObservers("worldZ")){var d=a.worldZ;a._oldWorldPosition[2]!==d&&a.notifyObservers("worldZ")}}function c(a,b){function c(a,b){var c=b._localBoundingBox;a.min[0]=Math.min(a.min[0],c.min[0]),a.max[0]=Math.max(a.max[0],c.max[0]),a.min[1]=Math.min(a.min[1],c.min[1]),a.max[1]=Math.max(a.max[1],c.max[1])}var d=a._children;if(d.length>0){b.min[0]=0,b.min[1]=0,b.max[0]=0,b.max[1]=0,c(b,d[0]);for(var e=1,f=d.length;f>e;++e)c(b,d[e]);a.clip&&(b.min[0]=0,b.min[1]=0)}else b.min[0]=0,b.min[1]=0,b.max[0]=a.width,b.max[1]=a.height;a._sizeSet[0]&&(b.max[0]=Math.max(a.width,b.max[0])),a._sizeSet[1]&&(b.max[1]=Math.max(a.height,b.max[1])),Torped.Math.AABB.transform(a._localBoundingBox,b,a._localTransform)}function d(a){for(var b=a._children,c=0,d=0,e=0,f=b.length;f>e;e++){var g=b[e];c=Math.max(g.x+g.layoutX+g.width,c),d=Math.max(g.y+g.layoutY+g.height,d)}a._sizeSet[0]===Torped.Control.SizeSetState.NotSet&&"parent"!==a._fill&&"width"!==a._fill&&a.setImplicitWidth(c),a._sizeSet[1]===Torped.Control.SizeSetState.NotSet&&"parent"!==a._fill&&"height"!==a._fill&&a.setImplicitHeight(d)}function e(a){mat4.identity(a._localTransform);var b=a.parent;a._localTransform[12]=a._pos[0]+b._padding[0]+a._layoutPosition[0]+a.pivotX,a._localTransform[13]=a._pos[1]+b._padding[2]+a._layoutPosition[1]+a.pivotY,a._localTransform[14]=a._pos[2]+a._layoutPosition[2]+a.pivotZ,a._localTransform[0]=a._scale[0],a._localTransform[5]=a._scale[1],a._localTransform[10]=a._scale[2],0!==a._rotation[0]&&mat4.rotateX(a._localTransform,a._localTransform,a._rotation[0]),0!==a._rotation[1]&&mat4.rotateY(a._localTransform,a._localTransform,a._rotation[1]),0!==a._rotation[2]&&mat4.rotateZ(a._localTransform,a._localTransform,a._rotation[2]),f[0]=-a.pivotX,f[1]=-a.pivotY,f[2]=-a.pivotZ,mat4.translate(a._localTransform,a._localTransform,f)}Torped.LayoutEngine=function(){this.tempBoundingBox=Torped.Math.AABB.create()},Torped.LayoutEngine.prototype.layout=function(f,g){var h=f.parent,i=g,j=g;if(f._localTransformDirty&&(e(f),f._localTransformDirty=!1,i=!0),f._localBoundingBoxDirty&&f._sizeSet[0]&&f._sizeSet[1]&&(f._clip||0===f._children.length)&&(Torped.Math.AABB.set(f._localBoundingBox,0,0,f._size[0],f._size[1]),Torped.Math.AABB.transform(f._localBoundingBox,f._localBoundingBox,f._localTransform),f._localBoundingBoxDirty=!1,j=!0),i&&b(f),j&&f._localBoundingBoxDirty===!1&&a(f),f.clip&&Torped.Math.AABB.intersection(f._clipRect,f._worldBoundingBox,h._clipRect),(f.clip===!1||f._localBoundingBoxDirty)&&Torped.Math.AABB.copy(f._clipRect,h._clipRect),f._localBoundingBoxDirty||f.isVisible()){var k,l,m=f._masks;for(k=0,l=m.length;l>k;++k)this.layout(m[k],i);var n=f._children;for(k=0,l=n.length;l>k;++k)this.layout(n[k],i)}f._localBoundingBoxDirty&&(c(f,this.tempBoundingBox),(f._sizeSet[0]===Torped.Control.SizeSetState.NotSet||f._sizeSet[1]===Torped.Control.SizeSetState.NotSet)&&d(f),f._localBoundingBoxDirty=!1,a(f),f.clip&&Torped.Math.AABB.intersection(f._clipRect,f._worldBoundingBox,h._clipRect))};var f=vec3.create()}();var Torped=Torped||{};!function(){"use strict";function a(a,b,c,d,e,f,g){var h=g.width*g._scale[0],i=g.height*g._scale[1],j=g._clipRect;a[0]<j.min[0]&&(e[0]=(j.min[0]-a[0])/h,a[0]=j.min[0],c[0]=j.min[0]),a[1]<j.min[1]&&(e[1]=(j.min[1]-a[1])/i,a[1]=j.min[1],b[1]=j.min[1]),b[0]>j.max[0]&&(f[0]=(b[0]-j.max[0])/h,b[0]=j.max[0],d[0]=j.max[0]),c[1]>j.max[1]&&(f[1]=(c[1]-j.max[1])/i,c[1]=j.max[1],d[1]=j.max[1])}function b(a,b,c,d,e,f){var g=Math.min(a[0],b[0],c[0],d[0]),h=Math.min(a[1],b[1],c[1],d[1]),i=Math.max(a[0],b[0],c[0],d[0]),j=Math.max(a[1],b[1],c[1],d[1]),k=g<f.min[0]||h<f.min[1]||i>f.max[0]||j>f.max[1];k&&(e.scissorTest=!0,e.scissorRect[0]=f.min[0],e.scissorRect[1]=f.min[1],e.scissorRect[2]=f.max[0],e.scissorRect[3]=f.max[1])}function c(c,d,e){Torped.Math.transformBox(h,i,j,k,c.width,c.height,c._worldTransform),l[0]=0,l[1]=0,m[0]=0,m[1]=0;var f=Torped.Math.isMatrixRotated(c._worldTransform)||Torped.Math.isMatrixScaled(c._worldTransform);f||0!==c._worldTransform[14]?b(h,i,j,k,d,c._clipRect):a(h,i,j,k,l,m,c);var g=c._srcRect[2]-c._srcRect[0],n=c._srcRect[3]-c._srcRect[1];d.vertices[0]=h[0],d.vertices[1]=h[1],d.vertices[2]=h[2],d.vertices[3]=c._srcRect[0]+l[0]*g,d.vertices[4]=c._srcRect[1]+l[1]*n,d.vertices[5]=c._color[0]*e,d.vertices[6]=c._color[1]*e,d.vertices[7]=c._color[2]*e,d.vertices[8]=e,d.vertices[9]=i[0],d.vertices[10]=i[1],d.vertices[11]=i[2],d.vertices[12]=c._srcRect[2]-m[0]*g,d.vertices[13]=d.vertices[4],d.vertices[14]=d.vertices[5],d.vertices[15]=d.vertices[6],d.vertices[16]=d.vertices[7],d.vertices[17]=d.vertices[8],d.vertices[18]=j[0],d.vertices[19]=j[1],d.vertices[20]=j[2],d.vertices[21]=d.vertices[3],d.vertices[22]=c._srcRect[3]-m[1]*n,d.vertices[23]=d.vertices[5],d.vertices[24]=d.vertices[6],d.vertices[25]=d.vertices[7],d.vertices[26]=d.vertices[8],d.vertices[27]=k[0],d.vertices[28]=k[1],d.vertices[29]=k[2],d.vertices[30]=d.vertices[12],d.vertices[31]=d.vertices[22],d.vertices[32]=d.vertices[5],d.vertices[33]=d.vertices[6],d.vertices[34]=d.vertices[7],d.vertices[35]=d.vertices[8],c._renderTarget&&(d.vertices[4]=1-d.vertices[4],d.vertices[13]=1-d.vertices[13],d.vertices[22]=1-d.vertices[22],d.vertices[31]=1-d.vertices[31])}function d(a,b){return a-b}function e(a){var b=a.createShader({vertexSource:a._defaultVsSource,fragmentSource:a._defaultFsSource});return b}function f(a){var b=a.createShader({vertexSource:a._defaultVsSource,fragmentSource:a._videoFsSource});return b}function g(a){var b=a.createShader({vertexSource:a._defaultVsSource,fragmentSource:a._imageMaskFsSource});return b}var h=vec3.create(),i=vec3.create(),j=vec3.create(),k=vec3.create(),l=[0,0],m=[0,0],n=4;Torped.RenderCommandList=function(a,b){this.renderer=a,this.layoutEngine=b,this.freeRenderCommands=[],this.renderCommandLists=[],this.numRenderCommands=0,this.defaultShader=e(a),this.defaultImageMaskShader=g(a),this.renderer.supportsEGLImageExternal?this.defaultVideoShader=f(a):this.defaultVideoShader=this.defaultShader,this.defaultMesh=a.createMesh(),this.numLayerIndices=0,this.layerIndices=[]},Torped.RenderCommandList.prototype.renderList=function(){function a(a,c){if(b.clearStencilBuffer(),a)for(var d=0;d<a.length;d++)b.executeRenderCommand(a[d]);for(var e=c.length,f=0;e>f;++f)b.executeRenderCommand(c[f])}for(var b=this.renderer,c=0;c<this.renderCommandLists.length;++c){var e=this.renderCommandLists[c];b.bindRenderTarget(e.renderTarget);var f=e.depthLayers,g=e.holesToPunch;this.numLayerIndices=0;for(var h in f)this.layerIndices[this.numLayerIndices++]=h;for(this.layerIndices.length=this.numLayerIndices,this.layerIndices.sort(d),h=0;h<this.numLayerIndices;++h){var i=this.layerIndices[h];a(g[i],f[i])}}},Torped.RenderCommandList.prototype.buildList=function(a){function b(a){for(var b=a.length,c=0;b>c;++c)h.push(a[c])}function c(a){for(var b=0;b<a.length;++b)a[b].mesh===j.defaultMesh?(a[b].vertexIndex=k,j.defaultMesh.vertices.set(a[b].vertices,k*j.defaultShader.numComponentsPerVertex),k+=n):a[b].vertexIndex=-1}var d,e,f,g,h=this.freeRenderCommands;for(d=0;d<this.renderCommandLists.length;++d){f=this.renderCommandLists[d],g=f.depthLayers;for(e in g)b(g[e])}this.renderCommandLists=[],this.numRenderCommands=0;var i=this.createEmptyRenderCommandList(0);this.buildRenderCommandListRec(i,a,1,0),this.renderCommandLists.push(i),this.numRenderCommands*this.defaultShader.numComponentsPerVertex*n>this.defaultMesh.vertices.length&&(this.defaultMesh.vertices=new Float32Array(this.numRenderCommands*this.defaultShader.numComponentsPerVertex*n*2));var j=this,k=0;for(d=0;d<this.renderCommandLists.length;++d){f=this.renderCommandLists[d],g=f.depthLayers;for(e in f.holesToPunch)c(f.holesToPunch[e]);for(e in g)c(g[e])}this.defaultMesh.vertexDataDirty=!0},Torped.RenderCommandList.prototype.fillRenderCommand=function(a,b,c){a._renderTarget?(b.texture=a._renderTarget.texture,b.flipTexCoordY=1):(b.texture=a._texture,b.flipTexCoordY=0),a._shader?b.shader=a._shader:b.texture&&b.texture.videoDOMNode?b.shader=this.defaultVideoShader:b.shader=this.defaultShader,1>c&&a.blendMode===Torped.Renderer.BlendMode.Solid?b.blendMode=Torped.Renderer.BlendMode.Alpha:b.blendMode=a.blendMode,b.depthTest=a.depthTest},Torped.RenderCommandList.rasterizePixelContinuum=function(a){},Torped.RenderCommandList.prototype.fillQuadRenderCommand=function(a,b,d){this.fillRenderCommand(a,b,d),c(a,b,d),b.mesh=this.defaultMesh},Torped.RenderCommandList.prototype.fillMeshRenderCommand=function(a,c,d){this.fillRenderCommand(a,c,d),c.mesh=a.mesh,-1!==c.shader.standardUniforms.world&&(c.worldTransform=a._worldTransform),Torped.Math.transformBox(h,i,j,k,a.width,a.height,a._worldTransform),b(h,i,j,k,c,a._clipRect)},Torped.RenderCommandList.prototype.getNewRenderCommand=function(){var a;return this.freeRenderCommands.length>0?(a=this.freeRenderCommands.pop(),a.mesh=null,a.worldTransform=null,a.vertexIndex=-1,a.scissorTest=!1,a.writeToStencil=!1,a):a={vertices:new Float32Array(n*this.defaultShader.numComponentsPerVertex),texture:null,blendMode:Torped.Renderer.BlendMode.Alpha,shader:null,mesh:null,worldTransform:null,depthTest:!1,vertexIndex:-1,opacity:1,scissorTest:!1,scissorRect:[0,0,0,0],color:[-1,-1,-1],srcRect:[0,0,1,1],flipTexCoordY:0,writeToStencil:!1,maskIsPositive:!1}},Torped.RenderCommandList.prototype.appendRenderCommand=function(a,b,c,d){if((b._texture&&b._texture.loaded||b._renderTarget)&&c>0){var e=this.getNewRenderCommand();e.opacity=c,e.color=b.color,e.srcRect=b._srcRect,e.shaderUniforms=b._shaderUniformValues,b.mesh?this.fillMeshRenderCommand(b,e,c):this.fillQuadRenderCommand(b,e,c),a[d]||(a[d]=[]),a[d].push(e),this.numRenderCommands++}},Torped.RenderCommandList.prototype.appendMaskRenderCommand=function(a,b,c,d,e){if(b.isVisible()!==!1&&b._texture){var f=this.getNewRenderCommand();f.writeToStencil=!0,f.maskIsPositive=d,e&&(f.maskIsPositive=!f.maskIsPositive),b.mesh?this.fillMeshRenderCommand(b,f,1):(this.fillQuadRenderCommand(b,f,1),f.texture===this.renderer.whiteTexture()?f.shader=this.defaultShader:f.shader=this.defaultImageMaskShader),a[c]||(a[c]=[]),a[c].push(f),this.numRenderCommands++,b._contentDirty=!1}},Torped.RenderCommandList.prototype.appendMaskRenderCommandRec=function(a,b,c,d,e){this.appendMaskRenderCommand(a,b,c,d,e);var f,g;for(f=0,g=b.children.length;g>f;++f)this.appendMaskRenderCommandRec(a,b.children[f],c,d,e)},Torped.RenderCommandList.prototype.createEmptyRenderCommandList=function(a){return{renderTarget:a,holesToPunch:{},depthLayers:{}}},Torped.RenderCommandList.prototype.addPunchHoleCommand=function(a,b,c,d){this.appendMaskRenderCommand(a.holesToPunch,b,d,!1,!1),this.appendMaskRenderCommand(a.depthLayers,b,d,!1,!0)},Torped.RenderCommandList.prototype.buildRenderCommandListRec=function(a,b,c,d){var e=b._opacity*c,f=b._depthSet?b.depth:d,g=a.depthLayers;if(e>0&&b.isVisible()){if(b._renderTarget&&b._renderTarget.dirty){var h=b._renderTarget;this.layoutEngine.layout(h.rootControl,!1),this.renderer.calculateCamera(h.cameraView,h.cameraProjection,h.width,h.height);var i=this.createEmptyRenderCommandList(h);this.buildRenderCommandListRec(i,h._rootControl,1,0),this.renderCommandLists.push(i)}var j,k;for(j=0,k=b._masks.length;k>j;++j)this.appendMaskRenderCommandRec(g,b._masks[j],f,b._masks[j]._maskIsPositive,!1);b.punchHole?this.addPunchHoleCommand(a,b,e,f):this.appendRenderCommand(g,b,e,f);var l=b._children;for(j=0,k=l.length;k>j;++j)this.buildRenderCommandListRec(a,l[j],e,f);for(j=0,k=b._masks.length;k>j;++j)this.appendMaskRenderCommandRec(g,b._masks[j],f,b._masks[j]._maskIsPositive,!0)}b._contentDirty=!1}}();var Torped=Torped||{};!function(){"use strict";function a(){return this._rootControl}function b(a){this._rootControl&&(this._rootControl.removeDirtyListener(this),this._rootParentControl.remove(this._rootControl)),this._rootControl=a,a&&(this._rootParentControl.add(a),a.addDirtyListener(this))}function c(){return this._rootControl?this._rootControl.contentDirty:!1}Torped.RenderTarget=function(d,e){if(e.width?this.width=e.width:e.rootControl&&(this.width=e.rootControl.width),e.height?this.height=e.height:e.rootControl&&(this.height=e.rootControl.height),!this.width||!this.height)throw new Error("Invalid dimensions. width, height or rootControl must be set");this.fbo=d.renderer.createFBO({width:this.width,height:this.height,depthBuffer:e.depthBuffer}),this.texture=this.fbo.texture,this.cameraProjection=mat4.create(),this.cameraView=mat4.create(),this._rootControl=null,this._dirtyListeners=[],this._rootParentControl=d.createControl({width:this.width,height:this.height}),Torped.Math.AABB.set(this._rootParentControl._clipRect,0,0,this.width,this.height),Object.defineProperty(this,"rootControl",{get:a,set:b}),Object.defineProperty(this,"dirty",{get:c}),e.rootControl&&(this.rootControl=e.rootControl)},Torped.RenderTarget.prototype.onControlDirtyChanged=function(a,b){for(var c=0;c<this._dirtyListeners.length;++c)this._dirtyListeners[c].onRenderTargetDirtyChanged(this,b)},Torped.RenderTarget.prototype.addDirtyListener=function(a){this._dirtyListeners.push(a)},Torped.RenderTarget.prototype.removeDirtyListener=function(a){var b=this._dirtyListeners.indexOf(a);if(-1===b)throw new Error("Listener is not added");this._dirtyListeners.splice(b,1)}}();var Torped=Torped||{};if(function(){"use strict";function a(a,b){b=b||{},this._useIgnoreList=b.hasOwnProperty("useIgnoreList")?b.useIgnoreList:!1,this._ignoreList=[],this._isEnabled=!1,this._visualRoot=null,this.core=a,this._highlight=this._createHighlight()}function b(a,b){return Torped.Math.AABB.isPointInside(a._worldBoundingBox,b)}function c(a,b,c,d,e){var f=e.width,g=e.height;a[0]=0,a[1]=0,a[2]=0,b[0]=f,b[1]=0,b[2]=0,c[0]=0,c[1]=g,c[2]=0,d[0]=f,d[1]=g,d[2]=0;var h=e._worldTransform;vec3.transformMat4(a,a,h),vec3.transformMat4(b,b,h),vec3.transformMat4(c,c,h),vec3.transformMat4(d,d,h)}function d(a,b){return c(m,n,o,p,a),q[0]=Math.min(m[0],Math.min(n[0]),Math.min(o[0],p[0])),q[1]=Math.min(m[1],Math.min(n[1]),Math.min(o[1],p[1])),r[0]=Math.max(m[0],Math.max(n[0]),Math.max(o[0],p[0])),r[1]=Math.max(m[1],Math.max(n[1]),Math.max(o[1],p[1])),b[0]>=q[0]&&b[0]<=r[0]&&b[1]>=q[1]&&b[1]<=r[1]}function e(a){return a.isVisible()&&a.width>0&&a.height>0&&(null!==a._texture||null!==a._shader||null!==a._renderTarget)}function f(a,b){if(-1!==b.indexOf(a))return!1;if(a.isVisible()===!1||0===a.width||0===a.height)return!1;if(e(a))return!0;for(var c=0;c<a.numChildren;++c)if(f(a.at(c),b))return!0;return!1}function g(a,c,h,i,j){i=a._depthSet?a.depth:i;var k=f(a,j);if(k&&b(a,c.pos)){d(a,c.pos)&&e(a)&&(void 0===h[i]&&(h[i]=[a]),h[i].push(a));for(var l=a._children,m=l.length,n=0;m>n;++n)g(l[n],c,h,i,j)}}function h(a,b){return a-b}function i(a){var b=Object.keys(a);if(0!==b.length){b.sort(h),a=a[b[b.length-1]];var c=a[a.length-1];return c}}var j=.5,k=.45,l={family:"Helvetica",size:30},m=[0,0,0],n=[0,0,0],o=[0,0,0],p=[0,0,0],q=[0,0],r=[0,0],s=Torped.Math.AABB.create();Object.defineProperties(a.prototype,{enable:{value:function(a,b){function c(a){d.core.stopAnimation(a,"foregroundOpacity"),d.core.animate({target:a,attribute:"foregroundOpacity",duration:50,to:1}),d.core.stopAnimation(a.background,"opacity"),d.core.animate({target:a.background,attribute:"opacity",duration:200,to:j})}if(!this._isEnabled){for(this._isEnabled=!0,this._visualRoot=a,this._newRoot=this.core.createControl({width:this.core.screenWidth,height:this.core.screenHeight});a.numChildren>0;)a.firstChild.touchPropagation=!1,this._newRoot.add(a.firstChild);document.body.style.cursor="pointer",this._enableHover(),a.add(this._newRoot);var d=this;this._visualRoot.onTouch=function(a){d._highlight.parent&&(d._fadeOutHighlight(d._highlight),d._highlight=d._createHighlight());var e=[];g(d._newRoot,a,e,0,d._ignoreList);var f=i(e);void 0!==f&&(void 0!==f._inspectorHighlight?(c(f._inspectorHighlight),d._highlight=f._inspectorHighlight):(d._highlight.label=f.id||null,d.core.addControl(d._highlight),f._inspectorHighlight=d._highlight,d._highlight.control=f),d._setHighlightDimensions(f)),a.isUp&&(void 0!==f&&b(f),d._useIgnoreList===!0&&void 0!==f?d._ignoreList.push(f):d.disable())}}}},disable:{value:function(){if(this._isEnabled!==!1){document.body.style.cursor="";for(var a=this;this._newRoot.numChildren>0;)a._newRoot.firstChild.touchPropagation=!0,a._visualRoot.add(a._newRoot.firstChild);this._isEnabled=!1,this._visualRoot.onTouch=null,this._highlight.parent&&(this._fadeOutHighlight(this._highlight),this._highlight=this._createHighlight()),this._disableHover(),this._ignoreList=[]}}},_fadeOutHighlight:{value:function(a){this.core.stopAnimation(a,"foregroundOpacity"),this.core.animate({target:a,attribute:"foregroundOpacity",to:0,duration:50}),this.core.stopAnimation(a.background,"opacity"),this.core.animate({target:a.background,attribute:"opacity",to:0,duration:500,onFinish:function(){a.control._inspectorHighlight=void 0,a.parent.remove(a)}})}},_enableHover:{value:function(){var a=this.core.canvas;this.mouseMoveListener=this._onMouseMove.bind(this),a.addEventListener("mousemove",this.mouseMoveListener)}},_disableHover:{value:function(){var a=this.core.canvas;a.removeEventListener("mousemove",this.mouseMoveListener)}},_onMouseMove:{value:function(a){var b=this.core.touch;b.createTouchEvent(0,b.getTouchX(a),b.getTouchY(a),0,a.timeStamp,"isMove")}},_setHighlightDimensions:{value:function(a){Torped.Math.AABB.intersection(s,a._worldBoundingBox,a._clipRect);var b=this._highlight;b.x=s.min[0],b.y=s.min[1],b.width=s.max[0]-s.min[0],b.height=s.max[1]-s.min[1]}},_createHighlight:{value:function(){var a=this.core.createControl({depth:1e6,width:0,height:0,clip:!0}),b=this.core.createControl({color:"00627f",opacity:j,fill:"parent"});a.add(b);var c=this.core.createControl({fill:"parent"});a.add(c);var d="96deff",e=2;[this.core.createControl({color:d,width:e,fill:"height"}),this.core.createControl({color:d,width:e,fill:"height",alignX:"right"}),this.core.createControl({color:d,height:e,x:e,fill:"width"}),this.core.createControl({color:d,height:e,x:e,alignY:"bottom",fill:"width"})].forEach(function(a){c.add(a)});var f=this.core.createTextControl({align:"center",font:l,color:"f3d183"}),g=this.core.createControl({align:"center",color:"000000",opacity:k});return a.add(g),a.add(f),a.background=b,Object.defineProperties(a,{label:{set:function(a){f.text=a,null!==a&&a.length>0&&(g.width=f.width+20,g.height=f.height+20)},get:function(){return f.text}},foregroundOpacity:{set:function(a){c.opacity=a,g.opacity=k*a,f.opacity=a},get:function(){return c.opacity}}}),a}}}),Torped.Inspector=a}(),!TorpedRuntime)var TorpedRuntime={addEventListener:function(){},Bluetooth:{addEventListener:function(){},startServer:function(){},connect:function(){},send:function(){},sendFile:function(){}},Device:{addEventListener:function(){},showKeyboard:function(){},hideKeyboard:function(){}},vibrate:function(){},isBrowser:!0};!function(){"use strict";window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.performance||(window.performance={}),window.performance.now||(window.performance.now=function(){return window.performance.now||window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||function(){return(new Date).getTime()}}())}();var Torped=Torped||{};!function(){"use strict";function a(a,b,c){var d=a.split(" "),e=[],f="";if(b.measureText(a).width<c)return[a];for(;d.length>0;){for(;b.measureText(d[0]).width>=c;){var g=d[0];d[0]=g.slice(0,-1),d.length>1?d[1]=g.slice(-1)+d[1]:d.push(g.slice(-1))}b.measureText(f+d[0]).width<c?f+=d.shift()+" ":(e.push(f),f=""),0===d.length&&e.push(f)}return e}function b(a){var b=a.family+" - "+a.size;if(void 0===d[b]){var c=window.devicePixelRatio||1,e=document.createElement("span");e.style.fontFamily=a.family,e.style.fontSize=c*a.size+"px",e.innerHTML="yq|";var f=document.createElement("div");f.style.display="inline-block",f.style.width="1px",f.style.height="0px";var g=document.createElement("div");g.style.display="inline-block",g.appendChild(e),g.appendChild(f),document.body.appendChild(g),f.style.verticalAlign="bottom";var h=f.offsetTop-e.offsetTop;f.style.verticalAlign="baseline";var i=f.offsetTop-e.offsetTop;document.body.removeChild(g);var j={height:h,baseline:i};d[b]=j}return d[b]}function c(a){return a.alignment===Torped.TextEngine.Alignment.Center?(a.canvasWidth-a.lineWidth)/2:a.alignment===Torped.TextEngine.Alignment.Right?a.canvasWidth-a.lineWidth:0}Torped.TextEngine=function(a){this.renderer=a},Torped.TextEngine.Alignment={Left:0,Center:1,Right:2};var d={};Torped.TextEngine.prototype.createTexture=function(d,e,f,g){function h(a){return a.split("\n")}var i=document.createElement("canvas"),j=i.getContext("2d"),k=window.devicePixelRatio||1,l=e.size*k+'px "'+e.family+'"';j.font=l,f*=k;var m=0,n=[];0===f?n=h(d):h(d).forEach(function(b){n=n.concat(a(b,j,f))});var o=[];n.forEach(function(a){var b=j.measureText(a).width;m=Math.max(m,b),o.push(b)});var p=b(e),q=void 0!==e.lineHeight?e.lineHeight*k:p.height;i.width=m,i.height=p.height+(n.length-1)*q;var r=void 0!==e.topOffset?e.topOffset:0;j.font=l,j.fillStyle="rgb(0, 0, 0)",n.forEach(function(a,b){var d=o[b],e=c({alignment:g,lineWidth:d,canvasWidth:m});j.fillText(a,e,p.baseline+r+b*q)});var s=this.renderer.createTexture({canvas:i});return s};var e=document.createElement("canvas");Torped.TextEngine.prototype.getCharacterPosition=function(c){function d(){for(var a=0;-1!==(a=h.indexOf("\n",a))&&i>a;)i--;return h.split("\n")}var f=c.font,g=c.maxWidth||0,h=c.text,i=c.characterIndex||h.length-1;
if(i>=h.length||0>i)return{x:0,y:0};var j=f.size+"px "+f.family,k=e.getContext("2d");k.font=j;var l=[];0===g?l=d():d().forEach(function(b){l=l.concat(a(b,k,g))});var m=b(f),n=void 0!==f.lineHeight?f.lineHeight:m.height,o=void 0!==f.topOffset?f.topOffset:0,p=0,q=0,r=0;l.some(function(a,b){return q+=a.length,q>i?(p=b,!0):(r+=a.length,!1)});var s=i-r,t=k.measureText(l[p].substr(0,s+1)).width,u=o+p*n;return{x:t,y:u}}}();var Torped=Torped||{};!function(){"use strict";Torped.Timer=function(a,b){this.delay=b.delay||0,this.duration=b.duration||0,this._isRunning=!1,this._hasCalledOnStart=!1,this.scheduler=a;for(var c in b)this[c]=b[c];this.repeatCount=void 0!==b.repeatCount?b.repeatCount:1},Torped.Timer.prototype.start=function(){return this._isRunning&&this.stop(),this.scheduler.scheduleTimer(this),this},Torped.Timer.prototype.stop=function(){this.scheduler.stopTimer(this),this._hasCalledOnStart=!1,this._isRunning=!1,this._wasStopped=!0,this._isPaused=!1},Torped.Timer.prototype.pause=function(){this._isPaused=!0,this.scheduler.pauseTimer(this)},Torped.Timer.prototype.resume=function(){this._isPaused=!1,this.scheduler.resumeTimer(this)}}();var Torped=Torped||{};!function(){"use strict";Torped.TimerScheduler=function(a){this.requestFrame=a,this.runningTimers=[],this.newTimers=[],this.pausedTimers=[]},Torped.TimerScheduler.prototype.createTimer=function(a){var b=new Torped.Timer(this,a);return b},Torped.TimerScheduler.prototype.scheduleTimer=function(a){-1===this.newTimers.indexOf(a)&&(0===a.repeatCount&&(a.repeatCount=1e5),this.newTimers.push(a),this.requestFrame())},Torped.TimerScheduler.prototype.stopTimer=function(a){var b;a._isRunning?(b=this.runningTimers.indexOf(a),-1!==b&&this.runningTimers.splice(b,1),b=this.pausedTimers.indexOf(a),-1!==b&&this.pausedTimers.splice(b,1),a.onStop&&!a._wasStopped&&a.onStop()):(b=this.newTimers.indexOf(a),-1!==b&&this.newTimers.splice(b,1))},Torped.TimerScheduler.prototype.pauseTimer=function(){this.requestFrame()},Torped.TimerScheduler.prototype.resumeTimer=function(){this.requestFrame()},Torped.TimerScheduler.prototype.runTimers=function(a){var b,c,d,e=[],f=[],g=[];for(c=this.pausedTimers.length,b=0;c>b;++b)g[b]=this.pausedTimers[b];for(b=0;c>b;++b)if(d=g[b],!d._isPaused){var h=this.pausedTimers.indexOf(d);-1!==h&&this.pausedTimers.splice(h,1),d._start=a-(d._pauseTime-d._start),this.runningTimers.push(d)}for(c=this.runningTimers.length,b=0;c>b;++b)g[b]=this.runningTimers[b];for(b=0;c>b;++b)if(d=g[b],d._isPaused)this.pausedTimers.push(d),d._pauseTime=a;else if(d&&a>=d._start){d._hasCalledOnStart===!1&&d.onStart&&(d.onStart(),d._hasCalledOnStart=!0);var i;i=d.duration>0?(a-d._start)/(d.duration*d.repeatCount):1;var j=i*d.repeatCount-Math.floor(i*d.repeatCount);i>=1&&(j=1),d.onRunning&&d.onRunning(j),1>i&&d._isRunning?e.push(d):d._wasStopped||f.push(d)}else e.push(d);for(this.runningTimers=e,b=0;b<f.length;++b)f[b]._isRunning=!1,f[b]._hasCalledOnStart=!1,f[b].onFinish&&f[b].onFinish();if(this.newTimers.length>0){for(b=0;b<this.newTimers.length;++b)d=this.newTimers[b],d._start=a+d.delay,d._isRunning=!0,d._wasStopped=!1,this.runningTimers.push(d),0===d.delay&&(d.onStart&&(d.onStart(),d._hasCalledOnStart=!0),d.onRunning&&d.onRunning(0));this.newTimers.length=0}},Torped.TimerScheduler.prototype.hasPendingTimers=function(){return this.runningTimers.length>0||this.newTimers.length>0}}();var Torped=Torped||{};!function(){"use strict";function a(a,b){return a-b}function b(a){for(var b=0,c=a.length;c>b;++b)null!==a[b].onTouch&&a[b].onTouch(h)}function c(a,b){var c=Torped.Math.AABB.isPointInside(a._worldBoundingBox,b);if(c===!1)return!1;for(var e=0,f=a._masks,g=0;g<f.length;g++){var h=f[g];d(h,b)&&(h._maskIsPositive?e++:e--)}return e>=0}function d(a,b){Torped.Math.transformBox(j,k,l,m,Torped.Math.AABB.width(a._localBoundingBox),Torped.Math.AABB.height(a._localBoundingBox),a._worldTransform);var c=Math.min(j[0],Math.min(k[0],Math.min(l[0],m[0]))),d=Math.max(j[0],Math.max(k[0],Math.max(l[0],m[0]))),e=Math.min(j[1],Math.min(k[1],Math.min(l[1],m[1]))),f=Math.max(j[1],Math.max(k[1],Math.max(l[1],m[1])));return b[0]>=c&&b[0]<=d&&b[1]>=e&&b[1]<=f}function e(a,b,f,g){if(g=a._depthSet?a.depth:g,a.touchPropagation&&a.visible&&a.opacity>0&&c(a,b.pos)){if((a.onTouch||a.blockTouch)&&d(a,b.pos)&&(a.blockTouch&&(f[g]=[],i=Math.max(i,g)),a.onTouch&&(void 0===f[g]&&(f[g]=[a]),f[g].push(a))),a._renderTarget&&a._renderTarget.rootControl){var h=a._renderTarget.width/(a.scaleX*a.width),j=a._renderTarget.height/(a.scaleY*a.height),k=b.pos[0],l=b.pos[1];b.pos[0]=(k-a.worldX)*h,b.pos[1]=(l-a.worldY)*j,e(a._renderTarget.rootControl,b,f,g),b.pos[0]=k,b.pos[1]=l}for(var m=a._children,n=m.length,o=0;n>o;++o)e(m[o],b,f,g)}}function f(){return{pos:[0,0],delta:[0,0],deltaTime:0,type:"isMove",isMove:!1,isUp:!1,isDown:!1,isEnter:!1,isExit:!1,id:0}}var g=f();g.type="isEnter",g.isEnter=!0;var h=f();h.type="isExit",h.isExit=!0,Torped.Touch=function(a,b,c,d,e){this.screenWidth=c,this.screenHeight=d,this.canvas=a,this.requestFrame=b,this.numTouchEvents=0,this.trackedControls=[],this.mouseDown=!1,this.lastTouch=[],this.queuedTouchEvents=[],this.prevIntersectedControlsDepthLayers={},this.depthIndices=[],this.numDepthIndices=0,this._eventQueuedCallback=e;var f=this;a.addEventListener("mousemove",function(a){a.preventDefault(),f.mouseDown===!0&&f.createTouchEvent(0,f.getTouchX(a),f.getTouchY(a),0,a.timeStamp,"isMove",a)}),a.addEventListener("touchmove",function(a){f.handleRawEventWithType(a,"isMove")}),a.addEventListener("touchleave",function(a){f.handleRawEventWithType(a,"isUp")}),a.addEventListener("touchend",function(a){f.handleRawEventWithType(a,"isUp")}),a.addEventListener("mouseup",function(a){a.preventDefault(),f.mouseDown=!1,f.createTouchEvent(0,f.getTouchX(a),f.getTouchY(a),a.force,a.timeStamp,"isUp",a)}),a.addEventListener("mouseout",function(a){a.preventDefault(),f.mouseDown&&(f.mouseDown=!1,f.createTouchEvent(0,f.getTouchX(a),f.getTouchY(a),a.force,a.timeStamp,"isUp",a))}),a.addEventListener("touchstart",function(a){f.handleRawEventWithType(a,"isDown")}),a.addEventListener("mousedown",function(a){a.preventDefault(),f.mouseDown=!0,f.createTouchEvent(0,f.getTouchX(a),f.getTouchY(a),a.force,a.timeStamp,"isDown",a)})},Torped.Touch.prototype.getTouchX=function(a){var b=window.devicePixelRatio||1,c=this.canvas.scrollWidth||this.canvas.width/b,d=a.pageX-this.canvas.offsetLeft;return d/c*this.screenWidth},Torped.Touch.prototype.getTouchY=function(a){var b=window.devicePixelRatio||1,c=this.canvas.scrollHeight||this.canvas.height/b,d=a.pageY-this.canvas.offsetTop;return d/c*this.screenHeight},Torped.Touch.prototype.handleRawEventWithType=function(a,b){a.preventDefault();for(var c=0;c<a.changedTouches.length;++c){var d=a.changedTouches[c];this.createTouchEvent(d.identifier,this.getTouchX(d),this.getTouchY(d),d.force,a.timeStamp,b,a)}},Torped.Touch.prototype.setEventQueuedCallback=function(a){this._eventQueuedCallback=a},Torped.Touch.prototype.hasPendingEvents=function(){return this.numTouchEvents>0},Torped.Touch.prototype.handleEvents=function(a){for(var b=0;b<this.numTouchEvents;++b)this.handleTouchEvent(a,this.queuedTouchEvents[b]);this.numTouchEvents=0},Torped.Touch.prototype._stopTrackingControl=function(a){for(var b in this.trackedControls)if(this.trackedControls[b]===a){this.trackedControls[b]=null;break}},Torped.Touch.prototype.onControlRemoved=function(a){this._stopTrackingControl(a)},Torped.Touch.prototype.handleTouchEvent=function(c,d){var f=d.id,j=this.lastTouch[f];j||(this.lastTouch[f]={pos:[0,0],time:0},j=this.lastTouch[f]),d.isMove&&(d.delta[0]=d.pos[0]-j.pos[0],d.delta[1]=d.pos[1]-j.pos[1],d.deltaTime=d.time-j.time),j.time=d.time,j.pos[0]=d.pos[0],j.pos[1]=d.pos[1];var k={0:[]};this.trackedControls[d.id]?k[0].push(this.trackedControls[d.id]):(i=-1e7,e(c,d,k,c.depth)),g.id=d.id,g.pos[0]=d.pos[0],g.pos[1]=d.pos[1],g.delta[0]=d.delta[0],g.delta[1]=d.delta[1],g.deltaTime=d.deltaTime,g.force=d.force,g.domEvent=d.domEvent,h.id=d.id,h.pos[0]=d.pos[0],h.pos[1]=d.pos[1],h.delta[0]=d.delta[0],h.delta[1]=d.delta[1],h.deltaTime=d.deltaTime,h.force=0,h.domEvent=d.domEvent;var l,m,n,o,p,q,r=!0;this.numDepthIndices=0;for(q in k)q>=i&&(this.depthIndices[this.numDepthIndices++]=q);for(this.depthIndices.length=this.numDepthIndices,this.depthIndices.sort(a),o=this.numDepthIndices-1;o>=0&&r;--o)for(n=this.depthIndices[o],p=k[n],l=p.length-1;l>=0;--l){var s=p[l],t=!1;for(m in this.prevIntersectedControlsDepthLayers){var u=this.prevIntersectedControlsDepthLayers[m].indexOf(s);if(-1!==u){t=!0,this.prevIntersectedControlsDepthLayers[m].splice(u,1);break}}t===!1&&s.onTouch(g);var v=s.onTouch(d);if(v===Torped.Touch.StartTracking){this.trackedControls[d.id]=s,r=!1;break}if(this.trackedControls[d.id]=null,v===Torped.Touch.StopPropagation){r=!1;break}void 0!==v&&console.log("unknown return value from from onTouch "+v)}if(d.isUp)for(o=this.numDepthIndices-1;o>=0;--o)n=this.depthIndices[o],p=k[n],b(p),this.prevIntersectedControlsDepthLayers={};else{this.numDepthIndices=0;for(q in this.prevIntersectedControlsDepthLayers)this.depthIndices[this.numDepthIndices++]=q;for(this.depthIndices.length=this.numDepthIndices,this.depthIndices.sort(),o=this.numDepthIndices-1;o>=0;--o)n=this.depthIndices[o],p=this.prevIntersectedControlsDepthLayers[n],b(p);this.prevIntersectedControlsDepthLayers=k}},Torped.Touch.prototype.createTouchEvent=function(a,b,c,d,e,g,h){this.queuedTouchEvents.length===this.numTouchEvents&&this.queuedTouchEvents.push(f());var i=e,j=this.queuedTouchEvents[this.numTouchEvents];void 0!==this._eventQueuedCallback&&this._eventQueuedCallback({id:a,x:b,y:c,force:d,timestamp:e,type:g,domEvent:h}),j.pos[0]=b,j.pos[1]=c,j.delta[0]=0,j.delta[1]=0,j.time=i,j[j.type]=!1,j.type=g,j[g]=!0,j.id=a,j.force=d,j.domEvent=h,++this.numTouchEvents,this.requestFrame()},Torped.Touch.StartTracking=1,Torped.Touch.StopPropagation=2;var i,j=[0,0],k=[0,0],l=[0,0],m=[0,0]}();var Torped=Torped||{};!function(){"use strict";function a(a){this._currentMode=m.Idle,h=a.core}function b(a){h.createTimer({duration:1,onFinish:a}).start()}function c(a){var b;for(b=a;b<k.length&&"frame"!==k[b].eventType;b++);return b===k.length?void 0:b}function d(a){"touch"===a.eventType?h.touch.createTouchEvent(a.id,a.x,a.y,a.force,a.timestamp,a.type):"frame"===a.eventType&&(h.currentFrameTime=a.timestamp,h.processInput(),h.processTimers(),h.layoutFrame(),h.renderFrame())}function e(a){for(;l!==a;)a>l?l++:l--,d(k[l])}function f(a){function d(){if(!i){var a=c(l+1);void 0!==a&&(e(a),j.setPosition(a/k.length));var b=c(a+1);void 0!==a&&void 0!==b&&setTimeout(d,b.timestamp-a.timestamp)}}a?(i=!1,b(d)):i=!0}function g(){function a(a){var b,c;if(b=h.createControl({width:o/3,height:o/3*2,align:"center",clip:"play"===a}),"play"===a){var d=Math.cos(Math.PI/4)*b.width;b.add(h.createControl({color:n,width:2*d,height:2*d,rz:Math.PI/4,x:-d,alignY:"center"}))}else for(c=0;2>c;c++)b.add(h.createControl({color:n,width:5,height:o/2,alignY:"center",x:0===c?0:b.width-5}));return b}function d(b,c){var d=h.createControl({width:o,height:o}),e=h.createControl({fill:"parent",color:i,opacity:.5});d.add(e);for(var f=0;4>f;f++)d.add(h.createControl({color:n,width:2>f?o:3,height:2>f?3:o,x:3===f?o-3:0,y:1===f?o-3:0}));var g=a(b);if(d.add(g),"play"===b){var j=a("pause");d.add(j),j.visible=!1}return d.onTouch=function(a){return a.isEnter&&(e.opacity=1),a.isExit&&(e.opacity=.5),a.isUp&&(c(),"play"===b&&(g.visible=!g.visible,j.visible=!j.visible)),Torped.Touch.StopPropagation},d}function g(a,b){var c=h.createControl({width:a,height:o}),d=h.createControl({fill:"parent",color:i,opacity:.5});c.add(d);var e=h.createControl({width:c.width-o,height:4,x:o/2,alignY:"center",color:n});c.add(e);var f=h.createControl({width:8,height:o-8,x:e.x,alignY:"center",color:n});return c.add(f),f.onTouch=function(a){if(a.isMove){f.x+=a.delta[0];var c=l/k.length*(e.width-f.width);f.x=Torped.Math.clamp(e.x+c,e.x+e.width-f.width,f.x)}return a.isUp&&b((f.x-e.x)/(e.width-f.width)),a.isMove||a.isEnter||a.isDown?Torped.Touch.StartTracking:void 0},c.onTouch=function(){return Torped.Touch.StopPropagation},c.setPosition=function(a){f.x=e.x+(e.width-f.width)*a},c}var i="00627f",n="96deff",o=h.screenHeight/10,p=h.createControl({y:h.screenHeight-o,height:o,fill:"width"}),q=!1,r=d("play",function(){q=!q,f(q)});p.add(r);var s=g(h.screenWidth-o,function(a){var d=Math.floor(a*k.length);if(d>l){var f=c(d);void 0!==f&&b(e.bind(null,f))}});return s.x=o,p.add(s),p.setPosition=s.setPosition,p.onKey=function(a){var d=27,g=32;if(a.keyCode===d)f(!1),h.removeControl(j),this._currentMode=m.Idle,console.log("EventRecorder - Exit playback mode");else if(a.keyCode===g&&!q){var i=c(l+1);void 0!==i&&(b(e.bind(null,i)),s.setPosition(i/k.length))}},p}Torped.EventRecorder=a;var h,i,j,k=[],l=0;Object.defineProperties(a.prototype,{addRenderedFrame:{value:function(a){k.push({eventType:"frame",timestamp:a})}},addTouchEvent:{value:function(a){k.push({eventType:"touch",id:a.id,x:a.x,y:a.y,force:a.force,timestamp:a.timestamp,type:a.type})}},mode:{get:function(){return this._currentMode}},startRecording:{value:function(){k=[],this._currentMode=m.Recording,console.log("EventRecorder - Starting recording")}},stopRecording:{value:function(){console.log("EventRecorder - Log start"),console.log(JSON.stringify(k)),console.log("EventRecorder - Log end"),this._currentMode=m.Idle}},startPlayback:{value:function(){console.log("EventRecorder - Starting playback"),this._currentMode=m.Playback,l=-1,j=g(),h.addControl(j)}},playExternalLog:{value:function(a){k=a,this.startPlayback()}},jumpToPosition:{value:function(a){var d=c(a);void 0!==d&&(b(e.bind(null,d)),j.setPosition(d/k.length))}}});var m={Idle:0,Recording:1,Playback:2};Torped.EventRecorderMode=m}(),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Application=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){!function(b){"object"==typeof d?c.exports=b():"function"==typeof a&&a.amd?a([],b):window.BezierEasing=b()}(function(){function a(a,b){return 1-3*b+3*a}function b(a,b){return 3*b-6*a}function c(a){return 3*a}function d(d,e,f){return((a(e,f)*d+b(e,f))*d+c(e))*d}function e(d,e,f){return 3*a(e,f)*d*d+2*b(e,f)*d+c(e)}function f(a,b,c,e,f){var g,h,i=0;do h=b+(c-b)/2,g=d(h,e,f)-a,g>0?c=h:b=h;while(Math.abs(g)>k&&++i<l);return h}function g(a,b,c,g){function h(b,f){for(var g=0;i>g;++g){var h=e(f,a,c);if(0===h)return f;var j=d(f,a,c)-b;f-=j/h}return f}function k(){for(var b=0;m>b;++b)r[b]=d(b*n,a,c)}function l(b){for(var d=0,g=1,i=m-1;g!=i&&r[g]<=b;++g)d+=n;--g;var k=(b-r[g])/(r[g+1]-r[g]),l=d+k*n,o=e(l,a,c);return o>=j?h(b,l):0===o?l:f(b,d,d+n,a,c)}function p(){s=!0,(a!=b||c!=g)&&k()}if(4!==arguments.length)throw new Error("BezierEasing requires 4 arguments.");for(var q=0;4>q;++q)if("number"!=typeof arguments[q]||isNaN(arguments[q])||!isFinite(arguments[q]))throw new Error("BezierEasing arguments should be integers.");if(0>a||a>1||0>c||c>1)throw new Error("BezierEasing x values must be in [0, 1] range.");var r=o?new Float32Array(m):new Array(m),s=!1,t=function(e){return s||p(),a===b&&c===g?e:0===e?0:1===e?1:d(l(e),b,g)};t.getControlPoints=function(){return[{x:a,y:b},{x:c,y:g}]};var u=[a,b,c,g],v="BezierEasing("+u+")";t.toString=function(){return v};var w="cubic-bezier("+u+")";return t.toCSS=function(){return w},t}var h=this,i=4,j=.001,k=1e-7,l=10,m=11,n=1/(m-1),o="Float32Array"in h;return g.css={ease:g(.25,.1,.25,1),linear:g(0,0,1,1),"ease-in":g(.42,0,1,1),"ease-out":g(0,0,.58,1),"ease-in-out":g(.42,0,.58,1)},g})},{}],2:[function(a,b,c){var d,e=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},f=Error;!function(a){function b(a,c){switch(typeof a){case"undefined":case"boolean":case"string":case"number":return a===c;case"object":if(null===a)return null===c;if(F(a)){if(!F(c)||a.length!==c.length)return!1;for(var d=0,e=a.length;e>d;d++)if(!b(a[d],c[d]))return!1;return!0}var f=x(c),g=f.length;if(x(a).length!==g)return!1;for(var d=0;g>d;d++)if(!b(a[d],c[d]))return!1;return!0;default:return!1}}function c(a){return-1===a.indexOf("/")&&-1===a.indexOf("~")?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function d(a,b){var e;for(var f in a)if(a.hasOwnProperty(f)){if(a[f]===b)return c(f)+"/";if("object"==typeof a[f]&&(e=d(a[f],b),""!=e))return c(f)+"/"+e}return""}function g(a,b){if(a===b)return"/";var c=d(a,b);if(""===c)throw new f("Object not found in root");return"/"+c}function h(a){for(var b=0,c=C.length;c>b;b++)if(C[b].obj===a)return C[b]}function i(a,b){for(var c=0,d=a.observers.length;d>c;c++)if(a.observers[c].callback===b)return a.observers[c].observer}function j(a,b){for(var c=0,d=a.observers.length;d>c;c++)if(a.observers[c].observer===b)return void a.observers.splice(c,1)}function k(a,b){p(b),Object.observe?o(b,a):clearTimeout(b.next);var c=h(a);j(c,b)}function l(a){return"object"==typeof a?JSON.parse(JSON.stringify(a)):a}function m(a,b){var c,d=[],e=a,j=h(a);if(j?c=i(j,b):(j=new D(a),C.push(j)),c)return c;if(Object.observe)c=function(f){o(c,a),n(c,a);for(var h=0,i=f.length;i>h;)"length"===f[h].name&&F(f[h].object)||"__Jasmine_been_here_before__"===f[h].name||B[f[h].type].call(f[h],d,g(e,f[h].object)),h++;d&&b&&b(d),c.patches=d,d=[]};else if(c={},j.value=l(a),b){c.callback=b,c.next=null;var k=this.intervals||[100,1e3,1e4,6e4];if(void 0===k.push)throw new f("jsonpatch.intervals must be an array");var m=0,q=function(){p(c)},r=function(){clearTimeout(c.next),c.next=setTimeout(function(){q(),m=0,c.next=setTimeout(s,k[m++])},0)},s=function(){q(),m==k.length&&(m=k.length-1),c.next=setTimeout(s,k[m++])};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mousedown",r),window.addEventListener("mouseup",r),window.addEventListener("keydown",r)):(document.documentElement.attachEvent("onmousedown",r),document.documentElement.attachEvent("onmouseup",r),document.documentElement.attachEvent("onkeydown",r))),c.next=setTimeout(s,k[m++])}return c.patches=d,c.object=a,j.observers.push(new E(b,c)),n(c,a)}function n(a,b){if(Object.observe){Object.observe(b,a);for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&"object"==typeof d&&n(a,d)}}return a}function o(a,b){if(Object.observe){Object.unobserve(b,a);for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&"object"==typeof d&&o(a,d)}}return a}function p(a){if(Object.observe)Object.deliverChangeRecords(a);else{for(var b,c=0,d=C.length;d>c;c++)if(C[c].obj===a.object){b=C[c];break}q(b.value,a.object,a.patches,""),a.patches.length&&s(b.value,a.patches)}var e=a.patches;return e.length>0&&(a.patches=[],a.callback&&a.callback(e)),e}function q(a,b,d,e){for(var f=x(b),g=x(a),h=!1,i=!1,j=g.length-1;j>=0;j--){var k=g[j],m=a[k];if(b.hasOwnProperty(k)){var n=b[k];"object"==typeof m&&null!=m&&"object"==typeof n&&null!=n?q(m,n,d,e+"/"+c(k)):m!=n&&(h=!0,d.push({op:"replace",path:e+"/"+c(k),value:l(n)}))}else d.push({op:"remove",path:e+"/"+c(k)}),i=!0}if(i||f.length!=g.length)for(var j=0;j<f.length;j++){var k=f[j];a.hasOwnProperty(k)||d.push({op:"add",path:e+"/"+c(k),value:l(b[k])})}}function r(a){for(var b,c=0,d=a.length;d>c;){b=a.charCodeAt(c);{if(!(b>=48&&57>=b))return!1;c++}}return!0}function s(a,b,c){for(var d,e,f=!1,g=0,h=b.length;h>g;){d=b[g],g++;for(var i=d.path||"",j=i.split("/"),k=a,l=1,m=j.length,n=void 0;;){if(e=j[l],c&&void 0===n&&(void 0===k[e]?n=j.slice(0,l).join("/"):l==m-1&&(n=d.path),void 0!==n&&this.validator(d,g-1,a,n)),l++,void 0===e&&l>=m){f=A[d.op].call(d,k,e,a);break}if(F(k)){if("-"===e)e=k.length;else{if(c&&!r(e))throw new G("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",g-1,d.path,d);e=parseInt(e,10)}if(l>=m){if(c&&"add"===d.op&&e>k.length)throw new G("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",g-1,d.path,d);f=z[d.op].call(d,k,e,a);break}}else if(e&&-1!=e.indexOf("~")&&(e=e.replace(/~1/g,"/").replace(/~0/g,"~")),l>=m){f=y[d.op].call(d,k,e,a);break}k=k[e]}}return f}function t(a,b){var c=[];return q(a,b,c,""),c}function u(a){if(void 0===a)return!0;if("array"==typeof a||"object"==typeof a)for(var b in a)if(u(a[b]))return!0;return!1}function v(b,c,d,e){if("object"!=typeof b||null===b||F(b))throw new G("Operation is not an object","OPERATION_NOT_AN_OBJECT",c,b,d);if(!y[b.op])throw new G("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",c,b,d);if("string"!=typeof b.path)throw new G("Operation `path` property is not a string","OPERATION_PATH_INVALID",c,b,d);if(("move"===b.op||"copy"===b.op)&&"string"!=typeof b.from)throw new G("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",c,b,d);if(("add"===b.op||"replace"===b.op||"test"===b.op)&&void 0===b.value)throw new G("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",c,b,d);if(("add"===b.op||"replace"===b.op||"test"===b.op)&&u(b.value))throw new G("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",c,b,d);if(d)if("add"==b.op){var f=b.path.split("/").length,g=e.split("/").length;if(f!==g+1&&f!==g)throw new G("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",c,b,d)}else if("replace"===b.op||"remove"===b.op||"_get"===b.op){if(b.path!==e)throw new G("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",c,b,d)}else if("move"===b.op||"copy"===b.op){var h={op:"_get",path:b.from,value:void 0},i=a.validate([h],d);if(i&&"OPERATION_PATH_UNRESOLVABLE"===i.name)throw new G("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",c,b,d)}}function w(a,b){try{if(!F(a))throw new G("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(b)b=JSON.parse(JSON.stringify(b)),s.call(this,b,a,!0);else for(var c=0;c<a.length;c++)this.validator(a[c],c)}catch(d){if(d instanceof G)return d;throw d}}if(!a.observe){var x=function(){return Object.keys?Object.keys:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}}(),y={add:function(a,b){return a[b]=this.value,!0},remove:function(a,b){return delete a[b],!0},replace:function(a,b){return a[b]=this.value,!0},move:function(a,b,c){var d={op:"_get",path:this.from};return s(c,[d]),s(c,[{op:"remove",path:this.from}]),s(c,[{op:"add",path:this.path,value:d.value}]),!0},copy:function(a,b,c){var d={op:"_get",path:this.from};return s(c,[d]),s(c,[{op:"add",path:this.path,value:d.value}]),!0},test:function(a,c){return b(a[c],this.value)},_get:function(a,b){this.value=a[b]}},z={add:function(a,b){return a.splice(b,0,this.value),!0},remove:function(a,b){return a.splice(b,1),!0},replace:function(a,b){return a[b]=this.value,!0},move:y.move,copy:y.copy,test:y.test,_get:y._get},A={add:function(a){A.remove.call(this,a);for(var b in this.value)this.value.hasOwnProperty(b)&&(a[b]=this.value[b]);return!0},remove:function(a){for(var b in a)a.hasOwnProperty(b)&&y.remove.call(this,a,b);return!0},replace:function(a){return s(a,[{op:"remove",path:this.path}]),s(a,[{op:"add",path:this.path,value:this.value}]),!0},move:y.move,copy:y.copy,test:function(a){return JSON.stringify(a)===JSON.stringify(this.value)},_get:function(a){this.value=a}},B={add:function(a,b){var d={op:"add",path:b+c(this.name),value:this.object[this.name]};a.push(d)},"delete":function(a,b){var d={op:"remove",path:b+c(this.name)};a.push(d)},update:function(a,b){var d={op:"replace",path:b+c(this.name),value:this.object[this.name]};a.push(d)}},C=[];a.intervals;var D=function(){function a(a){this.observers=[],this.obj=a}return a}(),E=function(){function a(a,b){this.callback=a,this.observer=b}return a}();a.unobserve=k,a.observe=m,a.generate=p;var F;F=Array.isArray?Array.isArray:function(a){return a.push&&"number"==typeof a.length},a.apply=s,a.compare=t;var G=function(a){function b(b,c,d,e,f){a.call(this,b),this.message=b,this.name=c,this.index=d,this.operation=e,this.tree=f}return e(b,a),b}(f);a.JsonPatchError=G,a.Error=G,a.validator=v,a.validate=w}}(d||(d={})),"undefined"!=typeof c&&(c.apply=d.apply,c.observe=d.observe,c.unobserve=d.unobserve,c.generate=d.generate,c.compare=d.compare,c.validate=d.validate,c.validator=d.validator,c.JsonPatchError=d.JsonPatchError,c.Error=d.Error)},{}],3:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],4:[function(a,b,c){"use strict";function d(b){[a("./nodes/visual/group"),a("./nodes/visual/image"),a("./nodes/visual/rectangle"),a("./nodes/visual/circle"),a("./nodes/visual/text"),a("./nodes/visual/stacklayout"),a("./nodes/visual/flowlayout"),a("./nodes/visual/scrollview"),a("./nodes/counter"),a("./nodes/expression"),a("./nodes/and"),a("./nodes/or"),a("./nodes/switch"),a("./nodes/numberblend"),a("./nodes/stringselector"),a("./nodes/drag"),a("./nodes/inverter"),a("./nodes/timer"),a("./nodes/velocity"),a("./nodes/variables/number"),a("./nodes/variables/string"),a("./nodes/variables/boolean"),a("./nodes/variables/color"),a("./nodes/touchposition"),a("./nodes/renderinimage"),a("./nodes/signaltoindex"),a("./nodes/substring"),a("./nodes/gyroscope"),a("./nodes/reload"),a("./nodes/colorblend"),a("./nodes/globals"),a("./nodes/eventsender"),a("./nodes/eventreceiver"),a("./nodes/screenresolution"),a("./nodes/javascript"),a("./nodes/javascript2"),a("./nodes/animation"),a("./nodes/transition"),a("./nodes/numberremapper"),a("./nodes/websocket"),a("./nodes/componentinputs"),a("./nodes/componentoutputs"),a("./nodes/inputstoobject"),a("./nodes/valuechanged")].forEach(function(a){b.register(a)})}function e(a){var b=this;a=a||{},e.instance=this,this.frameScheduled=!1,this.rootComponent=null,this._currentLoadedData=null,this.runningInEditor=!0,this.fontCssFamiliesAdded={},this.loadedFontFamilies={},["Arial","Arial Black","Courier New","Helvetica","Impact","Lucida Console","Tahoma","Times New Roman"].forEach(function(a){b.loadedFontFamilies[a]=!0}),this.editorWebSocket=void 0,a.runStandalone===!0&&(this.runningInEditor=!1),this.editorConnection=new k,this.supportsSuperSampling=a.hasOwnProperty("useSuperSampling")?a.useSuperSampling:this.editorConnection.isRunningLocally(),this.isUsingSuperSampling=!1,this.editorConnection.eventEmitter.on("exportDataFull",function(a){b.patchExportData(a)===!1&&b.setData(a)}),this.editorConnection.eventEmitter.on("exportDataDiff",function(a){return b._currentLoadedData?void b.applyDataDiff(a):void b.editorConnection.requestFullExport()}),this.editorConnection.eventEmitter.on("hoverStart",function(a){b.rootComponent&&b.highlighter.highlightNodesWithId(b.rootComponent.nodeScope,a,!0)}),this.editorConnection.eventEmitter.on("hoverEnd",function(a){b.rootComponent&&b.highlighter.highlightNodesWithId(b.rootComponent.nodeScope,a,!1)}),this.editorConnection.eventEmitter.on("reload",this.reload.bind(this)),this.editorConnection.eventEmitter.on("inspectStart",function(){b.enableInspector(function(a){b.editorConnection.sendInspectId(a)})}),this.editorConnection.eventEmitter.on("inspectEnd",this.disableInspector.bind(this)),this.context=new j({runningInEditor:this.runningInEditor,editorConnection:this.editorConnection}),this.editorConnection.isRunningLocally()&&(this.context.setOutputCollectionEnabled(!0),this.editorConnection.eventEmitter.on("connected",function(){b.editorConnection.send({cmd:"nodelibrary",type:"viewer",content:b.getNodeLibrary()})})),this.editorConnection.eventEmitter.on("debuggingEnabledChanged",this.context.setOutputCollectionEnabled.bind(this.context)),this.context.eventEmitter.on("scheduleFrame",this.scheduleFrame.bind(this)),this.context.eventEmitter.on("sendDynamicPortsToEditor",this.editorConnection.sendDynamicPorts.bind(this.editorConnection)),this.context.eventEmitter.on("reloadApplication",this.reload.bind(this)),
this.context.eventEmitter.on("callWhenFontIsActive",this.callWhenFontIsActive.bind(this)),this.torpedArgs={portrait:{width:1080,height:1920},renderSizeSameAsVirtualSize:!1,useKeyHandler:!1,resizeCanvasBufferWithDelay:this.editorConnection.isRunningLocally()},a.canvas&&(this.torpedArgs.canvas=a.canvas),f.instance=f.Core.create(this.torpedArgs);var c=f.instance;c.setScrollThreshold(20);var g=c.canvas;g.addEventListener("webglcontextlost",function(){document.location.reload()},!1),c.externalMainLoop=!0,c.addEventListener("frameRequested",function(){b.rootComponent&&b.scheduleFrame()}),c.addEventListener("canvasResized",function(){b.isUsingSuperSampling&&b.setupSupersampling()}),d(this.context.nodeRegister),this._resetData()}var f=a("./torpedwrapper"),g=(a("events").EventEmitter,a("./highlighter")),h=(a("./node"),a("fast-json-patch")),i=a("./liveupdate"),j=(a("./noderegister"),a("./nodecontext")),k=a("./editorconnection"),l=a("./javascriptnodeparser"),m=a("./nodelibraryexport"),n=a("./projectpatchers");e.prototype.reload=function(){this._currentLoadedData&&(this._resetData(),this.setData(this._currentLoadedData))},e.prototype._resetData=function(){var a=f.instance;this.highlighter=new g,a.timerScheduler.runningTimers=[],a.timerScheduler.newTimers=[],a._root.clear(),a.renderCommandList.renderCommandLists=[],a.renderCommandList.numRenderCommands=0,this.frameNumber=0,this.rootComponent=null,this.fontCallbacks={},this.currentNumMipmaps=0,this._currentLoadedData=null,this.context.reset()},e.prototype.registerNode=function(a){this.context.nodeRegister.register(a)},e.prototype._loadFonts=function(a){for(var b=/"fontFamily":"([^"\.]*\.(otf|ttf))"/gi,c=JSON.stringify(a),d=[],e=b.exec(c);null!==e;){var f=e[1].replace(/\.[^\/.]+$/,"");f=f.split("/").pop(),this.fontCssFamiliesAdded[f]||(this.fontCssFamiliesAdded[f]=!0,d.push({family:f,url:e[1]})),e=b.exec(c)}var g=d.map(function(a){return a.family}),h=this;d.forEach(function(a){var b=document.createElement("style");b.type="text/css";var c=a.url;h.runningInEditor&&"/"!==c[0]&&(c="/"+c),b.appendChild(document.createTextNode("                    @font-face {                        font-family: '"+a.family+"';                        src: url('"+c+"');                    }                ")),document.head.appendChild(b)}),WebFont.load({custom:{families:g},fontactive:function(a){h.loadedFontFamilies[a]=!0,h.fontCallbacks[a]&&h.fontCallbacks[a].forEach(function(a){a()})}})},e.prototype.callWhenFontIsActive=function(a,b){return a=a.replace(/\.[^\/.]+$/,""),a=a.split("/").pop(),this.loadedFontFamilies[a]?void b():(this.fontCallbacks[a]||(this.fontCallbacks[a]=[]),void this.fontCallbacks[a].push(b))},e.prototype.setupSupersampling=function(){function a(a,b,d){var e=c.createControl({width:b,height:d,image:a});return c.createRenderTarget({rootControl:e})}function b(){function a(a){return Math.log(a)/Math.LN2}var b=c.screenWidth/c.canvas.width,d=c.screenHeight/c.canvas.height;return Math.round(a(Math.min(b,d)))}var c=f.instance;if(this.rootComponent){var d=b(),e=this.currentNumMipmaps;this.currentNumMipmaps=d;var g=c.createControl({width:c.screenWidth,height:c.screenHeight});if(g.add(this.rootComponent.getVisualRoot()._internal.control),e===d||0>=d)this.visualRoot=g;else{for(var h=c.createRenderTarget({rootControl:g}),i=c.screenWidth,j=c.screenHeight,k=h,l=0;d>l;++l)i=Math.round(i/2),j=Math.round(j/2),k=a(k,i,j);this.visualRoot=c.createControl({image:k,width:c.screenWidth,height:c.screenHeight})}c.addControl(this.visualRoot),this.scheduleFrame()}},e.prototype.patchExportData=function(a){var b=n.collectPatches(a),c=Object.keys(b),d=this;return c.length>0?(this.editorConnection.isRunningLocally()&&c.forEach(function(a){d.editorConnection.sendPatches(b[a])}),!0):!1},e.prototype.setData=function(a){var b=f.instance,c=this;this._currentLoadedData&&this._resetData(),this._currentLoadedData=a;var d=a.settings;d&&d.canvasWidth&&d.canvasHeight&&(this.torpedArgs.portrait.width=d.canvasWidth,this.torpedArgs.portrait.height=d.canvasHeight,"fill"===d.fillMode?b.setCanvasFillMode("fill"):b.setCanvasFillMode("aspectFit")),this._loadFonts(a),a.components.forEach(function(a){c.context.registerComponent(a)}),this.rootComponent=this.context.createComponentInstanceNode(a.rootComponent,"rootNode"),this.rootComponent.setRoot(a.rootNode),this.context.setRootComponent(this.rootComponent),window.Noodl=this.rootComponent.nodeScope.noodlJavascriptAPI,this.supportsSuperSampling&&"fill"!==d.fillMode?(this.setupSupersampling(),this.isUsingSuperSampling=!0):(this.isUsingSuperSampling=!1,this.visualRoot=b.createControl({fill:"parent"}),this.visualRoot.add(this.rootComponent.getVisualRoot()._internal.control),b.addControl(this.visualRoot)),this.editorConnection&&this._sendJavascriptNodePortsToEditor(this.rootComponent.nodeScope,a),this.scheduleFrame()},e.prototype._sendJavascriptNodePortsToEditor=function(a,b){var c=[];b.components.forEach(function(a){c=c.concat(a.nodes.filter(function(a){return"Javascript2"===a.type}))});var d=this;c.forEach(function(b){if(b.parameters)if(b.parameters.externalFile&&"yes"===b.parameters.useExternalFile){var c=b.parameters.externalFile;d.runningInEditor&&"/"!==c[0]&&(c="/"+c),l.createFromURL(c,a.noodlJavascriptAPI,function(a){var c=a.getPorts();d.editorConnection.sendDynamicPorts(b.id,c)})}else if(b.parameters.code){var e=l.createFromCode(b.parameters.code,a.noodlJavascriptAPI),f=e.getPorts();d.editorConnection.sendDynamicPorts(b.id,f)}})},e.prototype.applyDataDiff=function(a){try{h.apply(this._currentLoadedData,a,!0);var b=i.applyLiveUpdate(this.rootComponent,this._currentLoadedData,a,this.editorConnection);if(b)this._loadFonts(this._currentLoadedData);else{var c=JSON.parse(JSON.stringify(this._currentLoadedData));this.setData(c)}}catch(d){console.log("Error applying export diff:",d.message,". Requesting full export"),this.editorConnection.requestFullExport()}},e.prototype.scheduleFrame=function(){this.frameScheduled||(window.requestAnimFrame(e.prototype.doFrame.bind(this)),this.frameScheduled=!0)},e.prototype.doFrame=function(){if(this.rootComponent){var a=f.instance;this.frameScheduled=!1;var b=window.performance.now();a.currentFrameTime=b,this.context.currentFrameTime=b,this.context.eventEmitter.emit("frameStart"),a.processInput(),this.context.update(),a.processTimers(),a.layoutFrame(),this.context.update(),this.isUsingSuperSampling&&a.layoutEngine.layout(this.rootComponent.getVisualRoot()._internal.control,!0),a.layoutFrame(),this.context.update(),this.highlighter.update(),a.layoutEngine.layout(this.rootComponent.getVisualRoot()._internal.control,!0),a.renderFrame(),this.context.eventEmitter.emit("frameEnd"),this.frameNumber++}},e.prototype.getNodeLibrary=function(){return m(this.context.nodeRegister)},e.prototype.enableInspector=function(a){f.instance.inspector.enable(this.rootComponent.getVisualRoot()._internal.control,function(b){a(b.noodlNode.id)})},e.prototype.disableInspector=function(){f.instance.inspector.disable()},e.prototype.connectToEditor=function(a){this.editorConnection.connect(a)},b.exports=e},{"./editorconnection":7,"./highlighter":8,"./javascriptnodeparser":9,"./liveupdate":15,"./node":16,"./nodecontext":17,"./nodelibraryexport":19,"./noderegister":20,"./nodes/and":21,"./nodes/animation":22,"./nodes/colorblend":23,"./nodes/componentinputs":24,"./nodes/componentoutputs":26,"./nodes/counter":27,"./nodes/drag":28,"./nodes/eventreceiver":29,"./nodes/eventsender":30,"./nodes/expression":31,"./nodes/globals":32,"./nodes/gyroscope":33,"./nodes/inputstoobject":34,"./nodes/inverter":35,"./nodes/javascript":36,"./nodes/javascript2":37,"./nodes/numberblend":38,"./nodes/numberremapper":39,"./nodes/or":40,"./nodes/reload":41,"./nodes/renderinimage":42,"./nodes/screenresolution":43,"./nodes/signaltoindex":44,"./nodes/stringselector":45,"./nodes/substring":46,"./nodes/switch":47,"./nodes/timer":48,"./nodes/touchposition":49,"./nodes/transition":50,"./nodes/valuechanged":51,"./nodes/variables/boolean":52,"./nodes/variables/color":53,"./nodes/variables/number":54,"./nodes/variables/string":55,"./nodes/velocity":57,"./nodes/visual/circle":58,"./nodes/visual/flowlayout":59,"./nodes/visual/group":60,"./nodes/visual/image":61,"./nodes/visual/rectangle":63,"./nodes/visual/scrollview":65,"./nodes/visual/stacklayout":66,"./nodes/visual/text":67,"./nodes/websocket":69,"./projectpatchers":73,"./torpedwrapper":75,events:3,"fast-json-patch":2}],5:[function(a,b,c){"use strict";var d={easeOutQuartic:function(a,b,c){return c--,-(b-a)*(c*c*c*c-1)+a},easeInQuartic:function(a,b,c){return(b-a)*(c*c*c*c)+a},easeInOutQuartic:function(a,b,c){return c*=2,1>c?(b-a)/2*c*c*c*c+a:(c-=2,-(b-a)/2*(c*c*c*c-2)+a)},easeOutCubic:function(a,b,c){return c--,(b-a)*(c*c*c+1)+a},easeInCubic:function(a,b,c){return(b-a)*(c*c*c)+a},easeInOutCubic:function(a,b,c){return c*=2,1>c?(b-a)/2*c*c*c+a:(c-=2,(b-a)/2*(c*c*c+2)+a)},easeOutQuadratic:function(a,b,c){return-(b-a)*c*(c-2)+a},easeInQuadratic:function(a,b,c){return(b-a)*(c*c)+a},easeInOutQuadratic:function(a,b,c){return c*=2,1>c?(b-a)/2*c*c+a:(c-=1,-(b-a)/2*(c*(c-2)-1)+a)},linear:function(a,b,c){return a+(b-a)*c}};d.easeIn=d.easeInCubic,d.easeOut=d.easeOutCubic,d.easeInOut=d.easeInOutCubic,b.exports=d},{}],6:[function(a,b,c){"use strict";function d(a){var b=!1;return function(c){c=c?!0:!1,c&&b===!1&&a.valueChangedToTrue.call(this),b=c}}b.exports={createSetter:d}},{}],7:[function(a,b,c){"use strict";function d(){this.eventEmitter=new e}var e=a("events").EventEmitter,f=a("./torpedwrapper");d.prototype.isRunningLocally=function(){return"localhost"===document.location.hostname||"127.0.0.1"===document.location.hostname},d.prototype.connect=function(a){this.socket=new WebSocket(a);var b=this;this.socket.addEventListener("open",function(){b.socket.send(JSON.stringify({cmd:"register",type:"viewer"})),b.eventEmitter.emit("connected")}),this.socket.addEventListener("close",function(){b.reconnect(a)}),this.socket.addEventListener("error",function(c){console.log("Editor connection error, trying to reconnect"),b.reconnect(a)}),this.socket.addEventListener("message",function(a){var c,d=JSON.parse(a.data);"registered"===d.cmd||("export"===d.cmd?(c=JSON.parse(d.content),"full"===d.type?b.eventEmitter.emit("exportDataFull",c):"diff"===d.type&&b.eventEmitter.emit("exportDataDiff",c)):"hoverStart"===d.cmd?b.eventEmitter.emit("hoverStart",d.content.id):"hoverEnd"===d.cmd?b.eventEmitter.emit("hoverEnd",d.content.id):"refresh"===d.cmd?b.eventEmitter.emit("reload"):"inspectStart"===d.cmd?b.eventEmitter.emit("inspectStart"):"inspectEnd"===d.cmd?b.eventEmitter.emit("inspectEnd"):"capture"===d.cmd?b.isRunningLocally()&&(c=JSON.parse(d.content),b.sendThumbnailCapture(c.width,c.height)):"connectionInspectors"===d.cmd?b.isRunningLocally()&&(c=JSON.parse(d.content),b.eventEmitter.emit("connectionInspectorsUpdated",c.connectionsToInspect)):"debuggingEnabled"===d.cmd?b.isRunningLocally()&&(c=JSON.parse(d.content),b.eventEmitter.emit("debuggingEnabledChanged",c.enabled)):console.log("Command not implemented",d))})},d.prototype.reconnect=function(a){var b=this;window.setTimeout(function(){b.connect(a)},2e3)},d.prototype.isConnected=function(){return void 0!==this.socket&&this.socket.readyState===WebSocket.OPEN},d.prototype.send=function(a){this.isConnected()!==!1&&this.socket.send(JSON.stringify(a))},d.prototype.sendInspectId=function(a){this.send({cmd:"select",type:"viewer",content:JSON.stringify({id:a})})},d.prototype.sendPulsingConnections=function(a){var b=[];Object.keys(a).forEach(function(c){var d=a[c];b=b.concat(d.connections)}),this.send({cmd:"connectiondebugpulse",type:"viewer",content:JSON.stringify({connectionsToPulse:b})})},d.prototype.sendConnectionValues=function(a){this.send({cmd:"connectionvalue",type:"viewer",content:JSON.stringify({connections:a})})},d.prototype.sendDynamicPorts=function(a,b){this.send({cmd:"instanceports",type:"viewer",content:JSON.stringify({nodeid:a,ports:b})})},d.prototype.sendThumbnailCapture=function(a,b){var c=f.instance.canvas,d=c.width,e=c.height;c.width=a,c.height=b,f.instance.renderer.setRenderBufferSize(a,b),f.instance.renderFrame();var g=c.toDataURL();c.width=d,c.height=e,f.instance.renderer.setRenderBufferSize(d,e),f.instance.renderFrame(),this.send({cmd:"captured",type:"viewer",content:JSON.stringify({data:g})})},d.prototype.sendWarning=function(a,b,c,d){this.send({cmd:"showwarning",type:"viewer",content:JSON.stringify({componentName:a,nodeId:b,key:c,warning:d})})},d.prototype.clearWarnings=function(a,b){this.send({cmd:"clearwarnings",type:"viewer",content:JSON.stringify({componentName:a,nodeId:b})})},d.prototype.sendPatches=function(a){this.send({cmd:"patchproject",type:"viewer",content:JSON.stringify(a)})},d.prototype.requestFullExport=function(){this.send({cmd:"register",type:"viewer"})},b.exports=d},{"./torpedwrapper":75,events:3}],8:[function(a,b,c){"use strict";function d(){this._highlightedNodes=[],this.currentId=null,this.enabled=!1,this.torpedRoot=h.instance.createControl({depth:1e6})}function e(a,b,c,d){var e=h.instance,f=e.createControl({color:"8BC6E9",opacity:.6,x:a,y:b,width:c,height:d}),g="00a0ff",i=Math.ceil(.002*Math.max(e.screenWidth,e.screenHeight));return f.add(e.createControl({width:i,height:d,color:g})),f.add(e.createControl({width:i,height:d,color:g,x:c-i})),f.add(e.createControl({width:c-2*i,height:i,x:i,color:g})),f.add(e.createControl({width:c-2*i,height:i,x:i,y:d-i,color:g})),f}function f(a){for(var b=a.scaleX,c=a.scaleY,d=a.parent;d;)b*=d.scaleX,c*=d.scaleY,d=d.parent;return{x:b,y:c}}function g(a){for(var b=[],c=a;c.parent;)b.push(c),c=c.parent;for(var d=b.length-1;d>=0;--d)if(b[d].isVisible()===!1)return!1;return!0}var h=a("./torpedwrapper"),i=h.Math.AABB.create();Object.defineProperties(d.prototype,{highlightNodesWithId:{value:function(a,b,c){if(c!==!1||this.currentId===b)if(this.enabled&&this.currentId!==b&&this.disableHighlight(this.currentId),this.enabled=c,c){null===this.torpedRoot.parent&&h.instance.addControl(this.torpedRoot),this.currentScope=a,this.currentId=b;var d=a.findNodesWithIdRecursive(b),e=this;d.forEach(function(a){e.enableHighlight(a)})}else this.disableHighlight(b)}},enableHighlight:{value:function(a){if(void 0!==a.getVisualRoot&&void 0!==a.getVisualRoot()){var b=a.getVisualRoot()._internal.control;if(g(b)){var c=f(b),d={min:[b.worldX,b.worldY],max:[b.worldX+b.width*c.x,b.worldY+b.height*c.y]};h.Math.AABB.intersection(i,d,b._clipRect);var j=e(i.min[0],i.min[1],i.max[0]-i.min[0],i.max[1]-i.min[1]);this.torpedRoot.add(j),this._highlightedNodes[this.currentId]||(this._highlightedNodes[this.currentId]=[]),this._highlightedNodes[this.currentId].push(j)}}}},disableHighlight:{value:function(a){this._highlightedNodes[a]&&(this._highlightedNodes[a].forEach(function(a){a.parent.remove(a)}),delete this._highlightedNodes[a])}},update:{value:function(){if(this.enabled!==!1){var a=h.instance;this.disableHighlight(this.currentId);var b=this.currentScope.findNodesWithIdRecursive(this.currentId),c=this;b.forEach(function(a){c.enableHighlight(a)}),a.layoutFrame()}}}}),b.exports=d},{"./torpedwrapper":75}],9:[function(a,b,c){"use strict";function d(a,b){this.inputs={},this.outputs={},this.error=void 0;var c=e[a];if(!c)try{c=new Function("define","Noodl",a),e[a]=c}catch(d){this.error=d.message}c&&c(this.define.bind(this),b)}var e={};d.prototype.define=function(a){this.inputs=a.inputs||{},this.outputs=a.outputs||{},this.setup=a.setup,this.run=a.run},d.createFromCode=function(a,b){return new d(a,b)},d.createFromURL=function(a,b,c){var e=new window.XMLHttpRequest;e.open("GET",a,!0),e.onreadystatechange=function(){(4===this.readyState||this.readyState===XMLHttpRequest.DONE)&&c(new d(this.response,b))},e.onerror=function(){console.log("Failed to request",a)},e.send()},d.prototype.getPorts=function(){var a=[],b=this;return Object.keys(this.inputs).forEach(function(c){a.push({name:c,type:{name:b.inputs[c]},plug:"input"})}),Object.keys(this.outputs).forEach(function(c){a.push({name:c,type:{name:b.outputs[c]},plug:"output"})}),a},b.exports=d},{}],10:[function(a,b,c){"use strict";function d(){}d.prototype.layoutChildHorizontally=function(a,b,c,d,e){var f=b._internal;"left"===f.alignX?(a.x=f.positionX+e.left,a.width=c):"right"===f.alignX?(a.x=d.width-e.right+f.positionX-c,a.width=c):"center"===f.alignX&&(a.x=(d.width-e.right-e.left)/2+e.left+f.positionX-c/2,a.width=c)},d.prototype.layoutChildVertically=function(a,b,c,d,e){var f=b._internal;"top"===f.alignY?(a.y=f.positionY+e.top,a.height=c):"bottom"===f.alignY?(a.y=d.height-e.bottom+f.positionY-c,a.height=c):"center"===f.alignY&&(a.y=(d.height-e.bottom-e.top)/2+e.top+f.positionY-c/2,a.height=c)},d.prototype.setChildLayoutRect=function(a,b){var c=a._internal,d=c.layoutRect.width!=b.width||c.layoutRect.height!=b.height;c.layoutRect.x=b.x,c.layoutRect.y=b.y,c.layoutRect.width=b.width,c.layoutRect.height=b.height,(d||c.needsRelayout)&&(c.layout.layout&&c.layout.layout(a),c.needsRelayout=!1)},d.prototype.layout=function(a){for(var b=a._internal,c={x:0,y:0,width:0,height:0},d=0;d<b.children.length;d++){var e=b.children[d].getVisualRoot(),f=b.layoutRect.width-b.padding.left-b.padding.right,g=b.layoutRect.height-b.padding.top-b.padding.bottom,h=e._internal.layout.layoutSize(e,f,g);this.layoutChildHorizontally(c,e,h.width,b.layoutRect,b.padding),this.layoutChildVertically(c,e,h.height,b.layoutRect,b.padding),this.setChildLayoutRect(e,c)}},d.prototype.layoutSize=function(a,b,c){var d=a._internal,e=this.measure(a),f={width:"childWidth"===d.sizeMode||"childSize"===d.sizeMode?e.width:this.layoutWidth(a,b),height:"childHeight"===d.sizeMode||"childSize"===d.sizeMode?e.height:this.layoutHeight(a,c)};return f},d.prototype.measureChildrenWidth=function(a){for(var b=0,c=a._internal,d=0;d<c.children.length;d++){var e=c.children[d].getVisualRoot(),f=e._internal.layout.measure(e);b=Math.max(b,Math.max(e._internal.positionX,0)+f.width)}return b},d.prototype.measureChildrenHeight=function(a){for(var b=0,c=a._internal,d=0;d<c.children.length;d++){var e=c.children[d].getVisualRoot(),f=e._internal.layout.measure(e);b=Math.max(b,Math.max(e._internal.positionY,0)+f.height)}return b},d.prototype.layoutWidth=function(a,b){var c=a._internal;return"%"===c.widthUnit?b*(c.width/100):c.width},d.prototype.layoutHeight=function(a,b){var c=a._internal;return"%"===c.heightUnit?b*(c.height/100):c.height},d.prototype.measure=function(a){var b=a._internal;if(b.measuredSize)return b.measuredSize;var c={width:"childWidth"===b.sizeMode||"childSize"===b.sizeMode?this.measureChildrenWidth(a)+b.padding.left+b.padding.right:this.layoutWidth(a,0),height:"childHeight"===b.sizeMode||"childSize"===b.sizeMode?this.measureChildrenHeight(a)+b.padding.top+b.padding.bottom:this.layoutHeight(a,0)};return b.measuredSize=c,c},d["static"]=new d,b.exports=d},{}],11:[function(a,b,c){"use strict";function d(){}var e=a("./docklayout");d.prototype=Object.create(e.prototype),d.prototype.measureChildrenHeightForHorizontalFlow=function(a){var b=a._internal;if("explict"===this.sizeMode||"childWidth"===this.sizeMode)return this.layoutHeight(a,0,0);for(var c="childSize"===b.sizeMode?Number.MAX_VALUE:this.layoutWidth(a,0,0)-b.padding.left-b.padding.right,d=0,e=0,f=0,g=b.children.length,h=0;g>h;h++){var i=b.children[h].getVisualRoot(),j=i._internal,k=i._internal.layout.measure(i);e+k.width>c&&(d+=f+b.verticalItemSpacing,f=e=0),f=Math.max(f,k.height+j.positionY),e+=k.width+b.horizontalItemSpacing}return d+=f},d.prototype.measureChildrenWidthForHorizontalFlow=function(a){var b=a._internal;if("explict"===this.sizeMode||"childHeight"===this.sizeMode)return this.layoutWidth(a,0,0);for(var c=0,d=b.children.length,e=0;d>e;e++){var f=b.children[e].getVisualRoot(),g=f._internal.layout.measure(f);c+=g.width+(e!==d-1?b.horizontalItemSpacing:0)}return c},d.prototype.measureChildrenWidthForVerticalFlow=function(a){var b=a._internal;if("explict"===this.sizeMode||"childHeight"===this.sizeMode)return this.layoutWidth(a,0,0);for(var c="childSize"===b.sizeMode?Number.MAX_VALUE:this.layoutHeight(a,0,0)-b.padding.top-b.padding.left,d=0,e=0,f=0,g=b.children.length,h=0;g>h;h++){var i=b.children[h].getVisualRoot(),j=i._internal,k=i._internal.layout.measure(i);d+k.height>c&&(e+=f+b.horizontalItemSpacing,f=d=0),f=Math.max(f,k.width+j.positionX),d+=k.height+b.verticalItemSpacing}return e+=f},d.prototype.measureChildrenHeightForVerticalFlow=function(a){var b=a._internal;if("explict"===this.sizeMode||"childWidth"===this.sizeMode)return this.layoutHeight(a,0,0);for(var c=0,d=b.children.length,e=0;d>e;e++){var f=b.children[e].getVisualRoot(),g=f._internal.layout.measure(f);c+=g.height+(e!==d-1?b.verticalItemSpacing:0)}return c},d.prototype.measureChildrenWidth=function(a){var b=a._internal;return"horizontal"===b.orientation?this.measureChildrenWidthForHorizontalFlow(a):this.measureChildrenWidthForVerticalFlow(a)},d.prototype.measureChildrenHeight=function(a){var b=a._internal;return"horizontal"===b.orientation?this.measureChildrenHeightForHorizontalFlow(a):this.measureChildrenHeightForVerticalFlow(a)};var f=[];d.prototype.layout=function(a){function b(a,b,c,d){for(var e=a;b>e;e++){var g=k.children[e].getVisualRoot(),h=g._internal,i=f[e],j=h.layout.layoutSize(g,0,d);l.layoutChildVertically(i,g,j.height,{height:d},{top:0,bottom:0,left:0,right:0}),i.y+=c,l.setChildLayoutRect(g,i)}}function c(a,b,c,d){for(var e=a;b>e;e++){var g=k.children[e].getVisualRoot(),h=g._internal,i=f[e],j=h.layout.layoutSize(g,d,0);l.layoutChildHorizontally(i,g,j.width,{width:d},{top:0,bottom:0,left:0,right:0}),i.x+=c,l.setChildLayoutRect(g,i)}}var d,e,g,h,i,j,k=a._internal,l=this,m=0,n=0,o=0,p=0,q=0,r=k.children.length;if(f.length<r)for(e=0;r>e;e++)f[e]={x:0,y:0,width:0,height:0};if("horizontal"===k.orientation){var s=k.layoutRect.width-k.padding.left-k.padding.right;for(d=s,e=0;r>e;e++)j=f[e],g=k.children[e].getVisualRoot(),h=g._internal,i=g._internal.layout.layoutSize(g,s,0),m+i.width>d&&(b(q,e,n+k.padding.top,o),n+=o+k.verticalItemSpacing,q=e,o=0,m=0),o=Math.max(o,i.height),j.x=m+k.padding.left+h.positionX,j.width=i.width,m+=i.width+k.horizontalItemSpacing;b(q,e,n+k.padding.top,o)}else{var t=k.layoutRect.height-k.padding.top-k.padding.bottom;for(d=t,e=0;r>e;e++)j=f[e],g=k.children[e].getVisualRoot(),h=g._internal,i=g._internal.layout.layoutSize(g,0,t),n+i.height>d&&(c(q,e,m+k.padding.left,p),m+=p+k.horizontalItemSpacing,q=e,p=0,n=0),p=Math.max(p,i.width),j.y=n+k.padding.top+h.positionY,j.height=i.height,n+=i.height+k.verticalItemSpacing;c(q,e,m+k.padding.left,p)}},d["static"]=new d,b.exports=d},{"./docklayout":10}],12:[function(a,b,c){"use strict";function d(a){for(var b in a)this[b]=a[b]}var e=a("./docklayout");d.prototype.setWindowSize=function(a,b){this.windowSize={width:a,height:b}},d.prototype.layout=function(a){var b={_internal:{layoutRect:{x:0,y:0,width:this.windowSize.width,height:this.windowSize.height},padding:{top:0,left:0,bottom:0,right:0},children:[a]}};e["static"].layout(b),a._internal.needsRelayout=!1},d.prototype.setNeedsFullRelayout=function(a){function b(a){if(a._internal.measuredSize=void 0,a._internal.needsRelayout=!0,a._internal.children)for(var c=0;c<a._internal.children.length;c++)b(a._internal.children[c].getVisualRoot())}b(a)},d.prototype.setNeedsRelayout=function(a){var b=a._internal;if(!b.needsRelayout&&(b.measuredSize=void 0,b.needsRelayout=!0,b.parent)){var c=b.parent.getVisualRoot();this.setNeedsRelayout(c)}},d.prototype.relayout=function(a){this.setNeedsFullRelayout(a),this.layout(a)},b.exports=d},{"./docklayout":10}],13:[function(a,b,c){"use strict";function d(){}var e=a("./stacklayout");d.prototype=Object.create(e.prototype),d.prototype.layout=function(a){var b,c,d,e,f=a._internal,g=f.children.length,h={x:0,y:0,width:0,height:0},i=f.layoutRect.height-f.padding.top-f.padding.bottom,j=f.layoutRect.width-f.padding.left-f.padding.right;if("horizontal"===f.orientation){var k=f.padding.left;for(e=0;g>e;e++)b=f.children[e].getVisualRoot(),d=b._internal.layout.layoutSize(b,j,i),c=b._internal,h.x=k+f.scrollOffset,h.width=d.width,this.layoutChildVertically(h,b,d.height,f.layoutRect,f.padding),this.setChildLayoutRect(b,h),k+=f.itemSpacing+c.layoutRect.width;f.contentLengthChanged&&f.contentLengthChanged(k-(e>0?f.itemSpacing:0)-f.padding.left)}else{var l=f.padding.top;for(e=0;g>e;e++)b=f.children[e].getVisualRoot(),d=b._internal.layout.layoutSize(b,j,i),c=b._internal,this.layoutChildHorizontally(h,b,d.width,f.layoutRect,f.padding),h.y=l+f.scrollOffset,h.height=d.height,this.setChildLayoutRect(b,h),l+=f.itemSpacing+c.layoutRect.height;f.contentLengthChanged&&f.contentLengthChanged(l-(e>0?f.itemSpacing:0)-f.padding.top)}},d["static"]=new d,b.exports=d},{"./stacklayout":14}],14:[function(a,b,c){"use strict";function d(){}var e=a("./docklayout");d.prototype=Object.create(e.prototype),d.prototype.layout=function(a){var b,c,d,e,f=a._internal,g=0,h=0,i=0,j={x:0,y:0,width:0,height:0};if("horizontal"===f.orientation){for(d=f.children.length,e=0;d>e;e++)if(b=f.children[e].getVisualRoot(),c=b._internal,"%"!==c.widthUnit||"explicit"!==c.sizeMode&&"childHeight"!==c.sizeMode){var k=c.layout.measure(b);g+=k.width}else i+=c.width/100;h=Math.max(0,f.layoutRect.width-f.padding.left-f.padding.right-g)/i;var l=f.padding.left;for(e=0;d>e;e++){b=f.children[e].getVisualRoot();var m=f.layoutRect.height-f.padding.top-f.padding.bottom;k=b._internal.layout.layoutSize(b,h,m),c=b._internal,j.x=l,j.width=k.width,this.layoutChildVertically(j,b,k.height,f.layoutRect,f.padding),this.setChildLayoutRect(b,j),l+=f.itemSpacing+c.layoutRect.width}}else{for(d=f.children.length,e=0;d>e;e++)b=f.children[e].getVisualRoot(),c=b._internal,"%"!==c.heightUnit||"explicit"!==c.sizeMode&&"childWidth"!==c.sizeMode?(k=c.layout.measure(b),g+=k.height):i+=c.height/100;h=Math.max(0,f.layoutRect.height-f.padding.top-f.padding.bottom-g)/i;var n=f.padding.top;for(e=0;d>e;e++){b=f.children[e].getVisualRoot();var o=f.layoutRect.width-f.padding.left-f.padding.right;k=b._internal.layout.layoutSize(b,o,h),c=b._internal,this.layoutChildHorizontally(j,b,k.width,f.layoutRect,f.padding),j.y=n,j.height=k.height,this.setChildLayoutRect(b,j),n+=f.itemSpacing+c.layoutRect.height}}f.needsRelayout=!1},d.prototype.measureChildrenWidth=function(a){var b=a._internal;if("horizontal"===b.orientation){for(var c=0,d=b.children.length,f=0;d>f;f++){var g=b.children[f].getVisualRoot(),h=g._internal.layout.measure(g);c+=h.width+(f!==d-1?b.itemSpacing:0)}return c}return e.prototype.measureChildrenWidth.call(this,a)},d.prototype.measureChildrenHeight=function(a){var b=a._internal;if("vertical"===b.orientation){for(var c=0,d=b.children.length,f=0;d>f;f++){var g=b.children[f].getVisualRoot(),h=g._internal.layout.measure(g);c+=h.height+(f!==d-1?b.itemSpacing:0)}return c}return e.prototype.measureChildrenHeight.call(this,a)},d["static"]=new d,b.exports=d},{"./docklayout":10}],15:[function(a,b,c){"use strict";function d(a){return null!==a.path.match(/\/parameters\//g)}function e(a,b,c,d){function e(a,b,c,d,e){if("externalFile"===c){var f=d;a.context.runningInEditor&&"/"!==f[0]&&(f="/"+f),i.createFromURL(f,a.nodeScope.noodlJavascriptAPI,function(a){var c=a.getPorts();e.sendDynamicPorts(b,c)})}else if("code"===c){var g=i.createFromCode(d,a.nodeScope.noodlJavascriptAPI),h=g.getPorts();e.sendDynamicPorts(b,h)}}var f=c.path.split("/").filter(function(a){return""!==a}),g=b,h=f[f.length-1];if("unit"===h&&(h=f[f.length-2],f.length=f.length-1),f.length=f.length-2,f.forEach(function(a){g=g[a]}),!g||!g.id)return!1;var j,k=g.id,l=g.type,m=a.nodeScope.findNodesWithIdRecursive(k),n="remove"===c.op;if(n)try{var o=a.context.nodeRegister.getNodeMetadata(l);j=o.inputs[h]["default"]}catch(p){return!1}else j=g.parameters[h];return m.forEach(function(a){a.registerInputIfNeeded(h),"object"==typeof j?a.setInputValue(h,j.value,j.unit):a.setInputValue(h,j)}),"Javascript2"===l&&e(a,k,h,j,d),!0}function f(a){return"add"===a.op&&null!==a.path.match(/\/connections\//g)}function g(a,b,c,d){var e=c.path.split("/").filter(function(a){return""!==a}),f=e[1],g=b.components[f];if(!g||!g.name)return!1;var h;if(h=a.name===g.name?[a]:a.nodeScope.findNodesWithNameRecursive(g.name),0===h.length)return!1;var i=c.value;if(!(i.sourceId&&i.sourcePort&&i.targetId&&i.targetPort))return!1;var j=h.every(function(a){var b=a.nodeScope.findNodesWithIdRecursive(c.value.sourceId),d=a.nodeScope.findNodesWithIdRecursive(c.value.targetId);return 1!==b.length||1!==d.length?!1:(b[0].registerOutputIfNeeded(i.sourcePort),d[0].registerInputIfNeeded(i.targetPort),d[0].connectInput(i.targetPort,b[0],i.sourcePort),!0)});return j}function h(a,b,c,h){for(var i=!0,j=0;j<c.length&&i;j++){var k=c[j];i=d(k)?e(a,b,k,h):f(k)?g(a,b,k,h):!1}return i}var i=a("./javascriptnodeparser");b.exports={applyLiveUpdate:h}},{"./javascriptnodeparser":9}],16:[function(a,b,c){"use strict";function d(a){this.context=a,this._dirty=!0,this._cachedInputValues={},this._inputs={},this.numberedInputs={},this._outputs={},this._inputConnections={},this._outputList=[],this._isUpdating=!1,this._inputValuesQueue={},this._afterInputsHaveUpdatedCallbacks=[],this._internal={},this._signalsSentThisUpdate={}}function e(a){var b=a.split(" ");return b.splice(-1,1),b.join(" ")}var f=a("./outputproperty");Object.defineProperties(d.prototype,{registerInput:{value:function(a,b){if(this.hasInput(a))throw new Error("Input property "+a+" already registered");this._inputs[a]=b,b.hasOwnProperty("default")&&(this._cachedInputValues[a]=b["default"])}},registerInputs:{value:function(a){for(var b in a)this.registerInput(b,a[b])}},_registerSelectors:{value:function(a){var b=this;Object.keys(a).forEach(function(c){var d=a[c],e={set:function(a){var c=a.split(" "),e=Number(c[c.length-1]);d.set.call(b,e)}};b.registerInput(c,e)})}},registerNumberedInput:{value:function(a,b){if(this.hasNumberedInput(a))throw new Error("Numbered input property "+a+" already registered");this.numberedInputs[a]=b,b.selectors&&this._registerSelectors(b.selectors)}},getInput:{value:function(a){if(this.hasInput(a)===!1)throw new Error("Node "+this.name+": Invalid input property "+a);return this._inputs[a]}},hasInput:{value:function(a){return a in this._inputs}},hasNumberedInput:{value:function(a){return this.numberedInputs.hasOwnProperty(a)}},registerInputIfNeeded:{value:function(a){this.hasInput(a)===!1&&this._isUnregisteredNumberedInput(a)&&this._registerNumberedInputInstance(a)}},_isUnregisteredNumberedInput:{value:function(a){var b=e(a);return this.numberedInputs.hasOwnProperty(b)}},_registerNumberedInputInstance:{value:function(a){var b=a.split(" "),c=b[b.length-1];if(isNaN(c))throw new Error("Numbered input with name "+a+" doesn't end with a number");c=Number(c);var d=this.numberedInputs[e(a)],f={name:d.name,set:d.createSetter.call(this,c)};this.registerInput(a,f)}},setInputValue:{value:function(a,b,c){this._cachedInputValues[a]=b;var d=this.getInput(a);c?d.set.call(this,b,c):d.set.call(this,b)}},hasOutput:{value:function(a){return a in this._outputs}},registerOutput:{value:function(a,b){if(this.hasOutput(a))throw new Error("Output property "+a+" already registered");var c=new f({owner:this,getter:b.getter,name:a});this._outputs[a]=c,this._outputList.push(c)}},registerOutputs:{value:function(a){for(var b in a)this.registerOutput(b,a[b])}},registerOutputIfNeeded:{value:function(){}},getOutput:{value:function(a){if(this.hasOutput(a)===!1)throw new Error("Node "+this.name+" doesn't have a port named "+a);return this._outputs[a]}},connectInput:{value:function(a,b,c){if(this.hasInput(a)===!1)throw new Error("Invalid connection, input doesn't exist. Trying to connect from "+b.name+" output "+c+" to "+this.name+" input "+a);var d=b.getOutput(c);if(d.registerConnection(this,a),this._inputConnections[a]||(this._inputConnections[a]=[],this._inputValuesQueue[a]=[]),this._inputConnections[a].push(d),b._signalsSentThisUpdate[c])this.queueInput(a,!0),this.queueInput(a,!1);else{var e=d.value;void 0!==e&&this.queueInput(a,e)}this.flagDirty()}},isInputConnected:{value:function(a){return this._inputConnections.hasOwnProperty(a);
}},update:{value:function(){if(!this._isUpdating&&this._dirty!==!1){this._isUpdating=!0;for(var a,b=0;this._dirty&&100>b;){this._updateDependencies(),this._dirty=!1;for(var c=!0,d=Object.keys(this._inputValuesQueue);c;){for(c=!1,a=0;a<d.length;a++){var e=d[a],f=this._inputValuesQueue[e];if(f.length>0){var g=f.shift();this.setInputValue(e,g),f.length>0&&(c=!0)}}var h=this._afterInputsHaveUpdatedCallbacks;for(this._afterInputsHaveUpdatedCallbacks=[],a=0;a<h.length;a++)h[a].call(this)}b++}this._isUpdating=!1}}},_updateDependencies:{value:function(){for(var a in this._inputConnections)for(var b=this._inputConnections[a],c=0;c<b.length;++c)"reference"!==b[c].type&&b[c].owner.update()}},flagDirty:{value:function(){if(!this._dirty){this._dirty=!0;for(var a=0;a<this._outputList.length;++a)this._outputList[a].flagDependeesDirty()}}},sendValue:{value:function(a,b){if(this.hasOutput(a)===!1)return void console.log("Error: Node",this.name,"doesn't have a output named",a);var c=this.getOutput(a);c.hasConnections()!==!1&&(this.context&&this.context.outputCollectionEnabled&&this.context.connectionSentValue(c,b),void 0!==b&&c.sendValue(b))}},flagOutputDirty:{value:function(a){var b=this.getOutput(a);b.hasConnections()!==!1&&this.sendValue(a,b.value)}},flagAllOutputsDirty:{value:function(a){for(var b=0;b<this._outputList.length;++b){var c=this._outputList[b];this.sendValue(c.name,c.value)}}},sendSignalOnOutput:{value:function(a){this.sendValue(a,!0),this.sendValue(a,!1),this._signalsSentThisUpdate[a]=!0,this.scheduleAfterInputsHaveUpdated(function(){this._signalsSentThisUpdate[a]=!1})}},queueInput:{value:function(a,b){this._inputValuesQueue[a]||(this._inputValuesQueue[a]=[]),this._inputValuesQueue[a].push(b),this.flagDirty()}},scheduleAfterInputsHaveUpdated:{value:function(a){this._afterInputsHaveUpdatedCallbacks.push(a)}}}),b.exports=d},{"./outputproperty":72}],17:[function(a,b,c){"use strict";function d(a){a=a||{},a.runningInEditor=a.hasOwnProperty("runningInEditor")?a.runningInEditor:!1,this._dirtyNodes=[],this._numDirtyNodes=0,this.manualUpdateQueue=[],this._callbacksScheduledAfterUpdate=[],this.eventEmitter=new e,this.eventEmitter.setMaxListeners(1e3),this.eventSenderEmitter=new e,this.eventSenderEmitter.setMaxListeners(1e4),this.globalValues={},this.globalsEventEmitter=new e,this.globalsEventEmitter.setMaxListeners(1e3),this.runningInEditor=a.runningInEditor,this.currentFrameTime=0,this.nodeRegister=new f(this),this.timerScheduler=new g(this.scheduleFrame.bind(this)),this.componentDefinitions={},this.outputCollectionEnabled=!1,this.connectionsToPulse={},this.connectionsToPulseChanged=!1,this.connectionsToInspect={},this.inspectedConnectionValuesToSendQueue=[],this.connectionPulsingCallbackScheduled=!1,this.editorConnection=a.editorConnection,this.rootComponent=void 0,this.editorConnection&&this.editorConnection.eventEmitter.on("connectionInspectorsUpdated",this.onConnectionInspectorsUpdated.bind(this)),this.layouter=new h}var e=a("events").EventEmitter,f=a("./noderegister"),g=a("./timerscheduler"),h=a("./layout/layouter"),i=a("./torpedwrapper");d.prototype.setRootComponent=function(a){this.rootComponent=a},d.prototype.onConnectionInspectorsUpdated=function(a){var b={};a.forEach(function(a){var c=a.fromId+a.fromProperty;b[c]=a}),this.connectionsToInspect=b,this.sendConnectionsToInspectValues()},d.prototype.layout=function(){this.rootComponent&&(this.layouter.setWindowSize(i.instance.screenWidth,i.instance.screenHeight),this.layouter.layout(this.rootComponent.getVisualRoot()))},d.prototype.update=function(){for(var a,b,c=!0,d=0;c&&10>d;){for(this.layout(),a=0;a<this._numDirtyNodes;++a)this._dirtyNodes[a].update();for(this._numDirtyNodes=0,a=0,b=this.manualUpdateQueue.length;b>a;++a)this.manualUpdateQueue[a].update();var e=this._callbacksScheduledAfterUpdate;for(this._callbacksScheduledAfterUpdate=[],a=0,b=e.length;b>a;a++)e[a]();this.layout(),c=this._callbacksScheduledAfterUpdate.length>0,d++}this.timerScheduler.hasPendingTimers()&&(this.scheduleFrame(),this.timerScheduler.runTimers(this.currentFrameTime)),this.flushConnectionsToInspect()},d.prototype.flushConnectionsToInspect=function(){this.connectionsToPulseChanged&&(this.connectionsToPulseChanged=!1,this.editorConnection.sendPulsingConnections(this.connectionsToPulse)),this.inspectedConnectionValuesToSendQueue.length>0&&(this.editorConnection.sendConnectionValues(this.inspectedConnectionValuesToSendQueue),this.inspectedConnectionValuesToSendQueue=[])},d.prototype.reset=function(){this.eventEmitter.emit("applicationDataReloaded");var a=this.eventEmitter;["frameStart","frameEnd"].forEach(function(b){a.removeAllListeners(b)}),this.globalValues={},this._dirtyNodes.length=0,this._numDirtyNodes=0,this.manualUpdateQueue.length=0,this._callbacksScheduledAfterUpdate.length=0,this.componentDefinitions={},this.timerScheduler.runningTimers=[],this.timerScheduler.newTimers=[],this.clearAllConnectionInspections()},d.prototype.nodeIsDirty=function(a){this._dirtyNodes[this._numDirtyNodes]=a,this._numDirtyNodes++,this.scheduleFrame()},d.prototype.scheduleFrame=function(){this.eventEmitter.emit("scheduleFrame")},d.prototype.scheduleAfterUpdate=function(a){this._callbacksScheduledAfterUpdate.push(a),this.scheduleFrame()},d.prototype.addToManualUpdateQueue=function(a){this.manualUpdateQueue.push(a)},d.prototype.setGlobalValue=function(a,b){this.globalValues[a]!==b&&(this.globalValues[a]=b,this.globalsEventEmitter.emit(a))},d.prototype.sendDynamicPortsToEditor=function(a,b){this.eventEmitter.emit("sendDynamicPortsToEditor",a,b)},d.prototype.reloadApplication=function(){this.eventEmitter.emit("reloadApplication")},d.prototype.callWhenFontIsActive=function(a,b){this.eventEmitter.emit("callWhenFontIsActive",a,b)},d.prototype.registerComponent=function(a){if(this.componentDefinitions.hasOwnProperty(a.name))throw new Error("Duplicate component name "+a.name);this.componentDefinitions[a.name]=a},d.prototype.getComponentDefinition=function(a){if(!a)throw new Error("Component instance must have a componentId");if(this.componentDefinitions.hasOwnProperty(a)===!1)throw new Error("Unknown component "+a);return this.componentDefinitions[a]},d.prototype.hasComponentDefinitionWithName=function(a){return this.componentDefinitions.hasOwnProperty(a)},d.prototype.createComponentInstanceNode=function(b){var c=this.getComponentDefinition(b),d=a("./nodes/componentinstance"),e=new d(this);return e.name=b,e.setComponentData(c),c.roots&&c.roots.length>0&&e.setRoot(c.roots[0]),e},d.prototype.connectionSentValue=function(a,b){if(this.editorConnection&&this.editorConnection.isConnected()){if(this.connectionsToInspect.hasOwnProperty(a.id)&&this.inspectedConnectionValuesToSendQueue.push({id:a.id,value:b}),this.connectionsToPulse.hasOwnProperty(a.id))return void(this.connectionsToPulse[a.id].timestamp=window.performance.now());var c=[];a.connections.forEach(function(b){c.push(a.owner.id+a.name+b.node.id+b.inputPortName)}),this.connectionsToPulse[a.id]={timestamp:window.performance.now(),connections:c},this.connectionsToPulseChanged=!0,this.connectionPulsingCallbackScheduled===!1&&(this.connectionPulsingCallbackScheduled=!0,window.setTimeout(this.clearOldConnectionPulsing.bind(this),100))}},d.prototype.clearAllConnectionInspections=function(){this.connectionsToInspect={},this.connectionsToPulse={},this.editorConnection.sendPulsingConnections(this.connectionsToPulse)},d.prototype.clearOldConnectionPulsing=function(){this.connectionPulsingCallbackScheduled=!1;var a=window.performance.now(),b=this,c=Object.keys(this.connectionsToPulse);c.forEach(function(c){var d=b.connectionsToPulse[c];a-d.timestamp>100&&(b.connectionsToPulseChanged=!0,delete b.connectionsToPulse[c])}),this.connectionsToPulseChanged&&(this.connectionsToPulseChanged=!1,this.editorConnection.sendPulsingConnections(this.connectionsToPulse)),Object.keys(this.connectionsToPulse).length>0&&(this.connectionPulsingCallbackScheduled=!0,window.setTimeout(this.clearOldConnectionPulsing.bind(this),100))},d.prototype.sendConnectionsToInspectValues=function(){var a=this,b=[];Object.keys(this.connectionsToInspect).forEach(function(c){var d=a.connectionsToInspect[c],e=a.rootComponent.nodeScope.findNodesWithIdRecursive(d.toId);if(e.length>0){var f=e[e.length-1];b.push({id:c,value:f._cachedInputValues[d.toProperty]})}}),b.length>0&&this.editorConnection.sendConnectionValues(b)},d.prototype.setOutputCollectionEnabled=function(a){this.outputCollectionEnabled=a,a&&this.sendConnectionsToInspectValues()},b.exports=d},{"./layout/layouter":12,"./noderegister":20,"./nodes/componentinstance":25,"./timerscheduler":74,"./torpedwrapper":75,events:3}],18:[function(a,b,c){"use strict";function d(a,b,c,d){if(a.hasOwnProperty(c))throw new Error("Input property "+c+" already registered");d.set&&(a[c]={set:d.set}),d.setUnitType&&(a[c].setUnitType=d.setUnitType),b.inputs[c]={displayName:d.displayName,editorName:d.editorName,group:d.group,type:d.type,"default":d["default"],index:d.index},d.valueChangedToTrue&&(b.inputs[c].type={name:"boolean",allowConnectionsOnly:!0})}function e(a,b,c,d){if(a.hasOwnProperty(c))throw new Error("Input property "+c+" already registered");a[c]={createSetter:d.createSetter},b.numberedInputs[c]={displayPrefix:d.displayPrefix,group:d.group,name:d.name},d.selectors&&(b.numberedInputs[c].selectors={},a[c].selectors={},Object.keys(d.selectors).forEach(function(e){var f=d.selectors[e];b.numberedInputs[c].selectors[e]={displayName:f.displayName,editorName:f.editorName,group:f.group},a[c].selectors[e]={set:f.set}}))}function f(a,b,c){Object.keys(c).forEach(function(e){d(a,b,e,c[e])})}function g(a,b){Object.keys(b).forEach(function(c){var d=b[c],e=d.type;"signal"===d.type&&(e="boolean"),a.outputs[c]={displayName:d.displayName,editorName:d.editorName,group:d.group,type:e,index:d.index}})}function h(a,b){Object.keys(b).forEach(function(c){a[c]=b[c]["default"]})}function i(a){function b(a){k.call(this,a)}if(!a.category)throw new Error("Node must have a category");if(!a.name)throw new Error("Node must have a name");var c={inputs:{},outputs:{},numberedInputs:{},category:a.category,dynamicports:a.dynamicports,allowChildren:a.allowChildren,allowChildrenWithCategory:a.allowChildrenWithCategory,allowAsChild:a.allowAsChild,panels:a.panels,color:a.color,usePortAsLabel:a.usePortAsLabel,lazyRegisteredOutputs:a.lazyRegisteredOutputs,name:a.name,displayNodeName:a.displayNodeName,deprecated:a.deprecated,haveComponentPorts:a.haveComponentPorts,version:a.version};a._internal=a._internal||{},a.prototypeExtensions=a.prototypeExtensions||{},a.inputs=a.inputs||{},a.outputs=a.outputs||{},a.numberedInputs=a.numberedInputs||{},a.initialize=a.initialize||function(){};var d={},i={};f(d,c,a.inputs),g(c,a.outputs),Object.keys(a.numberedInputs).forEach(function(b){e(i,c,b,a.numberedInputs[b])}),Object.keys(a.prototypeExtensions).forEach(function(b){a.prototypeExtensions[b].value||(a.prototypeExtensions[b]={value:a.prototypeExtensions[b]})}),b.prototype=Object.create(k.prototype,a.prototypeExtensions),Object.defineProperty(b.prototype,"name",{value:a.name});var j=function(e){var f=new b(e);return f._inputs=Object.create(d),Object.keys(a.inputs).forEach(function(b){var c=a.inputs[b];c.valueChangedToTrue&&(f._inputs[b]={set:l.createSetter({valueChangedToTrue:c.valueChangedToTrue})})}),Object.keys(a.outputs).forEach(function(b){var c=a.outputs[b];"signal"===c.type?f.registerOutput(b,{getter:function(){return!1}}):f.registerOutput(b,c)}),Object.keys(i).forEach(function(a){f.registerNumberedInput(a,i[a])}),h(f._cachedInputValues,c.inputs),a.initialize.call(f),f};return j.metadata=c,j}function j(a,b){for(var c in b)if("initialize"===c&&a.initialize){var d=a.initialize;a.initialize=function(){d.call(this),b.initialize.call(this)}}else b[c]&&b[c].constructor===Object?a[c]=j(a[c]||{},b[c]):a[c]=b[c];return a}var k=a("./node"),l=a("./edgetriggeredinput");b.exports={defineNode:i,extend:j}},{"./edgetriggeredinput":6,"./node":16}],19:[function(a,b,c){"use strict";function d(a){var b={typecasts:[{from:"boolean",to:["number","string"]},{from:"number",to:["boolean","string"]},{from:"string",to:["number","boolean","image","color"]},{from:"image",to:[]},{from:"color",to:[]},{from:"enum",to:[]},{from:"object",to:[]},{from:"reference",to:[]},{from:"font",to:[]}],projectsettings:{dynamicports:[{name:"conditionalports/basic",condition:"fillMode = aspectFit OR fillMode NOT SET",ports:[{group:"Canvas",type:"number",name:"canvasWidth",displayName:"Width","default":1080},{group:"Canvas",type:"number",name:"canvasHeight",displayName:"Height","default":1920}]}],ports:[{group:"Canvas",type:{name:"enum",enums:[{label:"Fill",value:"fill"},{label:"Aspect Fit",value:"aspectFit"}]},name:"fillMode",displayName:"Fill Mode","default":"aspectFit"}]},dynamicports:[{type:"conditionalports",name:"basic"},{type:"expand",name:"basic"},{type:"portchannel",name:"event-sender-channel",channelPortname:"channelName",typename:"Event Sender",ignorePorts:["channelName","sendEvent"]},{type:"numbered",name:"simple-number",port:{type:"number"}},{type:"numbered",name:"simple-boolean",port:{type:"boolean"}},{type:"numbered",name:"simple-string",port:{type:"string"}},{type:"numbered",name:"simple-color",port:{type:"color"}},{type:"regexp",name:"expression-mathjs",filters:[{type:"replace",regexp:"\\s",args:"g","with":""},{type:"ignore",regexp:"([a-z]|[A-Z])([a-z]|\\.|[A-Z]|[0-9])*(?=\\()",args:"g"},{type:"ignore",regexp:"pi|false|true",args:"g"},{type:"ports",regexp:"([a-z]|[A-Z])([a-z]|\\.|[A-Z]|[0-9])*",args:"g",port:{type:{name:"number"},plug:"input"}}]},{type:"regexp",name:"expression-multiline-mathjs",filters:[{type:"replace",regexp:"[ \\t]+",args:"g","with":""},{type:"ignore",regexp:"([a-z]|[A-Z])([a-z]|\\.|[A-Z]|[0-9])*(?=\\()",args:"g"},{type:"ports",regexp:"(([A-Za-z_]|[A-Za-z0-9_])+)(?==)",args:"g",port:{type:{name:"number"},plug:"output"}},{type:"ignore",regexp:"(([A-Za-z_]|[A-Za-z0-9_])+)(?==)",args:"g"},{type:"ports",regexp:"([a-z]|[A-Z])([a-z]|\\.|[A-Z]|[0-9])*",args:"g",port:{type:{name:"number"},plug:"input"}}]}],colors:{component:{base:"#6e3599",baseHighlighted:"#8440b8",header:"#6e3599",headerHighlighted:"#8440b8",outline:"#6e3599",outlineHighlighted:"#b58900",text:"#ffffff"},visual:{base:"#2a4e6e",baseHighlighted:"#376690",header:"#2a4e6e",headerHighlighted:"#376690",outline:"#2a4e6e",outlineHighlighted:"#b58900",text:"#ffffff"},javascript:{base:"#a24176",baseHighlighted:"#ab5484",header:"#a24176",headerHighlighted:"#ab5484",outline:"#ab5484",outlineHighlighted:"#d57bab",text:"#ffffff"},"default":{base:"#3e434e",baseHighlighted:"#505768",header:"#3e434e",headerHighlighted:"#505768",outline:"#3e434e",outlineHighlighted:"#b58900",text:"#ffffff"}},nodetypes:[{name:"Component Children",color:"component",panels:"none",allowAsChild:!0,category:"Visual",haveComponentChildren:["Visual"]}]};b.componentlibrary={name:"Standard Library",components:[]};var c=Object.keys(a._constructors);return c.forEach(function(c){function d(a,b){var c={name:a,type:b.type,plug:"output"};b.group&&(c.group=b.group),b.displayName&&(c.displayName=b.displayName),b.editorName&&(c.editorName=b.editorName),f.ports.push(c)}var e=a._constructors[c].metadata,f={name:c};b.nodetypes.push(f),e.version&&(f.version=e.version),e.displayNodeName&&(f.displayNodeName=e.displayNodeName),e.deprecated&&(f.deprecated=!0),e.haveComponentPorts&&(f.haveComponentPorts=!0),"Visual"===e.category&&(f.allowAsChild=!0,f.allowAsExportRoot=!0,f.color="visual"),e.allowChildren&&(f.allowChildrenWithCategory=["Visual"],f.color="visual"),e.allowChildrenWithCategory&&(f.allowChildrenWithCategory=e.allowChildrenWithCategory),e.allowAsChild&&(f.allowAsChild=!0),f.category=e.category,e.panels&&(f.panels=e.panels),e.usePortAsLabel&&(f.usePortAsLabel=e.usePortAsLabel),e.color&&(f.color=e.color),e.dynamicports&&(f.dynamicports=e.dynamicports),f.ports=[];var g=[],h={},i={};e.dynamicports&&(e.dynamicports.filter(function(a){return"conditionalports/basic"===a.name}).forEach(function(a){a.ports.forEach(function(a){i[a.name]=!0})}),e.dynamicports.filter(function(a){return void 0!==a.channelPort}).forEach(function(a){i[a.channelPort.name]=!0})),e.numberedInputs&&Object.keys(e.numberedInputs).forEach(function(a){var b=e.numberedInputs[a],c={name:b.name,prefix:a};b.displayPrefix&&(c.displayPrefix=b.displayPrefix);var d={plug:"input"};if(b.group&&(d.group=b.group),c.port=d,b.selectors){var f=[];Object.keys(b.selectors).forEach(function(a){var c=b.selectors[a];h[a]=!0;var d={name:a,plug:"input"};c.displayName&&(d.displayName=c.displayName),c.editorName&&(d.editorName=c.editorName),c.group&&(d.group=c.group),d.allowEditOnly=!0,f.push(d)}),c.selectors=f}g.push(c)}),g.length&&(f.dynamicports=g),Object.keys(e.inputs).forEach(function(a){if(!h.hasOwnProperty(a)&&!i.hasOwnProperty(a)){var b=e.inputs[a],c={name:a,type:b.type,plug:"input"};b.group&&(c.group=b.group),b.displayName&&(c.displayName=b.displayName),b.editorName&&(c.editorName=b.editorName),void 0!==b["default"]&&(c["default"]=b["default"]),b.hasOwnProperty("index")&&(c.index=b.index),f.ports.push(c)}}),Object.keys(e.outputs).forEach(function(a){var b=e.outputs[a];d(a,b)}),e.lazyRegisteredOutputs&&Object.keys(e.lazyRegisteredOutputs).forEach(function(a){var b=e.lazyRegisteredOutputs[a];d(a,b)})}),JSON.stringify(b,null,3)}b.exports=d},{}],20:[function(a,b,c){"use strict";function d(a){this._constructors={},this.context=a}Object.defineProperties(d.prototype,{register:{value:function(a){var b=a.metadata.name;if(this._constructors.hasOwnProperty(b))throw new Error("Node with name "+b+" already registered");this._constructors[b]=a}},createNode:{value:function(a){if(this._constructors.hasOwnProperty(a)===!1)throw new Error("Unknown node type with name "+a);return this._constructors[a](this.context)}},getNodeMetadata:{value:function(a){if(this._constructors.hasOwnProperty(a)===!1)throw new Error("Unknown node type with name "+a);return this._constructors[a].metadata}}}),b.exports=d},{}],21:[function(a,b,c){"use strict";function d(a){return!a}var e=a("../nodedefinition");b.exports=e.defineNode({name:"And",category:"Logic",initialize:function(){this._internal.inputs=[]},numberedInputs:{input:{name:"numbered/simple-boolean",displayPrefix:"Input",createSetter:function(a){return function(b){this._internal.inputs[a]!==b&&(this._internal.inputs[a]=b,this.flagOutputDirty("result"))}}}},outputs:{result:{type:"boolean",displayName:"Result",getter:function(){var a=this._internal.inputs;return a.length>0&&a.some(d)===!1}}}})},{"../nodedefinition":18}],22:[function(a,b,c){"use strict";function d(a){this.name=a.name,this.startValue=0,this.endValue=0,this.currentValue=void 0,this.startMode="implicit",this.ease=a.ease,this.node=a.node,this.hasSampledStartValue=!1;var b=this;this.animation=a.node.context.timerScheduler.createTimer({startValue:0,endValue:0,onRunning:function(a){var c=b.ease(this.startValue,this.endValue,a);b.setCurrentValue(c)}}),this.animation.startValue=0,this.animation.endValue=0}var e=(a("../node"),a("../nodedefinition")),f=a("../easecurves"),g=a("bezier-easing");Object.defineProperties(d.prototype,{setCurrentValue:{value:function(a){this.currentValue=a,this.node.flagOutputDirty(this.name)}},play:{value:function(a,b){if(void 0===a&&(console.log("Animation warning, start value is undefined"),a=0),void 0===b)return void console.error("Animation error, start:",a,"end:",b);var c=this.animation;c.startValue=a,this.setCurrentValue(a),c.endValue=b,c.duration=this.node._internal.duration,c.start()}},playToEnd:{value:function(){this.hasConnections()!==!1&&(this.updateStartValue(),this.play(this.getTargetsCurrentValue(),this.endValue))}},playToStart:{value:function(){this.hasConnections()!==!1&&(this.updateStartValue(),this.play(this.getTargetsCurrentValue(),this.startValue))}},replayToEnd:{value:function(){this.hasConnections()!==!1&&(this.updateStartValue(),this.play(this.startValue,this.endValue))}},replayToStart:{value:function(){this.hasConnections()!==!1&&this.play(this.endValue,this.startValue)}},hasConnections:{value:function(){return this.node.getOutput(this.name).hasConnections()}},getTargetsCurrentValue:{value:function(){var a=this.node.getOutput(this.name).connections;return a[0].node._cachedInputValues[a[0].inputPortName]}},updateStartValue:{value:function(){"implicit"!==this.startMode||this.hasSampledStartValue||(this.hasSampledStartValue=!0,this.startValue=this.getTargetsCurrentValue())}},stop:{value:function(){this.animation.stop(),this.setCurrentValue(void 0)}},jumpToStart:{value:function(){this.animation.stop(),this.setCurrentValue(this.startValue)}},jumpToEnd:{value:function(){this.animation.stop(),this.setCurrentValue(this.endValue)}}});var h=[{value:"easeOut",label:"Ease Out"},{value:"easeIn",label:"Ease In"},{value:"linear",label:"Linear"},{value:"easeInOut",label:"Ease In Out"},{value:"cubicBezier",label:"Cubic Bezier"}],i=300,j={name:"Animation",category:"Animation",initialize:function(){var a=this._internal;a.duration=i,a.ease=f.easeOut,a._isPlayingToEnd=!1,a.animations=[],a.cubicBezierPoints=[0,0,0,0],a.cubicBezierFunction=void 0;var b=this;a.animation=this.context.timerScheduler.createTimer({onFinish:function(){a._isPlayingToEnd===!1?b.sendSignalOnOutput("hasReachedStart"):b.sendSignalOnOutput("hasReachedEnd")}})},inputs:{duration:{index:0,type:"number",displayName:"Duration (ms)",group:"Animation Properties","default":i,set:function(a){this._internal.duration=a}},easingCurve:{index:10,type:{name:"enum",enums:h},group:"Animation Properties",displayName:"Easing Curve","default":"easeOut",set:function(a){var b;"cubicBezier"===a?(this.updateCubicBezierFunction(),b=this._internal.cubicBezierFunction):b=f[a],this._internal.ease=b}},playToEnd:{index:20,group:"Play",displayName:"To End",editorName:"Play To End",valueChangedToTrue:function(){this._internal._isPlayingToEnd=!0;var a=this._internal.animation,b=this._internal.animations,c=this;this.scheduleAfterInputsHaveUpdated(function(){a.duration=c._internal.duration,a.start();for(var d=0;d<b.length;d++)b[d].ease=c._internal.ease,b[d].playToEnd()})}},playToStart:{index:21,group:"Play",displayName:"To Start",editorName:"Play To Start",valueChangedToTrue:function(){this._internal._isPlayingToEnd=!1;var a=this._internal.animation,b=this._internal.animations,c=this;this.scheduleAfterInputsHaveUpdated(function(){a.duration=c._internal.duration,a.start();for(var d=0;d<b.length;d++)b[d].ease=c._internal.ease,b[d].playToStart()})}},replayToEnd:{index:22,group:"Play",displayName:"From Start To End",editorName:"Play From Start To End",valueChangedToTrue:function(){var a=this._internal.animation,b=this._internal.animations,c=this;this._internal._isPlayingToEnd=!0,this.scheduleAfterInputsHaveUpdated(function(){a.duration=c._internal.duration,a.start();for(var d=0;d<b.length;d++)b[d].ease=c._internal.ease,b[d].replayToEnd()})}},replayToStart:{index:23,group:"Play",displayName:"From End To Start",editorName:"Play From End To Start",valueChangedToTrue:function(){this._internal._isPlayingToEnd=!1;var a=this._internal.animation,b=this._internal.animations,c=this;this.scheduleAfterInputsHaveUpdated(function(){a.duration=c._internal.duration,a.start();for(var d=0;d<b.length;d++)b[d].ease=c._internal.ease,b[d].replayToStart()})}},stop:{index:60,group:"Instant Actions",displayName:"Stop",valueChangedToTrue:function(){var a=this._internal.animation,b=this._internal.animations;a.stop();for(var c=0;c<b.length;c++)b[c].stop()}},jumpToStart:{index:61,group:"Instant Actions",displayName:"Jump To Start",valueChangedToTrue:function(){for(var a=this._internal.animations,b=0;b<a.length;b++)a[b].jumpToStart();this.sendSignalOnOutput("hasReachedStart")}},jumpToEnd:{index:62,group:"Instant Actions",displayName:"Jump To End",valueChangedToTrue:function(){for(var a=this._internal.animations,b=0;b<a.length;b++)a[b].jumpToEnd();this.sendSignalOnOutput("hasReachedEnd")}},cubicBezierP1X:{set:function(a){this._internal.cubicBezierPoints[0]=Math.min(1,Math.max(0,a)),this.updateCubicBezierFunction()}},cubicBezierP1Y:{set:function(a){this._internal.cubicBezierPoints[1]=a,this.updateCubicBezierFunction()}},cubicBezierP2X:{set:function(a){this._internal.cubicBezierPoints[2]=Math.min(1,Math.max(0,a)),this.updateCubicBezierFunction()}},cubicBezierP2Y:{set:function(a){this._internal.cubicBezierPoints[3]=a,this.updateCubicBezierFunction()}}},outputs:{hasReachedStart:{type:"signal",group:"Signals",displayName:"Has Reached Start"},hasReachedEnd:{type:"signal",group:"Signals",displayName:"Has Reached End"}},dynamicports:[{name:"conditionalports/basic",condition:"easingCurve = cubicBezier",ports:[{name:"cubicBezierP1X",displayName:"P1 X",group:"Cubic Bezier",plug:"input",type:{name:"number"},index:11},{name:"cubicBezierP1Y",displayName:"P1 Y",group:"Cubic Bezier",plug:"input",type:{name:"number"},index:12},{name:"cubicBezierP2X",displayName:"P2 X",group:"Cubic Bezier",plug:"input",type:{name:"number"},index:13},{name:"cubicBezierP2Y",displayName:"P2 Y",group:"Cubic Bezier",plug:"input",type:{name:"number"},index:14}]},{name:"expand/basic",indexStep:100,template:[{name:"{{portname}}.startMode",type:{name:"enum",enums:[{value:"explicit",label:"Explicit"},{value:"implicit",label:"Implicit"}],allowEditOnly:!0},plug:"input",group:"{{portname}} Animation",displayName:"Start Mode","default":"implicit",index:1e3},{name:"{{portname}}.endValue",type:"number",plug:"input",group:"{{portname}} Animation",displayName:"End Value",editorName:"End Value | {{portname}} ","default":0,index:1002}]},{name:"expand/basic",condition:"'{{portname}}.startMode' = explicit",indexStep:100,template:[{name:"{{portname}}.startValue",plug:"input",type:"number",displayName:"Start Value",editorName:"Start Value | {{portname}}",group:"{{portname}} Animation","default":0,index:1001}]}],panels:[{name:"PortEditor",title:"Animations",plug:"output",type:{name:"number"},group:"Animation Values"}],prototypeExtensions:{updateCubicBezierFunction:{value:function(){var a=this._internal.cubicBezierPoints,b=g(a[0],a[1],a[2],a[3]);this._internal.cubicBezierFunction=function(a,c,d){return f.linear(a,c,b(d))},this._internal.ease=this._internal.cubicBezierFunction}},_registerAnimationGroup:{value:function(a){var b=new d({node:this,ease:this._internal.ease,name:a});this._internal.animations.push(b);var c={};c[a+".startMode"]={set:function(a){b.startMode=a}},c[a+".startValue"]={"default":0,set:function(a){b.startValue=a}},c[a+".endValue"]={"default":0,set:function(a){b.endValue=a}},this.registerInputs(c),this.registerOutput(a,{getter:function(){return b.currentValue}})}},registerInputIfNeeded:{value:function(a){if(!this.hasInput(a)){var b=a.indexOf("."),c=a.substr(0,b);this.hasOutput(c)||this._registerAnimationGroup(c)}}},registerOutputIfNeeded:{value:function(a){this.hasOutput(a)||this._registerAnimationGroup(a)}}}};b.exports=e.defineNode(j)},{"../easecurves":5,"../node":16,"../nodedefinition":18,"bezier-easing":1}],23:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=a("../torpedwrapper"),f={name:"Color Blend",category:"Interpolation",initialize:function(){var a=this._internal;a.resultColor=[0,0,0],a.result=[0,0,0],a.blendValue=0,a.colors=[]},numberedInputs:{color:{name:"numbered/simple-color",displayPrefix:"Color",createSetter:function(a){return function(b){this._internal.colors[a]=b,this.updateColor()}}}},inputs:{blendValue:{type:"number",displayName:"Blend Value","default":0,set:function(a){this._internal.blendValue=a,this.updateColor()}}},outputs:{result:{type:"color",displayName:"Result",getter:function(){return this._internal.resultColor}}},prototypeExtensions:{updateColor:function(){var a=this._internal.colors;if(0!==a.length){var b=e.Math.clamp(0,a.length-1,this._internal.blendValue),c=Math.floor(b),d=b-c;0===d?e.Color.setArray(this._internal.resultColor,a[c]):(e.Color.setArray(g,a[c]),e.Color.setArray(h,a[c+1]),this._internal.result[0]=e.linear(g[0],h[0],d),this._internal.result[1]=e.linear(g[1],h[1],d),this._internal.result[2]=e.linear(g[2],h[2],d),this._internal.resultColor=this._internal.result),this.flagOutputDirty("result")}}}},g=[0,0,0],h=[0,0,0];b.exports=d.defineNode(f)},{"../nodedefinition":18,"../torpedwrapper":75}],24:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Component Inputs",panels:[{name:"PortEditor",context:["select","connectFrom"],title:"Inputs",plug:"output",type:{name:"*"}},{name:"PropertyEditor",hidden:!0}],color:"component",haveComponentPorts:!0,category:"Component Utilities",initialize:function(){this._internal.outputs={}},prototypeExtensions:{setInputFromComponentInstance:function(a,b){this._internal.outputs[a]!==b&&(this._internal.outputs[a]=b,this.flagOutputDirty(a))},registerOutputIfNeeded:function(a){this.hasOutput(a)||this.registerOutput(a,{getter:function(){return this._internal.outputs[a]}})}}})},{"../nodedefinition":18}],25:[function(a,b,c){"use strict";function d(a){e.call(this,a),this.nodeScope=new f(a,this),this._internal.childRoot=null,this._internal.componentOutputValues={},this._internal.componentOutputs=[],this._internal.componentInputs=[],this._internal._numChildrenAdded=0,this.context.addToManualUpdateQueue(this)}var e=a("../node"),f=a("../nodescope");d.prototype=Object.create(e.prototype,{setComponentData:{value:function(a){var b=this;this.nodeScope.addData(a),this._internal.componentInputs=this.nodeScope.findNodesWithName("Component Inputs"),this._internal.componentOutputs=this.nodeScope.findNodesWithName("Component Outputs"),a.ports&&a.ports.forEach(function(a){("input/output"===a.plug||"input"===a.plug)&&b.registerComponentInput(a.name),("input/output"===a.plug||"output"===a.plug)&&b.registerComponentOutput(a.name)})}},registerComponentInput:{value:function(a){this.registerInput(a,{set:function(b){this._internal.componentInputs.forEach(function(c){c.registerOutputIfNeeded(a),c.setInputFromComponentInstance(a,b)})}})}},registerComponentOutput:{value:function(a){this.registerOutput(a,{getter:function(){return this._internal.componentOutputValues[a]}})}},setOutputFromComponentOutput:{value:function(a,b){this.hasOutput(a)!==!1&&this._internal.componentOutputValues[a]!==b&&(this._internal.componentOutputValues[a]=b,this.flagOutputDirty(a))}},registerInputIfNeeded:{value:function(a){this.hasInput(a)||this.registerInput(a,{set:function(){}})}},registerOutputIfNeeded:{value:function(a){this.hasOutput(a)||this.registerOutput(a,{getter:function(){return void 0}})}},setRoot:{value:function(a){if(!a)throw Error("id must be set");this._internal.root=this.nodeScope.getNode(a);var b=this._internal.root.getVisualRoot();void 0===b.componentIds&&(b.componentIds=[]),-1===b.componentIds.indexOf(this.id)&&b.componentIds.push(this.id)}},getChildRoot:{value:function(){return this._internal.childRoot?this._internal.childRoot:this._internal.root.getChildRoot()}},getVisualRoot:{value:function(){return this._internal.root?this._internal.root.getVisualRoot():void 0}},addChild:{value:function(a){var b,c=this.getChildRoot();void 0!==c._internal.componentChildrenIndex&&(b=c._internal.componentChildrenIndex+this._internal._numChildrenAdded,this._internal._numChildrenAdded++),this.getChildRoot().addChild(a,b)}}}),d.prototype.constructor=d,b.exports=d},{"../node":16,"../nodescope":70}],26:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({category:"Component Utilities",name:"Component Outputs",panels:[{name:"PortEditor",context:["select","connectTo"],title:"Outputs",plug:"input",type:{name:"*"}},{name:"PropertyEditor",hidden:!0}],color:"component",haveComponentPorts:!0,initialize:function(){this.context.addToManualUpdateQueue(this)},prototypeExtensions:{registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:function(b){this.nodeScope.componentOwner.setOutputFromComponentOutput(a,b)}})}}})},{"../nodedefinition":18}],27:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Counter",category:"Math",initialize:function(){this._internal.currentValue=0,
this._internal.startValue=0,this._internal.startValueSet=!1},inputs:{increase:{displayName:"Increase Count",valueChangedToTrue:function(){this._internal.currentValue++,this.flagOutputDirty("currentCount")}},decrease:{displayName:"Decrease Count",valueChangedToTrue:function(){this._internal.currentValue--,this.flagOutputDirty("currentCount")}},reset:{displayName:"Reset To Start",valueChangedToTrue:function(){0!==this.currentValue&&(this._internal.currentValue=this._internal.startValue,this.flagOutputDirty("currentCount"))}},startValue:{type:"number",displayName:"Start Value","default":0,set:function(a){this._internal.startValue=Number(a),this._internal.startValueSet===!1&&(this._internal.startValueSet=!0,this._internal.currentValue=this._internal.startValue,this.flagOutputDirty("currentCount"))}}},outputs:{currentCount:{displayName:"Current Count",type:"number",getter:function(){return this._internal.currentValue}}}})},{"../nodedefinition":18}],28:[function(a,b,c){"use strict";function d(a){var b=this._internal.snapPositions.length-1;return this._internal.snapPositions.some(function(c,d){return c>a?(b=d-1,!0):!1}),b}function e(a){this._internal.currentSnappedIndex!==a&&(this._internal.currentSnappedIndex=a,this.flagOutputDirty("currentIndex"))}function f(a,b,c){var d=b+(c>0?1:-1);return d=l.Math.clamp(0,a.length-1,d)}function g(a,b,c,d){var e=.5,f=.02,g=50,h=a.length-1,i=Math.abs(c-a[b]),j=Math.abs(d);if(g>i&&e>j)return b;for(var k=0;k<a.length;++k){if(i=Math.abs(c-a[k]),g>i&&f>j){h=k,d>0&&h--;break}if(a[k]>c){h=k-1;break}}return d>0&&h++,l.Math.clamp(0,a.length-1,h)}function h(a,b,c){var d;if("none"!==this._internal.snapBehavior){d="everyPosition"===this._internal.snapBehavior?f(this._internal.snapPositions,a,c):g(this._internal.snapPositions,this._internal.currentSnappedIndex,b,c);var h=this._internal.snapAnimation;h.startPosition=b,h.endPosition=this._internal.snapPositions[d],h.start(),e.call(this,d)}}function i(a){var b=a;this._internal.clampEnabled===!0&&(b=l.Math.clamp(this._internal.clampMin,this._internal.clampMax,a)),this._internal.target.setInputValue(0===this._internal.dragGestureRecognizer.axis?"x":"y",b)}function j(){return this._internal.target._internal[0===this._internal.dragGestureRecognizer.axis?"positionX":"positionY"]}function k(a,b){if(a._internal.dragEnabled!==!1){var c=a._internal.dragGestureRecognizer.onTouch(b);return a._internal.track?c:void 0}}var l=(a("../node"),a("../torpedwrapper")),m=a("../nodedefinition"),n=a("../easecurves"),o={name:"Drag",category:"Interaction",initialize:function(){var a=this,b=this._internal,c=l.instance;b.snapPositions=[0],b.target=void 0,b.track=!0,b.startSnapIndex=0,b.currentSnappedIndex=0,b.snapBehavior="none",b.dragEnabled=!0,b.dragRatio=1,b.snapDuration=300,b.clampMin=0,b.clampMax=0,b.clampEnabled=!1,b.snapAnimation=this.context.timerScheduler.createTimer({duration:b.snapDuration,ease:n.easeOut,startPosition:0,endPosition:0,onRunning:function(b){i.call(a,this.ease(this.startPosition,this.endPosition,b))}}),b.controlStart=0,b.indexOnDragStart=0,b.snapIndex=0,b.dragGestureRecognizer=c.uiComponents.createDragGestureRecognizer({axis:0,onDragStart:function(){b.snapAnimation.stop(),a.sendSignalOnOutput("dragStart"),b.controlStart=j.call(a),b.indexOnDragStart=d.call(a,b.controlStart)},onDrag:function(){var c=b.controlStart+this.dragDistance*b.dragRatio;if("none"!==b.snapBehavior){var d=b.snapPositions[0],e=b.snapPositions[b.snapPositions.length-1];c=l.Math.clamp(d,e,c)}i.call(a,c)},onDragEnd:function(){a.sendSignalOnOutput("dragEnd"),h.call(a,b.indexOnDragStart,j.call(a),this.velocity)}}),this.context.addToManualUpdateQueue(this)},inputs:{target:{type:"reference",displayName:"Target",group:"Target Node",set:function(a){var b=a.getVisualRoot();if(!b._internal.control)throw new Error("target must be a visual node, not a "+b.name);this._internal.target=b,this._internal.target.addTouchHandler(k.bind(null,this),this);var c=this;this.context.scheduleAfterUpdate(function(){"none"!==c._internal.snapBehavior&&i.call(c,c._internal.snapPositions[c._internal.startSnapIndex])})}},axis:{type:{name:"enum",enums:[{value:"0",label:"Horizontal"},{value:"1",label:"Vertical"}]},"default":"0",displayName:"Drag Direction",group:"Drag Behavior",set:function(a){this._internal.dragGestureRecognizer.axis=Number(a)}},snapBehavior:{type:{name:"enum",enums:[{value:"none",label:"None"},{value:"everyPosition",label:"Every Position"},{value:"closestPosition",label:"Closest Position"}]},"default":"none",group:"Drag Behavior",displayName:"Snap Behavior",set:function(a){this._internal.snapBehavior=a}},track:{type:"boolean",displayName:"Track Touch",group:"Drag Behavior","default":!0,set:function(a){this._internal.track=a}},dragThreshold:{type:{name:"number",allowEditOnly:!0},displayName:"Drag Threshold",group:"Drag Behavior","default":50,set:function(a){this._internal.dragGestureRecognizer.threshold=a}},dragEnabled:{type:{name:"boolean"},displayName:"Drag Enabled",group:"Drag Behavior","default":!0,set:function(a){this._internal.dragEnabled=a?!0:!1}},dragRatio:{type:"number",displayName:"Drag Ratio","default":1,group:"Drag Behavior",set:function(a){this._internal.dragRatio=Number(a)}},"snapToIndex.index":{type:"number",displayName:"Index",group:"Snap To Index","default":0,set:function(a){a===!0?a=1:a===!1&&(a=0),this._internal.snapIndex=Math.floor(a)}},"snapToIndex.duration":{type:"number",displayName:"Duration",editorName:"Duration|Snap To Index",group:"Snap To Index","default":300,set:function(a){this._internal.snapDuration=a}},"snapToIndex.do":{group:"Snap To Index",displayName:"Do",editorName:"Do|Snap To Index",valueChangedToTrue:function(){var a=this._internal.snapAnimation,b=this;this.scheduleAfterInputsHaveUpdated(function(){a.startPosition=j.call(b),a.endPosition=b._internal.snapPositions[b._internal.snapIndex],a.duration=b._internal.snapDuration,a.start(),e.call(b,b._internal.snapIndex)})}},"clampDragPosition.min":{type:{name:"number"},displayName:"Start",group:"Constrain","default":0,set:function(a){this._internal.clampMin=a}},"clampDragPosition.max":{type:{name:"number"},displayName:"End",group:"Constrain","default":0,set:function(a){this._internal.clampMax=a}},"clampDragPosition.enabled":{type:{name:"boolean"},displayName:"Constrain",group:"Constrain","default":!1,set:function(a){this._internal.clampEnabled=a}}},numberedInputs:{position:{name:"numbered/simple-number",displayPrefix:"Position",group:"Snap Positions",createSetter:function(a){return function(b){this._internal.snapPositions[a]=b}},selectors:{startAt:{displayName:"Start At",group:"Snap Positions",set:function(a){var b=this._internal;b.startSnapIndex=a,e.call(this,a),b.target&&a<b.snapPositions.length&&i.call(this,b.snapPositions[b.startSnapIndex])}}}}},outputs:{dragStart:{group:"Signals",type:"signal",displayName:"Drag Started"},dragEnd:{group:"Signals",type:"signal",displayName:"Drag Ended"},currentIndex:{group:"Current State",type:"number",displayName:"Current Index",getter:function(){return this._internal.currentSnappedIndex}}}};b.exports=m.defineNode(o)},{"../easecurves":5,"../node":16,"../nodedefinition":18,"../torpedwrapper":75}],29:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e={name:"Event Receiver",category:"Events",usePortAsLabel:"channelName",color:"component",initialize:function(){var a=this._internal;a.outputValues={},a.outputNames=[],a.eventReceived=!1,a._isEnabled=!0,a.channelName=""},dynamicports:[{name:"portchannel/event-sender-channel",channelPort:{name:"channelName",displayName:"Channel",plug:"input"},port:{type:"*",plug:"output",allowConnectionOnly:!0}}],inputs:{enabled:{displayName:"Enabled",type:"boolean","default":!0,set:function(a){this._internal._isEnabled=a?!0:!1}},channelName:{set:function(a){this._internal.channelName=a,this.registerListenersForChannel(a)}}},outputs:{eventReceived:{displayName:"Event Received",type:"signal"}},prototypeExtensions:{registerOutputIfNeeded:function(a){if(!this.hasOutput(a)){var b=this;this._internal.outputNames.push(a),this.registerOutput(a,{getter:function(){return b._internal.outputValues[a]}})}},handleEvent:function(a){if(this._internal._isEnabled!==!1){this.sendSignalOnOutput("eventReceived");for(var b in a)this.hasOutput(b)&&(this._internal.outputValues[b]=a[b],this.flagOutputDirty(b))}},onEventReceived:function(a){this.handleEvent(a)},registerListenersForChannel:function(a){var b=this.context.eventSenderEmitter,c=this.onEventReceived.bind(this);b.on(a,c),this.context.eventEmitter.once("applicationDataReloaded",function(){b.removeListener(a,c)})}}};b.exports=d.defineNode(e)},{"../nodedefinition":18}],30:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e={name:"Event Sender",category:"Events",usePortAsLabel:"channelName",color:"component",panels:[{name:"PortEditor",context:["select","connectFrom"],title:"Inputs",plug:"input",type:{name:"*",allowConnectionOnly:!0}}],initialize:function(){this._internal.inputValues={},this._internal.channelName="",this.context.addToManualUpdateQueue(this)},inputs:{sendEvent:{displayName:"Send Event",valueChangedToTrue:function(){var a=this;this.scheduleAfterInputsHaveUpdated(function(){a.context.eventSenderEmitter.emit(a._internal.channelName,a._internal.inputValues)})}},channelName:{type:{name:"string",allowEditOnly:!0},"default":"",displayName:"Channel Name",set:function(a){this._internal.channelName=a,this._internal.inputValues._channelName=a}}},prototypeExtensions:{registerInputIfNeeded:{value:function(a){if(!this.hasInput(a)){var b=this;this.registerInput(a,{set:function(c){b._internal.inputValues[a]=c}})}}}}};b.exports=d.defineNode(e)},{"../nodedefinition":18}],31:[function(a,b,c){"use strict";function d(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c}var e=a("../nodedefinition"),f=(a("../node"),{name:"Expression",category:"Math",usePortAsLabel:"expression",initialize:function(){var a=this._internal;a.scope={},a.hasScheduledEvaluation=!1,a.code=void 0,a.cachedValue=0,a.currentExpression="",a.compiledFunction=void 0,a.inputNames=[],a.inputValues=[]},dynamicports:[{name:"regexp/expression-mathjs",port:"expression"}],inputs:{expression:{type:{name:"string",allowEditOnly:!0},displayName:"Expression",set:function(a){this._internal.currentExpression=g+"return ("+a+");",this._internal.compiledFunction=void 0,this._scheduleEvaluateExpression()}}},outputs:{result:{type:"number",displayName:"Result",getter:function(){return this._internal.currentExpression?this._internal.cachedValue:0}}},prototypeExtensions:{registerInputIfNeeded:{value:function(a){if(!this.hasInput(a)){var b=this._internal,c={set:function(c){b.scope[a]=c,this._scheduleEvaluateExpression()}};this.registerInput(a,c),b.scope[a]=0,this._cachedInputValues[a]=0,b.inputNames=Object.keys(b.scope)}}},_scheduleEvaluateExpression:{value:function(){var a=this._internal;a.hasScheduledEvaluation===!1&&(a.hasScheduledEvaluation=!0,this.flagDirty(),this.scheduleAfterInputsHaveUpdated(function(){var b=a.cachedValue;a.cachedValue=this._calculateExpression(),b!==a.cachedValue&&this.flagOutputDirty("result"),a.hasScheduledEvaluation=!1}))}},_calculateExpression:{value:function(){var a=this._internal;a.compiledFunction||(a.compiledFunction=this._compileFunction());for(var b=0;b<a.inputNames.length;++b){var c=a.scope[a.inputNames[b]];a.inputValues[b]=c}try{return a.compiledFunction.apply(null,a.inputValues)}catch(d){console.error("Error in expression:",d.message)}return 0}},_compileFunction:{value:function(){var a=this._internal.currentExpression;if(h.hasOwnProperty(a)===!1){var b=Object.keys(this._internal.scope);b.push(a);try{h[a]=d(Function,b)}catch(c){console.error("Failed to compile JS function",c.message)}}return h[a]}}}}),g=["var min = Math.min,    max = Math.max,    cos = Math.cos,    sin = Math.sin,    tan = Math.tan,    sqrt = Math.sqrt,    pi = Math.PI,    round = Math.round,    floor = Math.floor,    ceil = Math.ceil,    abs = Math.abs,    random = Math.random;"].join(""),h={};b.exports=e.defineNode(f)},{"../node":16,"../nodedefinition":18}],32:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=(a("../node"),{name:"Globals",category:"Utilities",color:"component",panels:[{name:"PortEditor",context:["select","connectTo","connectFrom"],title:"Globals",plug:"input/output",type:{name:"*"}}],initialize:function(){this.context.addToManualUpdateQueue(this)},prototypeExtensions:{_newOutputValueReceived:{value:function(a){this._cachedInputValues[a]=this.context.globalValues[a],this.flagOutputDirty(a)}},registerInputIfNeeded:{value:function(a){var b=this;this.hasInput(a)||this.registerInput(a,{set:b.context.setGlobalValue.bind(b.context,a)})}},registerOutputIfNeeded:{value:function(a){if(!this.hasOutput(a)){var b=this._newOutputValueReceived.bind(this,a),c=this.context.globalsEventEmitter;c.on(a,b),this.context.eventEmitter.once("applicationDataReloaded",function(){c.removeListener(a,b)}),this.registerOutput(a,{getter:function(){return this.context.globalValues[a]}})}}}}});b.exports=d.defineNode(e)},{"../node":16,"../nodedefinition":18}],33:[function(a,b,c){"use strict";function d(a){a.alpha!==this._internal.alpha&&(this._internal.alpha=a.alpha,this.flagOutputDirty("rotationZ")),a.beta!==this._internal.beta&&(this._internal.beta=a.beta,this.flagOutputDirty("rotationX")),a.gamma!==this._internal.gamma&&(this._internal.gamma=a.gamma,this.flagOutputDirty("rotationY"))}var e=a("../nodedefinition"),f={name:"Gyroscope",displayNodeName:"Device Orientation",category:"Sensors",initialize:function(){this._internal.alpha=0,this._internal.beta=0,this._internal.gamma=0;var a=d.bind(this);window.addEventListener("deviceorientation",a),this.context.eventEmitter.once("applicationDataReloaded",function(){window.removeEventListener("deviceorientation",a)})},outputs:{rotationX:{type:"number",displayName:"Rotation X",getter:function(){return-this._internal.beta}},rotationY:{type:"number",displayName:"Rotation Y",getter:function(){return this._internal.gamma}},rotationZ:{type:"number",displayName:"Rotation Z",getter:function(){return-this._internal.alpha}}}};b.exports=e.defineNode(f)},{"../nodedefinition":18}],34:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Inputs To Object",panels:[{name:"PortEditor",context:["select","connectTo"],title:"Inputs",plug:"input",type:{name:"*"}},{name:"PropertyEditor",hidden:!0}],category:"Data",initialize:function(){this._internal.inputs={},this._internal.outputScheduled=!1},outputs:{object:{displayName:"Object",type:"object",getter:function(){if(0===Object.keys(this._internal.inputs).length)return void 0;var a={};for(var b in this._internal.inputs)a[b]=this._internal.inputs[b];return a}}},prototypeExtensions:{registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:function(b){this._internal.inputs[a]=b;var c=this;this._internal.outputScheduled===!1&&(this._internal.outputScheduled=!0,this.scheduleAfterInputsHaveUpdated(function(){c._internal.outputScheduled=!1,c.flagOutputDirty("object")}))}})}}})},{"../nodedefinition":18}],35:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e={name:"Inverter",category:"Math",initialize:function(){this._internal.currentValue=!1},inputs:{value:{type:{name:"boolean"},displayName:"Value",set:function(a){this._internal.currentValue=a,this.flagOutputDirty("result")}}},outputs:{result:{type:"boolean",displayName:"Result",getter:function(){return!this._internal.currentValue}}}};b.exports=d.defineNode(e)},{"../nodedefinition":18}],36:[function(a,b,c){"use strict";function d(){return this._internal.isFirstFrame?void(this._internal.isFirstFrame=!1):(this._evaluateFunction(),this.context.nodeIsDirty(this),void this.flagDirty())}function e(a,b){this._internal.needsToEval=!0,this._internal.inputValues[a]=b,this.flagDirty()}function f(a){return this._internal.needsToEval&&this._evaluateFunction(),this._internal.outputValues[a]}var g=a("../nodedefinition"),h=a("../node"),i={};b.exports=g.defineNode({name:"Javascript",category:"Javascript",displayNodeName:"Javascript (Deprecated)",deprecated:!0,panels:[{name:"PortEditor",context:["select"],title:"Inputs",plug:"input",type:{name:"*"}},{name:"PortEditor",context:["select"],title:"Outputs",plug:"output",type:{name:"*"}}],initialize:function(){var a=this._internal;a.inputValues={},a.outputValues={},a.needsToEval=!1;var b=this;a.userFunctionScope={flagOutputDirty:function(a){if(!a)throw new Error("Output port name must be specified");b.flagOutputDirty(a)}},a.isFirstFrame=!0,a.onFrameStart=d.bind(this),this.context.addToManualUpdateQueue(this)},inputs:{code:{type:{name:"string",allowEditOnly:!0,codeeditor:"javascript"},displayName:"code",group:"Code",set:function(a){i[a]||(i[a]=new Function("inputs","outputs",a)),this._internal.userFunction=i[a],this._internal.needsToEval=!0}},runEveryFrame:{type:"boolean",displayName:"Run Every Frame",group:"Settings",set:function(a){a=a?!0:!1;var b=this.context.eventEmitter;a===!0?b.on("frameStart",this._internal.onFrameStart):b.removeListener("frameStart",this._internal.onFrameStart)}}},prototypeExtensions:{update:{value:function(){this._dirty===!1||this._isUpdating||(h.prototype.update.call(this),this._internal.needsToEval&&(this._evaluateFunction(),this.flagDirty()))}},registerInputIfNeeded:{value:function(a){this.hasInput(a)||this.registerInput(a,{set:e.bind(this,a)})}},registerOutputIfNeeded:{value:function(a){this.hasOutput(a)||this.registerOutput(a,{getter:f.bind(this,a)})}},_evaluateFunction:{value:function(){var a=this._internal;a.userFunction.call(a.userFunctionScope,a.inputValues,a.outputValues),a.needsToEval=!1}},flagDirty:{value:function(){for(var a in this._internal.outputValues)this.flagOutputDirty(a);h.prototype.flagDirty.call(this)}}}})},{"../node":16,"../nodedefinition":18}],37:[function(a,b,c){"use strict";function d(){for(var a in this._internal.dirtyOutputs)this.flagOutputDirty(a);this._internal.dirtyOutputs={}}function e(){this._internal.setupScheduled||(this._internal.setupScheduled=!0,this.flagDirty(),this.scheduleAfterInputsHaveUpdated(function(){this._callSetupFunction(),this._internal.setupScheduled=!1,d.call(this)}))}function f(){this._internal.runScheduled||(this._internal.runScheduled=!0,this.flagDirty(),this.scheduleAfterInputsHaveUpdated(function(){this._callRunFunction(),this._internal.runScheduled=!1,d.call(this)}))}function g(){this._internal.runNextFrame=!1,f.call(this)}function h(a,b){this._internal.inputValues[a]=b,this._internal.isWaitingForExternalFileToLoad===!1&&f.call(this)}function i(a){return this._internal.outputValues[a]}var j=a("../nodedefinition"),k=a("../node"),l=a("../javascriptnodeparser"),m=["define({","    inputs: {",'        inputValue: "number"',"    },","    outputs: {",'        outputValue: "number"',"    },","    setup: function(inputs, outputs) {","","    },","    run: function(inputs, outputs) {","","    }","});"].join("\n");b.exports=j.defineNode({name:"Javascript2",displayNodeName:"Javascript",category:"Javascript",color:"javascript",initialize:function(){var a=this._internal;a.inputValues={},a.outputValues={},a.outputProperties={},a.dirtyOutputs={},a.runScheduled=!1,a.setupScheduled=!1,a.runNextFrameScheduled=!1,a.isWaitingForExternalFileToLoad=!1,a.useExternalFile=!1,a.runFunction=void 0,a.setupFunction=void 0;var b=this;a.userFunctionScope={flagOutputDirty:function(c){if(!c)throw new Error("Output port name must be specified");b.flagOutputDirty(c),a.dirtyOutputs.hasOwnProperty(c)&&delete a.dirtyOutputs[c]},runNextFrame:function(){a.runNextFrameScheduled||(a.runNextFrameScheduled=!0,b.context.scheduleAfterUpdate(function(){a.runNextFrameScheduled=!1,f.call(b),b.context.scheduleFrame()}))},sendSignalOnOutput:function(c){a.outputValues[c]=!0,b.flagOutputDirty(c),a.outputValues[c]=!1,b.flagOutputDirty(c)}},a.onFrameStart=g.bind(this),this.context.addToManualUpdateQueue(this)},dynamicports:[{name:"conditionalports/basic",condition:"useExternalFile = no OR useExternalFile NOT SET",ports:[{name:"code",displayName:"Code",group:"Code",plug:"input",type:{name:"string",allowEditOnly:!0,codeeditor:"javascript"},"default":m}]},{name:"conditionalports/basic",condition:"useExternalFile = yes",ports:[{name:"externalFile",displayName:"File Path",group:"Code",plug:"input",type:{name:"source",allowEditOnly:!0}}]}],inputs:{useExternalFile:{type:{name:"enum",enums:[{value:"yes",label:"Yes"},{value:"no",label:"No"}],allowEditOnly:!0},"default":"no",displayName:"Use External File",group:"Code",set:function(a){this._internal.isWaitingForExternalFileToLoad="yes"===a,this._internal.useExternalFile="yes"===a}},code:{set:function(a){if(a){var b=l.createFromCode(a,this.nodeScope.noodlJavascriptAPI);this._onCodeParsed(b)}}},externalFile:{set:function(a){if(this._internal.useExternalFile!==!1){this.context.runningInEditor&&"/"!==a[0]&&(a="/"+a);var b=this;l.createFromURL(a,this.nodeScope.noodlJavascriptAPI,function(a){b._internal.isWaitingForExternalFileToLoad=!1,b._onCodeParsed(a)})}}}},prototypeExtensions:{_onCodeParsed:function(a){if(this.context.editorConnection&&(this.context.editorConnection.clearWarnings(this.nodeScope.componentOwner.name,this.id),a.error&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"js-parse-waring",{message:a.error})),!a.error){var b=this;Object.keys(a.outputs).forEach(function(a){b.registerOutputIfNeeded(a)}),this._internal.setupFunction=a.setup,this._internal.runFunction=a.run,this._internal.setupFunction&&e.call(this),this._internal.runFunction&&f.call(this),this.flagDirty()}},update:function(){this._internal.isWaitingForExternalFileToLoad||k.prototype.update.call(this)},registerInputIfNeeded:function(a){this.hasInput(a)||(this._internal.inputValues[a]=void 0,this.registerInput(a,{set:h.bind(this,a)}))},registerOutputIfNeeded:function(a){if(!this.hasOutput(a)){var b=this;Object.defineProperty(this._internal.outputProperties,a,{set:function(c){b._internal.outputValues[a]=c,b._internal.dirtyOutputs[a]=!0,b.context.scheduleFrame()},get:function(){return b._internal.outputValues[a]}}),this.registerOutput(a,{getter:i.bind(this,a)})}},_callRunFunction:function(){var a=this._internal;if(a.runFunction)try{a.runFunction.call(a.userFunctionScope,a.inputValues,a.outputProperties)}catch(b){console.log("Error in JS node run code.",Object.getPrototypeOf(b).constructor.name+": "+b.message),this.context.editorConnection&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"js-run-waring",{message:"<strong>run</strong>: "+b.message})}},_callSetupFunction:function(){var a=this._internal;if(a.setupFunction)try{a.setupFunction.call(a.userFunctionScope,a.inputValues,a.outputProperties)}catch(b){console.log("Error in JS node setup code.",Object.getPrototypeOf(b).constructor.name+": "+b.message),this.context.editorConnection&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"js-setup-waring",{message:"<strong>setup</strong>: "+b.message})}}}})},{"../javascriptnodeparser":9,"../node":16,"../nodedefinition":18}],38:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=a("../easecurves");b.exports=d.defineNode({name:"Number Blend",category:"Interpolation",initialize:function(){var a=this._internal;a.inputs=[],a.blendValue=0,a.result=0,a.clamp=!1},prototypeExtensions:{updateResult:function(){var a=this._internal.inputs;if(0===a.length)return 0;var b=Math.floor(this._internal.blendValue),c=this._internal.blendValue-b;b>=a.length-1?this._internal.clamp?(b=a.length-1,c=0):(c+=b-(a.length-1),b=a.length-1):0>=b&&(this._internal.clamp?(b=0,c=0):(c+=b,b=0)),0===c||1===a.length?this._internal.result=a[b]:b===a.length-1&&c>0?this._internal.result=e.linear(a[b-1],a[b],c+1):this._internal.result=e.linear(a[b],a[b+1],c),this.flagOutputDirty("result")}},numberedInputs:{input:{name:"numbered/simple-number",displayPrefix:"Number",createSetter:function(a){var b=this._internal.inputs;return b[a]=0,function(c){b[a]!==c&&(b[a]=c,this.updateResult())}}}},inputs:{blendValue:{type:"number",displayName:"Blend Value","default":0,set:function(a){this._internal.blendValue=a,this.updateResult()}},clamp:{type:"boolean",displayName:"Clamp","default":!1,set:function(a){this._internal.clamp=a?!0:!1,this.updateResult()}}},outputs:{result:{type:"number",displayName:"Result",getter:function(){return this._internal.result}}}})},{"../easecurves":5,"../nodedefinition":18}],39:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Number Remapper",category:"Math",initialize:function(){var a=this._internal;a._currentInputValue=0,a._remappedValue=0,a._minInputValue=0,a._maxInputValue=0,a._minOutputValue=0,a._maxOutputValue=1,a._clampOutput=!0},inputs:{inputValue:{group:"Value to Remap",type:{name:"number",allowConnectionOnly:!0},"default":0,displayName:"Input Value",set:function(a){this._internal._currentInputValue=a,this._calculateNewOutputValue()}},minInputValue:{group:"Input Parameters",type:{name:"number"},"default":0,displayName:"Input Minimum",set:function(a){this._internal._minInputValue=a,this._calculateNewOutputValue()}},maxInputValue:{group:"Input Parameters",type:{name:"number"},"default":0,displayName:"Input Maximum",set:function(a){this._internal._maxInputValue=a,this._calculateNewOutputValue()}},minOutputValue:{group:"Output Parameters",type:{name:"number"},"default":0,displayName:"Output Minimum",set:function(a){this._internal._minOutputValue=a,this._calculateNewOutputValue()}},maxOutputValue:{group:"Output Parameters",type:{name:"number"},"default":1,displayName:"Output Maximum",set:function(a){this._internal._maxOutputValue=a,this._calculateNewOutputValue()}},clamp:{group:"Output Parameters",type:{name:"boolean",allowEditOnly:!0},"default":!0,displayName:"Clamp Output",set:function(a){this._internal._clampOutput=a?!0:!1,this._calculateNewOutputValue()}}},outputs:{remappedValue:{type:"number",displayName:"Remapped Value",group:"Outputs",getter:function(){return this._internal._remappedValue}}},prototypeExtensions:{_calculateNewOutputValue:{value:function(){var a,b=this._internal;a=b._maxInputValue===b._minInputValue?0:(b._currentInputValue-b._minInputValue)/(b._maxInputValue-b._minInputValue),b._clampOutput&&(a=Math.max(0,Math.min(1,a))),b._remappedValue=b._minOutputValue+a*(b._maxOutputValue-b._minOutputValue),this.flagOutputDirty("remappedValue")}}}})},{"../nodedefinition":18}],40:[function(a,b,c){"use strict";function d(a){return a?!0:!1}var e=a("../nodedefinition");b.exports=e.defineNode({name:"Or",category:"Logic",initialize:function(){this._internal.inputs=[]},numberedInputs:{input:{name:"numbered/simple-boolean",displayPrefix:"Input",createSetter:function(a){return function(b){this._internal.inputs[a]!==b&&(this._internal.inputs[a]=b,this.flagOutputDirty("result"))}}}},outputs:{result:{type:"boolean",displayName:"Result",getter:function(){return this._internal.inputs.some(d)}}}})},{"../nodedefinition":18}],41:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Reload",category:"Utilities",initialize:function(){this.context.addToManualUpdateQueue(this)},inputs:{reload:{displayName:"Reload",valueChangedToTrue:function(){this.context.reloadApplication()}}}})},{"../nodedefinition":18}],42:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=a("../torpedwrapper");b.exports=d.defineNode({name:"Render In Image",category:"Other",allowChildren:!0,initialize:function(){var a=e.instance.createControl();this._internal.children=[],this._internal.control=a,this.renderTarget=void 0},inputs:{width:{type:"number",displayName:"Width","default":0,set:function(a){this._internal.control.width=a,this.flagOutputDirty("image"),this._internal.renderTarget=void 0}},height:{type:"number",displayName:"Height","default":0,set:function(a){this._internal.control.height=a,this.flagOutputDirty("image"),this._internal.renderTarget=void 0}}},outputs:{image:{type:"image",displayName:"Image",getter:function(){return void 0===this._internal.renderTarget&&this.initRenderTarget(),this._internal.renderTarget}}},prototypeExtensions:{initRenderTarget:function(){var a=this._internal;0!==a.control.width&&0!==a.control.height&&(a.renderTarget=e.instance.createRenderTarget({rootControl:a.control}))},addChild:{value:function(a){if(!a._internal.control)throw new Error("child must have a control");this._internal.control.add(a._internal.control),this._internal.children.push(a)}},getChildRoot:{value:function(){return this}}}})},{"../nodedefinition":18,"../torpedwrapper":75}],43:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=a("../torpedwrapper");b.exports=d.defineNode({name:"Screen Resolution",category:"Utilities",initialize:function(){function a(){b.flagAllOutputsDirty()}var b=this;e.instance.addEventListener("virtualSizeChanged",a),this.context.eventEmitter.once("applicationDataReloaded",function(){e.instance.removeEventListener("virtualSizeChanged",a)})},outputs:{width:{type:"number",displayName:"Width",getter:function(){return e.instance.screenWidth}},height:{type:"number",displayName:"Height",getter:function(){return e.instance.screenHeight}},aspectRatio:{type:"number",displayName:"Aspect Ratio",getter:function(){return e.instance.screenWidth/e.instance.screenHeight}}}})},{"../nodedefinition":18,"../torpedwrapper":75}],44:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=a("../edgetriggeredinput");b.exports=d.defineNode({name:"Signal To Index",category:"Logic",initialize:function(){this._internal.currentIndex=0},numberedInputs:{input:{name:"numbered/simple-boolean",displayPrefix:"Signal",createSetter:function(a){return e.createSetter({valueChangedToTrue:this.onValueChangedToTrue.bind(this,a)})},selectors:{startIndex:{displayName:"Start Index",set:function(a){this._internal.currentIndex=a,this.flagOutputDirty("index")}}}}},outputs:{index:{displayName:"Index",type:"number",getter:function(){return this._internal.currentIndex}},signalTriggered:{displayName:"Signal Triggered",type:"signal"}},prototypeExtensions:{onValueChangedToTrue:function(a){this.sendSignalOnOutput("signalTriggered"),this._internal.currentIndex!==a&&(this._internal.currentIndex=a,this.flagOutputDirty("index"))}}})},{"../edgetriggeredinput":6,"../nodedefinition":18}],45:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"String Selector",category:"Utilities",initialize:function(){this._internal.inputs=[],this._internal.currentSelectedIndex=0,this._internal.indexChanged=!1},numberedInputs:{input:{name:"numbered/simple-string",displayPrefix:"Input",group:"Inputs",createSetter:function(a){return function(b){b=b.toString(),this._internal.inputs[a]=b,this._internal.currentSelectedIndex===a&&this.flagOutputDirty("currentValue")}}}},inputs:{index:{type:{name:"number"},displayName:"Index","default":0,set:function(a){a=0|a,this._internal.currentSelectedIndex=a,this.flagOutputDirty("currentValue"),this.sendSignalOnOutput("indexChanged")}}},outputs:{currentValue:{type:"string",displayName:"Current Value",group:"Value",getter:function(){return this._internal.inputs[this._internal.currentSelectedIndex]}},indexChanged:{type:"signal",displayName:"Index Changed",group:"Signals"}}})},{"../nodedefinition":18}],46:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Substring",category:"String Manipulation",initialize:function(){var a=this._internal;a.startIndex=0,a.endIndex=-1,a.cachedResult="",a.inputString="",a.resultDirty=!1},inputs:{start:{type:"number",displayName:"Start","default":0,set:function(a){this._internal.startIndex=a,this._internal.resultDirty=!0,this.flagOutputDirty("result")}},end:{type:"number",displayName:"End","default":0,set:function(a){this._internal.endIndex=a,this._internal.resultDirty=!0,this.flagOutputDirty("result")}},string:{type:{name:"string"},displayName:"String","default":"",set:function(a){a=a.toString(),this._internal.inputString=a,this._internal.resultDirty=!0,this.flagOutputDirty("result");
}}},outputs:{result:{type:"string",displayName:"Result",getter:function(){var a=this._internal;return a.resultDirty&&(-1===a.endIndex?a.cachedResult=a.inputString.substr(a.startIndex):a.cachedResult=a.inputString.substr(a.startIndex,a.endIndex-a.startIndex),a.resultDirty=!1),a.cachedResult}}}})},{"../nodedefinition":18}],47:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Switch",category:"Logic",initialize:function(){this._internal.state=!1,this._internal.initialized=!1},inputs:{on:{displayName:"On",group:"Change State",valueChangedToTrue:function(){this._internal.state!==!0&&(this._internal.state=!0,this.flagOutputDirty("state"),this.emitSignals())}},off:{displayName:"Off",group:"Change State",valueChangedToTrue:function(){this._internal.state!==!1&&(this._internal.state=!1,this.flagOutputDirty("state"),this.emitSignals())}},flip:{displayName:"Flip",group:"Change State",valueChangedToTrue:function(){this._internal.state=!this._internal.state,this.flagOutputDirty("state"),this.emitSignals()}},onFromStart:{type:"boolean",displayName:"Start State",group:"Start State","default":!1,set:function(a){a&&!this._internal.initialized&&(this._internal.state=!0,this.flagOutputDirty("state"),this._internal.initialized=!0,this.emitSignals())}}},outputs:{state:{type:"boolean",displayName:"Current State",getter:function(){return this._internal.state}},switchedToOn:{displayName:"Switched To On",type:"signal",group:"Signals"},switchedToOff:{displayName:"Switched To Off",type:"signal",group:"Signals"}},prototypeExtensions:{emitSignals:function(){this._internal.state===!0?this.sendSignalOnOutput("switchedToOn"):this.sendSignalOnOutput("switchedToOff")}}})},{"../nodedefinition":18}],48:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=a("../torpedwrapper");b.exports=d.defineNode({name:"Timer",category:"Utilities",initialize:function(){var a=this;this._internal._animation=e.instance.createTimer({duration:0,onStart:function(){a.sendSignalOnOutput("timerStarted")},onFinish:function(){a.sendSignalOnOutput("timerFinished")}})},inputs:{start:{displayName:"Start",valueChangedToTrue:function(){this._internal._animation._isRunning===!1&&this._internal._animation.start()}},restart:{displayName:"Restart",valueChangedToTrue:function(){this._internal._animation.start()}},duration:{type:"number",displayName:"Duration","default":0,set:function(a){this._internal._animation.duration=a}},startDelay:{type:"number",displayName:"Start Delay","default":0,set:function(a){this._internal._animation.delay=a}},stop:{displayName:"Stop",valueChangedToTrue:function(){this._internal._animation.stop()}}},outputs:{timerStarted:{type:"signal",displayName:"Started"},timerFinished:{type:"signal",displayName:"Finished"}}})},{"../nodedefinition":18,"../torpedwrapper":75}],49:[function(a,b,c){"use strict";function d(){var a=f.instance,b=a.touch.queuedTouchEvents;if(0!==a.touch.numTouchEvents){var c=b[a.touch.numTouchEvents-1];this._internal.x!==c.pos[0]&&(this._internal.x=c.pos[0],this.flagOutputDirty("x")),this._internal.y!==c.pos[1]&&(this._internal.y=c.pos[1],this.flagOutputDirty("y"))}}var e=a("../nodedefinition"),f=a("../torpedwrapper");b.exports=e.defineNode({name:"Touch Position",category:"Interaction",initialize:function(){this._internal.x=0,this._internal.y=0,this.context.eventEmitter.on("frameStart",d.bind(this))},outputs:{x:{type:"number",displayName:"Position X",getter:function(){return this._internal.x}},y:{type:"number",displayName:"Position Y",getter:function(){return this._internal.y}}}})},{"../nodedefinition":18,"../torpedwrapper":75}],50:[function(a,b,c){"use strict";function d(a){var b=this._internal._animation;b.stop(),b.startValue=a,this.scheduleAfterInputsHaveUpdated(function(){b.endValue!==a&&b.start()}),this._internal.currentNumber=a,this.flagOutputDirty("currentValue")}var e=a("../nodedefinition"),f=a("../torpedwrapper"),g=300,h={name:"Transition",category:"Animation",initialize:function(){var a=this,b=this._internal;b.currentNumber=0,b.numberInitialized=!1,b.animationStarted=!1,b.setCurrentNumberEnabled=!1,b.overrideValue=0,b._animation=f.instance.createTimer({duration:g,startValue:0,endValue:0,ease:f.instance.easeOut,onStart:function(){b.animationStarted=!0},onRunning:function(c){b.currentNumber=this.ease(this.startValue,this.endValue,c),a.flagOutputDirty("currentValue")},onFinish:function(){a.sendSignalOnOutput("atTargetValue")}})},inputs:{targetValue:{type:{name:"number"},displayName:"Value",group:"Target Value","default":void 0,set:function(a){if(a===!0)a=1;else if(a===!1)a=0;else if(isNaN(a))return;var b=this._internal;return b.numberInitialized===!1?(b.currentNumber=a,b.numberInitialized=!0,b._animation.endValue=a,void this.flagOutputDirty("currentValue")):void(a!==b._animation.endValue&&(b._animation.startValue=b.currentNumber,b._animation.endValue=a,b._animation.start()))}},"overrideCurrentValue.value":{type:{name:"number"},group:"Override Value",displayName:"Value",editorName:"Value|Override Value",set:function(a){this._internal.overrideValue=a}},"overrideCurrentValue.do":{group:"Override Value",displayName:"Do",editorName:"Do|Override Value",valueChangedToTrue:function(){d.call(this,this._internal.overrideValue)}},duration:{type:"number",group:"Parameters",displayName:"Duration","default":g,set:function(a){this._internal._animation.duration=a}},delay:{type:"number",group:"Parameters",displayName:"Delay","default":0,set:function(a){this._internal._animation.delay=a}},easingCurve:{type:{name:"enum",enums:[{value:"easeOut",label:"Ease Out"},{value:"easeIn",label:"Ease In"},{value:"linear",label:"Linear"},{value:"easeInOut",label:"Ease In Out"}]},"default":"easeOut",displayName:"Easing Curve",group:"Parameters",set:function(a){this._internal._animation.ease=f.instance[a]}}},outputs:{currentValue:{type:"number",displayName:"Current Value",group:"Current State",getter:function(){return this._internal.currentNumber}},atTargetValue:{type:"signal",displayName:"At Target Value",group:"Signals"}}};b.exports=e.defineNode(h)},{"../nodedefinition":18,"../torpedwrapper":75}],51:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Value Changed",category:"Logic",initialize:function(){this._internal.lastValue=void 0},inputs:{value:{type:"*",displayName:"Input",set:function(a){this._internal.lastValue!==a&&(this.sendSignalOnOutput("valueChanged"),this._internal.lastValue=a)}}},outputs:{valueChanged:{type:"signal",displayName:"Value Changed"}}})},{"../nodedefinition":18}],52:[function(a,b,c){"use strict";var d=a("./variablebase"),e=a("../../nodedefinition");b.exports=e.defineNode(d.createDefinition({name:"Boolean",startValue:!1,type:{name:"boolean"},cast:function(a){return Boolean(a)}}))},{"../../nodedefinition":18,"./variablebase":56}],53:[function(a,b,c){"use strict";var d=a("./variablebase"),e=a("../../nodedefinition");b.exports=e.defineNode(d.createDefinition({name:"Color",startValue:"#f1f2f4",type:{name:"color"},cast:function(a){return a}}))},{"../../nodedefinition":18,"./variablebase":56}],54:[function(a,b,c){"use strict";var d=a("./variablebase"),e=a("../../nodedefinition");b.exports=e.defineNode(d.createDefinition({name:"Number",startValue:0,type:{name:"number"},cast:function(a){return Number(a)}}))},{"../../nodedefinition":18,"./variablebase":56}],55:[function(a,b,c){"use strict";var d=a("./variablebase"),e=a("../../nodedefinition"),f=d.createDefinition({name:"String",startValue:"",type:{name:"string"},cast:function(a){return a.toString()}});e.extend(f,{outputs:{length:{type:"number",displayName:"Length",getter:function(){return this._internal.currentValue.length}}}}),b.exports=e.defineNode(f)},{"../../nodedefinition":18,"./variablebase":56}],56:[function(a,b,c){"use strict";function d(a){return{name:a.name,category:"Variables",initialize:function(){this._internal.currentValue=a.startValue,this._internal.latestValue=0},inputs:{value:{type:a.type,displayName:"Value","default":a.startValue,set:function(a){this.isInputConnected("saveValue")===!1?this.setValueTo(a):this._internal.latestValue=a}},saveValue:{displayName:"Save Value",valueChangedToTrue:function(){this.scheduleAfterInputsHaveUpdated(function(){this.setValueTo(this._internal.latestValue)})}}},outputs:{savedValue:{type:a.type.name,displayName:"Saved Value",getter:function(){return this._internal.currentValue}}},prototypeExtensions:{setValueTo:function(b){b=a.cast(b),this._internal.currentValue=b,this.flagAllOutputsDirty()}}}}b.exports={createDefinition:d}},{}],57:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Velocity",category:"Math",initialize:function(){var a=this._internal;a.oldValue=0,a.sampledAtTime=0,a.velocity=0},inputs:{value:{type:"number",displayName:"Value",set:function(a){var b=this._internal;if(0===b.sampledAtTime)return b.oldValue=a,void(b.sampledAtTime=this.context.currentFrameTime);if(this.context.currentFrameTime!==b.sampledAtTime){var c=this.context.currentFrameTime-b.sampledAtTime;b.velocity=(a-b.oldValue)/c,b.sampledAtTime=this.context.currentFrameTime,b.oldValue=a,this.flagOutputDirty("velocity")}}}},outputs:{velocity:{type:"number",displayName:"Velocity",getter:function(){return this._internal.velocity}}}})},{"../nodedefinition":18}],58:[function(a,b,c){"use strict";var d=a("./renderable"),e=a("../../nodedefinition"),f=a("../../torpedwrapper").instance,g="#f0f0f0",h=d.createDefinition({defaultSizeEnum:"explicit",defaultSizeUnit:"px",defaultWidth:200,defaultHeight:200,defaultColor:g,createControl:function(){return f.uiComponents.createCircle({size:200,color:g})}});delete h.inputs.height,h.inputs.width.displayName="Size",h.inputs.width.type.units=["px"];var i={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){var d=a._internal,e="%"===d.widthUnit?b*(d.width/100):d.width;return{width:e,height:e}}};e.extend(h,{name:"Circle",initialize:function(){this._internal.layout=i},inputs:{solid:{index:3004,type:"boolean",displayName:"Solid",group:"Appearance","default":!0,set:function(a){this._internal.control.solid=a}},lineWidth:{index:3005,type:"number",displayName:"Line Width",group:"Appearance","default":1,set:function(a){this._internal.control.lineWidth=a}},blur:{index:3006,displayName:"Blur Length",group:"Appearance",type:"number","default":2,set:function(a){this._internal.control.blur=a}},arcAngle:{index:3007,displayName:"Arc Angle",group:"Appearance",type:"number","default":360,set:function(a){this._internal.control.arcAngle=a*Math.PI/180}},image:{index:3500,displayName:"Image Path",group:"Image Properties",type:{name:"image"},set:function(a){"string"==typeof a&&(this.context.runningInEditor&&"/"!==a[0]&&(a="/"+a),f.preloadImage(a,!0)),this._internal.control.image=a}}}});var j=[{inputName:"cropStartX",index:0,"default":0,displayName:"Crop Start X"},{inputName:"cropEndX",index:2,"default":1,displayName:"Crop End X"},{inputName:"cropStartY",index:1,"default":0,displayName:"Crop Start Y"},{inputName:"cropEndY",index:3,"default":1,displayName:"Crop End Y"}],k={};j.forEach(function(a){var b=a.index;k[a.inputName]={index:3501+b,type:"number",group:"Image Properties",displayName:a.displayName,"default":a["default"],set:function(a){var c=this._internal.control;c._srcRect[b]!==a&&(c._srcRect[b]=a,c.contentDirty=!0)}}}),e.extend(h,j),b.exports=e.defineNode(h)},{"../../nodedefinition":18,"../../torpedwrapper":75,"./renderable":64}],59:[function(a,b,c){"use strict";var d=a("./layoutbase"),e=a("../../nodedefinition"),f=a("../../layout/flowlayout"),g=d.createDefinition({name:"Flow Layout",hasOrientation:!0,layout:f["static"]});e.extend(g,{initialize:function(){this._internal.verticalItemSpacing=0,this._internal.horizontalItemSpacing=0},inputs:{verticalItemSpacing:{index:2501,group:"Layout",displayName:"V. Spacing",type:"number","default":0,set:function(a){this._internal.verticalItemSpacing=Number(a),this.flagLayoutNeeded()}},horizontalItemSpacing:{index:2502,group:"Layout",displayName:"H. Spacing",type:"number","default":0,set:function(a){this._internal.horizontalItemSpacing=Number(a),this.flagLayoutNeeded()}}}}),b.exports=e.defineNode(g)},{"../../layout/flowlayout":11,"../../nodedefinition":18,"./layoutbase":62}],60:[function(a,b,c){"use strict";var d=a("./layoutbase"),e=a("../../nodedefinition"),f=a("../../layout/docklayout"),g=d.createDefinition({name:"Group",layout:f["static"],version:2});b.exports=e.defineNode(g)},{"../../layout/docklayout":10,"../../nodedefinition":18,"./layoutbase":62}],61:[function(a,b,c){"use strict";var d=a("./renderable"),e=(a("../../application"),a("../../torpedwrapper")),f=a("../../nodedefinition"),g=d.createDefinition({controlAttribute:"innerControl",sizeEnums:[{value:"explicit",label:"Explicit"},{value:"childWidth",label:"Content Width"},{value:"childHeight",label:"Content Height"},{value:"childSize",label:"Content Size"}],defaultSizeEnum:"childSize",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100,widthCondition:"sizeMode = explicit OR sizeMode = childHeight",heightCondition:"sizeMode = explicit OR sizeMode = childWidth",defaultColor:"#ffffff",createControl:function(){var a=e.instance,b=a.createControl({width:0,height:0,clip:!0}),c=a.uiComponents.createRectangle({align:"center",blur:0,cornerRadius:0});return b.add(c),c.noodlNode=this,this._internal.innerControl=c,b}}),h={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){var d=a._internal,e=0,f=0;return e="childSize"===d.sizeMode||"childWidth"===d.sizeMode?d.contentWidth:"%"===d.widthUnit?b*(d.width/100):d.width,f="childSize"===d.sizeMode||"childHeight"===d.sizeMode?d.contentHeight:"%"===d.heightUnit?c*(d.height/100):d.height,{width:e,height:f}}};f.extend(g,{name:"Image",version:2,initialize:function(){this._internal.layout=h,this._internal.contentWidth=0,this._internal.contentHeight=0},inputs:{image:{index:2500,type:{name:"image"},displayName:"Image Path",group:"Image Properties",set:function(a){var b=this;return a?("string"==typeof a&&0!==a.lastIndexOf("data:",0)&&0!==a.lastIndexOf("http:",0)&&0!==a.lastIndexOf("https:",0)&&(this.context.runningInEditor&&"/"!==a[0]&&(a="/"+a),e.instance.preloadImage(a,!0)),void this._internal.innerControl.setImage(a,function(a){b._internal.contentWidth=a[0],b._internal.contentHeight=a[1],b.flagLayoutNeeded()})):(this._internal.innerControl.resetImage(),this._internal.contentWidth=0,this._internal.contentHeight=0,void this.flagLayoutNeeded())}},cornerRadius:{index:3004,type:"number",displayName:"Corner Radius",group:"Appearance","default":0,set:function(a){this._internal.innerControl.cornerRadius=a}},fillMode:{index:2501,type:{name:"enum",enums:[{value:"original",label:"Original"},{value:"aspectFill",label:"Aspect Fill"},{value:"aspectFit",label:"Aspect Fit"},{value:"fill",label:"Fill"}],allowEditOnly:!0},displayName:"Fill Mode",group:"Image Properties","default":"original",set:function(a){var b=this._internal.innerControl;"original"===a?b.fill=null:"aspectFill"===a?b.fill="aspectFill":"aspectFit"===a?b.fill="aspectFit":"fill"===a&&(b.fill="parent")}},clipImage:{index:2502,type:"boolean",displayName:"Clip Image","default":!0,group:"Image Properties",set:function(a){this._internal.control.clip=a?!0:!1}}}});var i=[{inputName:"cropStartX",index:0,"default":0,displayName:"Crop Start X"},{inputName:"cropEndX",index:2,"default":1,displayName:"Crop End X"},{inputName:"cropStartY",index:1,"default":0,displayName:"Crop Start Y"},{inputName:"cropEndY",index:3,"default":1,displayName:"Crop End Y"}],j={};i.forEach(function(a){var b=a.index;j[a.inputName]={index:2503+b,type:"number",group:"Image Properties","default":a["default"],displayName:a.displayName,set:function(a){this._internal.innerControl._srcRect[b]=a,this._internal.innerControl.contentDirty=!0}}}),f.extend(g,j),b.exports=f.defineNode(g)},{"../../application":4,"../../nodedefinition":18,"../../torpedwrapper":75,"./renderable":64}],62:[function(a,b,c){"use strict";function d(a){if(!a.layout)throw new Error("No layout specified");var b=e.createDefinition({sizeEnums:[{value:"explicit",label:"Explicit"},{value:"childWidth",label:"Content Width"},{value:"childHeight",label:"Content Height"},{value:"childSize",label:"Content Size"}],defaultSizeEnum:"explicit",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100,createControl:function(){return f.createControl()}});return g.extend(b,{name:a.name,version:a.version,initialize:function(){var b=this._internal;b.componentChildrenIndex=void 0,b.children=[],b.padding={top:0,bottom:0,left:0,right:0},b.layout=a.layout},allowChildren:!0,inputs:{clip:{group:"Appearance",displayName:"Clip",type:"boolean",index:3100,"default":!1,set:function(a){this._internal.control.clip=a}},padding:{group:"Padding",displayName:"Padding",type:"number",index:2800,"default":0,set:function(a){var b=this._internal.padding;b.top=a,b.bottom=a,b.left=a,b.right=a,this.flagLayoutNeeded()}},paddingLeft:{group:"Padding",displayName:"Pad Left",type:"number",index:2801,set:function(a){this._internal.padding.left=a,this.flagLayoutNeeded()}},paddingRight:{group:"Padding",displayName:"Pad Right",type:"number",index:2802,set:function(a){this._internal.padding.right=a,this.flagLayoutNeeded()}},paddingTop:{group:"Padding",displayName:"Pad Top",type:"number",index:2803,set:function(a){this._internal.padding.top=a,this.flagLayoutNeeded()}},paddingBottom:{group:"Padding",displayName:"Pad Bottom",type:"number",index:2804,set:function(a){this._internal.padding.bottom=a,this.flagLayoutNeeded()}}},outputs:{childCount:{displayName:"Child Count",type:"number",getter:function(){return this._internal.children.length}}},prototypeExtensions:{addChild:{value:function(a,b){if(!a.getVisualRoot)throw new Error("child must have a visual root");var c=this._internal.control,d=this._internal.children;void 0===b&&(b=d.length),c.addAtIndex(b,a.getVisualRoot()._internal.control),b===d.length?d.push(a):d.splice(b,0,a),this.flagOutputDirty("childCount");for(var e=b;e<d.length;e++)d[e].getVisualRoot().flagOutputDirty("childIndex");a.getVisualRoot()._internal.parent=this,this.flagLayoutNeeded()}},removeChild:{value:function(a){if(!a.getVisualRoot)throw new Error("child must be a visual node");var b=this._internal.children,c=b.indexOf(a);if(-1===c)throw new Error("child is not a child of this node");var d=this._internal.control;d.remove(a.getVisualRoot()._internal.control),b.splice(c,1),this.flagOutputDirty("childCount");for(var e=c;e<b.length;e++)b[e].getVisualRoot().flagOutputDirty("childIndex");a._internal.parent=void 0,this.flagLayoutNeeded()}},getChildRoot:{value:function(){return this}},componentChildrenIndex:{set:function(a){this._internal.componentChildrenIndex=a},get:function(){return this._internal.componentChildrenIndex}}}}),a.hasOrientation&&g.extend(b,{initialize:function(){this._internal.orientation="vertical"},inputs:{orientation:{index:2500,group:"Layout",displayName:"Orientation",type:{name:"enum",enums:[{value:"horizontal",label:"Horizontal"},{value:"vertical",label:"Vertical"}]},"default":"vertical",set:function(a){this._internal.orientation=a,this.flagLayoutNeeded()}}}}),b}var e=a("./visualbase"),f=a("../../torpedwrapper").instance,g=a("../../nodedefinition");b.exports={createDefinition:d}},{"../../nodedefinition":18,"../../torpedwrapper":75,"./visualbase":68}],63:[function(a,b,c){"use strict";var d=a("./renderable"),e=a("../../torpedwrapper"),f=a("../../nodedefinition"),g="#f1f2f4",h=d.createDefinition({defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100,defaultColor:g,createControl:function(){return e.instance.uiComponents.createRectangle({color:g,cornerRadius:0,blur:0})}}),i={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){var d=a._internal;return{width:"%"===d.widthUnit?b*(d.width/100):d.width,height:"%"===d.heightUnit?c*(d.height/100):d.height}}};f.extend(h,{name:"Rectangle",initialize:function(){this._internal.layout=i},inputs:{cornerRadius:{index:3004,type:"number",displayName:"Corner Radius",group:"Appearance","default":0,set:function(a){this._internal.control.cornerRadius=a}},blur:{index:3005,type:"number",displayName:"Blur Length",group:"Appearance","default":0,set:function(a){this._internal.control.blur=a}}}}),b.exports=f.defineNode(h)},{"../../nodedefinition":18,"../../torpedwrapper":75,"./renderable":64}],64:[function(a,b,c){"use strict";function d(a){if(!a.defaultColor)throw new Error("No default color specified");var b=e.createDefinition(a),c=[{value:"alpha",label:"Alpha"},{value:"solid",label:"Solid"},{value:"additive",label:"Additive"},{value:"multiply",label:"Multiply"}],d={alpha:g.Renderer.BlendMode.Alpha,solid:g.Renderer.BlendMode.Solid,additive:g.Renderer.BlendMode.Additive,multiply:g.Renderer.BlendMode.Multiply},h=a.controlAttribute||"control";return f.extend(b,{inputs:{blendMode:{index:3003,type:{name:"enum",enums:c},"default":"alpha",displayName:"Blend Mode",group:"Appearance",set:function(a){this._internal[h].blendMode=d[a],this._internal[h].contentDirty=!0}},color:{index:3002,type:"color",displayName:"Color",group:"Appearance","default":a.defaultColor,set:function(a){this._internal[h].color=a}}}}),b}var e=a("./visualbase"),f=a("../../nodedefinition"),g=(a("../../application"),a("../../torpedwrapper"));b.exports={createDefinition:d}},{"../../application":4,"../../nodedefinition":18,"../../torpedwrapper":75,"./visualbase":68}],65:[function(a,b,c){"use strict";function d(a){var b=this.noodlNode,c=b._internal;if(c.scrollEnabled===!1||c.control.touchPropagation===!1)return c.isTracking&&(c.isTracking=!1,b.sendSignalOnOutput("dragEnded")),void(c.hasReceivedEnter=!1);var d,e=c.itemContainer,f=(c.axis,c.scroller);if(a.isEnter&&(c.hasReceivedEnter=!0),a.isExit)c.isTracking===!0?(b.sendSignalOnOutput("dragEnded"),c.isTracking=!1,b.context.scheduleAfterUpdate(function(){f.onTouch(e,a)})):f.onTouch(e,a),c.hasReceivedEnter=!1;else{if(c.hasReceivedEnter===!1){c.hasReceivedEnter=!0;var g={};for(var h in a)g[h]=a[h];g.type="isEnter",g.isEnter=!0,g.isDown=g.isUp=g.isMove=!1,f.onTouch(e,g)}d=f.onTouch(e,a),d===q.Touch.StartTracking&&c.isTracking===!1&&(c.isTracking=!0,b.sendSignalOnOutput("dragStarted"))}return d}function e(a){if(this._internal.children.length<=1)return 0;for(var b=0===this._internal.axis?"x":"y",c=0===this._internal.axis?"width":"height",d=this._internal.children,e=0,f=d.length;f>e;++e){var g=d[e].getVisualRoot()._internal;if(Math.floor(g.layoutRect[b]+g.layoutRect[c])-m.call(this)>a)return e}return console.error("Invalid position",a),-1}function f(a){var b=this._internal.children;if(0>a||a>=b.length)return console.error("ScrollView: Invalid item index",index),0;var c=0===this._internal.axis?"x":"y";return b[a].getVisualRoot()._internal.layoutRect[c]}function g(a){return a=q.Math.clamp(0,this._internal.children.length-1,a),f.call(this,a)-m.call(this)}function h(a){var b=this._internal;a!==b.currentIndex&&(b.currentIndex=a,this.flagOutputDirty("index"),this.sendSignalOnOutput("indexChanged"))}function i(a){this._internal.scrollOffset=a,this._internal.itemContainer[0===this._internal.axis?"x":"y"]=a,this.flagLayoutNeeded();var b=e.call(this,-a);h.call(this,b),this.flagOutputDirty("scrollPosition")}function j(){var a=this._internal,b=this;a.scroller=t.uiComponents.createKineticScroller({axis:a.axis,scrollEndedAnimationDuration:a.scrollDuration,bounceOnPositionEndedOverride:!1,scrollEndedPositionCallback:function(a,c){return b._internal.scrollEndedPositionCallback(a,c)},callback:function(a){i.call(b,a)}}),this.addTouchHandler(d,b),this.flagOutputDirty("scrollPosition");var c=this._internal.itemContainer;c[0===a.axis?"x":"y"]=a.scrollOffset}function k(a,b){var c=this;this.context.timerScheduler.createTimer({duration:b,startPosition:m.call(this),endPosition:-a,onRunning:function(a){i.call(c,t.easeOut(this.startPosition,this.endPosition,a))}}).start()}function l(a,b){return b}function m(){var a=0===this._internal.axis?"x":"y",b=this._internal.children;return b[0].getVisualRoot()._internal.layoutRect[a]}function n(a,b){var c=e.call(this,-m.call(this)),d=0;return d=0>a?c+1:c,d=q.Math.clamp(0,this._internal.children.length-1,d),-g.call(this,d)}function o(a,b){var c=0===this._internal.axis?"width":"height",d=this._internal.children;if(1===d.length)return 0>a?-d[0]._internal.layoutRect[c]:0;for(var e=0,f=0,g=0,h=Number.MAX_VALUE,i=0,j=0;j<d.length-1;++j){var k=d[j]._internal.layoutRect[c];g=e+k;var l=Math.abs(e+b),n=Math.abs(g+b);if(h>l&&(h=l,i=e),h>n&&(h=n,i=g),n>l){var o=m.call(this);return 0>a&&-e>o?-(e+k):a>0&&o>-e?-f:-e}f=e,e+=k}}var p=a("./layoutbase"),q=a("../../torpedwrapper"),r=a("../../nodedefinition"),s=a("../../layout/scrollviewlayout"),t=q.instance,u=500,v=p.createDefinition({name:"Scroll View",layout:s["static"],hasItemSpacing:!0});r.extend(v,{initialize:function(){var a=this._internal;a.axis=1,a.scrollEnabled=!0,a.itemContainer=t.createControl({width:0,height:0}),a.itemContainer.noodlNode=this,a.control.add(a.itemContainer),a.scrollOffset=0,a.itemSpacing=0,a.scroller=void 0,a.isTracking=!1,a.axis=1,a.orientation="vertical",a.currentIndex=0,a.hasReceivedEnter=!1,a.scrollToPositionValue=0,a.scrollDuration=u,a.scrollToPositionDuration=u,a.scrollToIndexDuration=u,a.scrollToIndexValue=0,a.scrollEndedPositionCallback=function(a,b){return b},a.contentLengthChanged=function(b){var c=a.axis?"height":"width";a.itemContainer[c]=b},this.context.addToManualUpdateQueue(this),this.scheduleAfterInputsHaveUpdated(j.bind(this))},inputs:{itemSpacing:{index:2400,group:"Layout",displayName:"Item Spacing",type:"number","default":0,set:function(a){this._internal.itemSpacing=Number(a),this.flagLayoutNeeded()}},clip:{index:3100,type:"boolean",group:"Appearance",displayName:"Clip","default":!1,set:function(a){this._internal.control.clip=a}},scrollDuration:{index:2500,type:"number",displayName:"Scroll Duration",group:"Scroll Behavior","default":u,set:function(a){this._internal.scrollDuration=a,this._internal.scroller&&(this._internal.scroller.scrollEndedAnimationDuration=a)}},snap:{index:2501,type:{name:"enum",enums:[{value:"disabled",label:"Disabled"},{value:"item",label:"Item"},{value:"everyItem",label:"Every Item"}]},displayName:"Snap",group:"Scroll Behavior","default":"disabled",set:function(a){"disabled"===a?this._internal.scrollEndedPositionCallback=l.bind(this):"everyItem"===a?this._internal.scrollEndedPositionCallback=n.bind(this):"item"===a?this._internal.scrollEndedPositionCallback=o.bind(this):console.error("Unknown snap value: "+a)}},scrollAxis:{index:2502,type:{name:"enum",enums:[{value:"0",label:"Horizontal"},{value:"1",label:"Vertical"}]},displayName:"Scroll Direction",group:"Scroll Behavior","default":"1",set:function(a){this._internal.axis=Number(a),this._internal.orientation=Number(a)?"vertical":"horizontal",this.flagLayoutNeeded()}},scrollStartPosition:{index:2503,type:"number",displayName:"Start Position",group:"Scroll Behavior","default":0,set:function(a){this._internal.scrollOffset=Number(a),this.flagLayoutNeeded()}},scrollEnabled:{index:2504,type:"boolean",displayName:"Scroll Enabled",group:"Scroll Behavior","default":!0,set:function(a){this._internal.scrollEnabled=a?!0:!1}},"scrollToPosition.value":{index:6e3,type:"number",displayName:"Position",editorName:"Position|Scroll To Position",group:"Scroll To Position","default":0,set:function(a){this._internal.scrollToPositionValue=a}},"scrollToPosition.do":{index:6001,group:"Scroll To Position",editorName:"Do|Scroll To Position",displayName:"Do",valueChangedToTrue:function(){this.scheduleAfterInputsHaveUpdated(function(){k.call(this,this._internal.scrollToPositionValue,this._internal.scrollToPositionDuration)})}},"scrollToPosition.duration":{index:6002,group:"Scroll To Position",displayName:"Duration",editorName:"Duration|Scroll To Position",type:"number","default":u,set:function(a){this._internal.scrollToPositionDuration=a}},"scrollToIndex.value":{index:6003,group:"Scroll To Index",editorName:"Index|Scroll To Index",displayName:"Index",type:"number","default":0,set:function(a){this._internal.scrollToIndexValue=Math.floor(a)}},"scrollToIndex.do":{index:6004,group:"Scroll To Index",editorName:"Do|Scroll To Index",displayName:"Do",valueChangedToTrue:function(){this.scheduleAfterInputsHaveUpdated(function(){var a=g.call(this,this._internal.scrollToIndexValue);k.call(this,a,this._internal.scrollToIndexDuration)})}},"scrollToIndex.duration":{index:6005,type:"number",group:"Scroll To Index",displayName:"Duration",editorName:"Duration|Scroll To Index","default":u,set:function(a){this._internal.scrollToIndexDuration=a}}},outputs:{dragStarted:{type:"signal",displayName:"Drag Started",group:"Signals"},dragEnded:{type:"signal",displayName:"Drag Ended",group:"Signals"},indexChanged:{displayName:"Index Changed",group:"Signals",type:"signal"},scrollPosition:{displayName:"Scroll Position",type:"number",getter:function(){return this._internal.scrollOffset}},index:{displayName:"Scroll Index",type:"number",getter:function(){return this._internal.currentIndex}},childCount:{displayName:"Child Count",type:"number",getter:function(){return this._internal.children.length}}}}),b.exports=r.defineNode(v)},{"../../layout/scrollviewlayout":13,"../../nodedefinition":18,"../../torpedwrapper":75,"./layoutbase":62}],66:[function(a,b,c){"use strict";var d=a("./layoutbase"),e=a("../../nodedefinition"),f=a("../../layout/stacklayout"),g=d.createDefinition({name:"Stack Layout",hasOrientation:!0,hasItemSpacing:!0,layout:f["static"]});e.extend(g,{initialize:function(){this._internal.itemSpacing=0},inputs:{itemSpacing:{index:2501,group:"Layout",displayName:"Item Spacing",type:"number","default":0,set:function(a){this._internal.itemSpacing=Number(a),this.flagLayoutNeeded()}}}}),b.exports=e.defineNode(g)},{"../../layout/stacklayout":14,"../../nodedefinition":18,"./layoutbase":62}],67:[function(a,b,c){"use strict";var d=a("./renderable"),e=a("../../nodedefinition"),f=a("../../torpedwrapper"),g=f.instance,h="Text",i=d.createDefinition({controlAttribute:"innerTextControl",createControl:function(){var a=g.createControl({width:0,height:0,clip:!0}),b=g.createTextControl({color:"#ffffff",text:h,font:{family:"Helvetica",size:40}});b.noodlNode=this,a.add(b);var c=this;return a.observe("width",function(a){"childWidth"!==c._internal.sizeMode&&"childSize"!==c._internal.sizeMode&&(b.maxWidth=a,b.text=null,b.text=c._internal.text,c._internal.contentWidth=b.width,c._internal.contentHeight=b.height,c.flagLayoutNeeded())}),a},defaultColor:"#ffffff",sizeEnums:[{value:"explicit",label:"Explicit"},{value:"childWidth",label:"Content Width"},{value:"childHeight",label:"Content Height"},{value:"childSize",label:"Content Size"}],defaultSizeEnum:"childSize",widthCondition:"sizeMode = explicit OR sizeMode = childHeight",heightCondition:"sizeMode = explicit OR sizeMode = childWidth",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100}),j={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){var d=a._internal,e=0,f=0;return e="childSize"===d.sizeMode||"childWidth"===d.sizeMode?d.contentWidth:"%"===d.widthUnit?b*(d.width/100):d.width,f="childSize"===d.sizeMode||"childHeight"===d.sizeMode?d.contentHeight:"%"===d.heightUnit?c*(d.height/100):d.height,{width:e,height:f}}};e.extend(i,{name:"Text",version:2,initialize:function(){var a=this._internal;a.layout=j,a.text=h,a.innerTextControl=a.control.firstChild,a.contentWidth=a.innerTextControl.width,a.contentHeight=a.innerTextControl.height},inputs:{text:{index:2500,group:"Text",displayName:"Text",type:{name:"string",multiline:!0},"default":h,set:function(a){this._internal.setTextHaxTimeout&&(window.clearTimeout(this._internal.setTextHaxTimeout),this._internal.setTextHaxTimeout=void 0);var b=this._internal.innerTextControl;this._internal.text=a,b.text=a,this._internal.contentWidth=b.width,this._internal.contentHeight=b.height,this.flagLayoutNeeded()}},fontFamily:{index:2501,type:"font",group:"Text",displayName:"Font Family","default":"Helvetica",set:function(a){var b=a.replace(/\.[^\/.]+$/,"");b=b.split("/").pop();
var c=this._internal,d=this;this.context.callWhenFontIsActive(b,function(){var a=c.innerTextControl,e=c.text;a._font={family:b,size:a._font.size},a.text=null,a.text=e,c.contentWidth=a.width,c.contentHeight=a.height,d.flagLayoutNeeded()})}},fontSize:{index:2502,type:"number",group:"Text",displayName:"Font Size","default":40,set:function(a){var b=this._internal.innerTextControl;b._font={family:b._font.family,size:a},b.text=null,b.text=this._internal.text,this._internal.contentWidth=b.width,this._internal.contentHeight=b.height,this.flagLayoutNeeded()}},lineHeight:{index:2503,type:"number",displayName:"Line Height",group:"Text","default":0,set:function(a){var b=this._internal.innerTextControl;b._font.lineHeight=a,b.text=null,b.text=this._internal.text,this.flagLayoutNeeded()}},alignment:{index:2504,type:{name:"enum",enums:[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}],allowEditOnly:!0},displayName:"Horizontal",group:"Text Alignment","default":"left",set:function(a){var b=this._internal.innerTextControl;"left"===a?b.alignment=f.TextControl.Alignment.Left:"center"===a?b.alignment=f.TextControl.Alignment.Center:"right"===a&&(b.alignment=f.TextControl.Alignment.Right),b.alignX=a}},verticalAlignment:{index:2505,type:{name:"enum",enums:[{value:"top",label:"Top"},{value:"center",label:"Center"},{value:"bottom",label:"Bottom"}],allowEditOnly:!0},displayName:"Vertical",group:"Text Alignment","default":"top",set:function(a){var b=this._internal.innerTextControl;b.alignY=a}},color:{index:3002,type:"color",displayName:"Color",group:"Appearance","default":"#ffffff",set:function(a){this._internal.innerTextControl.color=a}},clipText:{index:2999,type:"boolean",displayName:"Clip Text","default":!0,group:"Appearance",set:function(a){this._internal.control.clip=a?!0:!1}}}}),b.exports=e.defineNode(i)},{"../../nodedefinition":18,"../../torpedwrapper":75,"./renderable":64}],68:[function(a,b,c){"use strict";function d(a){if(a=a||{},!a.createControl)throw new Error("createControl can't be undefined");a.sizeEnums=a.sizeEnums||[],a.defaultSizeEnum=a.defaultSizeEnum||"",a.defaultSizeUnit=a.defaultSizeUnit||"px",a.defaultPivotUnit=a.defaultPivotUnit||"%",a.defaultWidth=a.hasOwnProperty("defaultWidth")?a.defaultWidth:0,a.defaultHeight=a.hasOwnProperty("defaultHeight")?a.defaultHeight:0,a.widthCondition=a.widthCondition||"sizeMode = explicit OR sizeMode = childHeight OR sizeMode NOT SET",a.heightCondition=a.heightCondition||"sizeMode = explicit OR sizeMode = childWidth OR sizeMode NOT SET";var b={category:"Visual",initialize:function(){var b=this._internal,c=a.createControl.call(this);c.onTouch=g,c.noodlNode=this,b.control=c,b.touchHandlers=[],b.parent=void 0,b.sizeMode=a.defaultSizeEnum,b.pivotUnitType=[],b.pivotFactors=[.5,.5],b.positionX=0,b.positionY=0,b.alignX="left",b.alignY="top",b.width=a.defaultWidth,b.height=a.defaultHeight,b.widthUnit=a.defaultSizeUnit,b.heightUnit=a.defaultSizeUnit,b.pivotObserverIds=[{},{}],j.call(this,0,a.defaultPivotUnit),j.call(this,1,a.defaultPivotUnit),b.layoutRect=new n(b),this._internal.tapHandler=k.instance.uiComponents.createTapHandler(e),this.addTouchHandler(i,this);var d=this;b.layoutRectWidthChanged=function(){d.flagOutputDirty("width")},b.layoutRectHeightChanged=function(){d.flagOutputDirty("height")}},inputs:{x:{type:{name:"number"},group:"Placement",index:2002,displayName:"Position X","default":0,set:function(a){this._internal.positionX=a,this.flagOutputDirty("x"),this.flagLayoutNeeded()}},y:{type:{name:"number"},index:2003,group:"Placement",displayName:"Position Y","default":0,set:function(a){this._internal.positionY=a,this.flagOutputDirty("y"),this.flagLayoutNeeded()}},z:{type:{name:"number"},index:2004,group:"Placement",displayName:"Position Z","default":0,set:function(a){this._internal.control.z=a}},alignX:{index:2e3,type:{name:"enum",enums:[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}]},group:"Placement",displayName:"Align X","default":"left",set:function(a){this._internal.alignX=a,this.flagLayoutNeeded()}},alignY:{index:2001,type:{name:"enum",enums:[{value:"top",label:"Top"},{value:"center",label:"Center"},{value:"bottom",label:"Bottom"}]},group:"Placement",displayName:"Align Y","default":"top",set:function(a){this._internal.alignY=a,this.flagLayoutNeeded()}},width:{index:1001,type:{name:"number",units:["%","px"],defaultUnit:a.defaultSizeUnit},displayName:"Width",group:"Dimensions","default":a.defaultWidth,set:function(a,b){this._internal.width=a,b&&(this._internal.widthUnit=b),this.flagLayoutNeeded()}},height:{index:1002,type:{name:"number",units:["%","px"],defaultUnit:a.defaultSizeUnit},displayName:"Height",group:"Dimensions","default":a.defaultHeight,set:function(a,b){this._internal.height=a,b&&(this._internal.heightUnit=b),this.flagLayoutNeeded()}},opacity:{index:3e3,group:"Appearance",displayName:"Opacity",type:"number","default":1,set:function(a){this._internal.control.opacity=a}},visible:{type:{name:"boolean"},index:3001,displayName:"Visible",group:"Appearance","default":!0,set:function(a){this._internal.control.visible=a?!0:!1}},scaleX:{index:5e3,type:"number",group:"Transform",displayName:"Scale X","default":1,set:function(a){this._internal.control.scaleX=a}},scaleY:{index:5001,type:"number",group:"Transform",displayName:"Scale Y","default":1,set:function(a){this._internal.control.scaleY=a}},rotationX:{index:5002,type:"number",group:"Transform",displayName:"Rotation X","default":0,set:function(a){this._internal.control.rx=Math.PI/180*a}},rotationY:{index:5003,type:"number",group:"Transform",displayName:"Rotation Y","default":0,set:function(a){this._internal.control.ry=Math.PI/180*a}},rotationZ:{index:5004,type:"number",group:"Transform",displayName:"Rotation Z","default":0,set:function(a){this._internal.control.rz=Math.PI/180*a}},pivotX:{index:5005,type:{name:"number",units:["%","px"],defaultUnit:a.defaultPivotUnit},"default":50,group:"Transform",displayName:"Pivot X",set:function(a,b){b&&(this._internal.pivotUnitType[0]=b),"px"===this._internal.pivotUnitType[0]?this._internal.control.pivotX=a:(this._internal.pivotFactors[0]=.01*a,this._internal.control.pivotX=this._internal.layoutRect.width*this._internal.pivotFactors[0])}},pivotY:{index:5006,type:{name:"number",units:["%","px"],defaultUnit:a.defaultPivotUnit},"default":50,group:"Transform",displayName:"Pivot Y",set:function(a,b){b&&(this._internal.pivotUnitType[1]=b),"px"===this._internal.pivotUnitType[1]?this._internal.control.pivotY=a:(this._internal.pivotFactors[1]=.01*a,this._internal.control.pivotY=this._internal.layoutRect.height*this._internal.pivotFactors[1])}},pivotZ:{index:5007,type:"number",group:"Transform",displayName:"Pivot Z","default":0,set:function(a){this._internal.control.pivotZ=a}},touchPropagation:{index:4e3,type:{name:"boolean"},displayName:"Ignore Touch","default":!1,set:function(a){this._internal.control.touchPropagation=a?!1:!0}},blockTouch:{index:4001,type:{name:"boolean"},displayName:"Block Touch","default":!1,set:function(a){this._internal.control.blockTouch=a?!0:!1}},depth:{index:4002,type:{name:"number"},displayName:"Depth","default":0,set:function(a){a===!0?a=1:a===!1&&(a=0),this._internal.control.depth=a}}},lazyRegisteredOutputs:o,outputs:{"this":{type:"reference",displayName:"This",getter:function(){return this}},childIndex:{type:"number",displayName:"Child Index",getter:function(){var a=this._internal.control.parent;return a?a.indexOf(this._internal.control):-1}},width:{displayName:"Width",group:"Dimensions",type:"number",getter:function(){return this._internal.layoutRect.width}},height:{displayName:"Height",group:"Dimensions",type:"number",getter:function(){return this._internal.layoutRect.height}},x:{displayName:"Position X",group:"Placement",type:"number",getter:function(){return this._internal.positionX}},y:{displayName:"Position Y",group:"Placement",type:"number",getter:function(){return this._internal.positionY}}},prototypeExtensions:{addTouchHandler:function(a,b){this._internal.touchHandlers.push({callback:a,id:b})},getVisualRoot:function(){return this},flagDirty:function(){this._dirty||(this.context.nodeIsDirty(this),m.prototype.flagDirty.call(this))},registerOutputIfNeeded:function(a){function b(a,b){var d=0;c.registerOutput(a,{getter:function(){return d}});var e=b.torpedName;c._internal.control.observe(e,function(b){d!==b&&(d=b,c.flagOutputDirty(a))})}if(!this.hasOutput(a)&&o.hasOwnProperty(a)!==!1){var c=this;b(a,o[a])}},flagLayoutNeeded:function(){this.context.layouter.setNeedsRelayout(this),this.context.scheduleFrame()}}};return a.sizeEnums.length>0&&f(b,a),h(b),b}function e(a){var b=a.noodlNode;b.sendSignalOnOutput("touch.tap")}function f(a,b){var c={index:1001,name:"width",plug:"input",type:{name:"number",units:["%","px"],defaultUnit:b.defaultSizeUnit},displayName:"Width",group:"Dimensions","default":b.defaultWidth},d={index:1002,name:"height",plug:"input",type:{name:"number",units:["%","px"],defaultUnit:b.defaultSizeUnit},displayName:"Height",group:"Dimensions","default":b.defaultHeight},e={name:"conditionalports/basic",condition:b.widthCondition,ports:[c]},f={name:"conditionalports/basic",condition:b.heightCondition,ports:[d]},g=[e,f];l(a,{dynamicports:g,inputs:{sizeMode:{index:1e3,type:{name:"enum",enums:b.sizeEnums,allowEditOnly:!0},group:"Dimensions",displayName:"Size Mode","default":b.defaultSizeEnum,set:function(a){this._internal.sizeMode=a,this.flagLayoutNeeded()}}}})}function g(a){var b=void 0,c=this.noodlNode,d=this;return c._internal.touchHandlers.forEach(function(c){var e=c.callback.call(d,a);void 0!==e&&(e===k.Touch.StartTracking?b=e:e===k.Touch.StopPropagation&&b!==k.Touch.StartTracking&&(b=e))}),b}function h(a){l(a,{initialize:function(){this._internal.hasSignaledMove=!1,this.context.nodeIsDirty(this)},outputs:{"touch.tap":{group:"Touch",displayName:"Tap",type:"signal"},"touch.press":{type:"signal",group:"Touch",displayName:"Press"},"touch.release":{type:"signal",group:"Touch",displayName:"Release"},"touch.enter":{type:"signal",group:"Touch",displayName:"Enter"},"touch.exit":{type:"signal",group:"Touch",displayName:"Exit"},"touch.move":{type:"signal",group:"Touch",displayName:"Move"}}})}function i(a){var b=this.noodlNode;return a.isDown&&(b.sendSignalOnOutput("touch.press"),b._internal.hasSignaledMove=!1),a.isMove?b._internal.hasSignaledMove===!1&&(b._internal.hasSignaledMove=!0,b.sendSignalOnOutput("touch.move")):a.isUp?b.sendSignalOnOutput("touch.release"):a.isEnter?b.sendSignalOnOutput("touch.enter"):a.isExit&&b.sendSignalOnOutput("touch.exit"),b.getOutput("touch.tap").hasConnections()?b._internal.tapHandler.onTouch(this,a):void 0}function j(a,b){var c=this._internal,d=c.control;if(c.pivotUnitType[a]!==b)if(c.pivotUnitType[a]=b,"%"===b){var e="pivot"+(0===a?"X":"Y");d.observe(0===a?"width":"height",function(b){this[e]=b*c.pivotFactors[a]},c.pivotObserverIds[a])}else d.removeObserverById(c.pivotObserverIds[a])}var k=a("../../torpedwrapper"),l=a("../../nodedefinition").extend,m=a("../../node"),n=function(a){this.internal=a,this._x=this._y=this._width=this._height=void 0};Object.defineProperties(n.prototype,{x:{set:function(a){this._x!==a&&(this._x=a,this.internal.control.x=a,this.internal.layoutRectXChanged&&this.internal.layoutRectXChanged(a))},get:function(){return this._x}},y:{set:function(a){this._y!==a&&(this._y=a,this.internal.control.y=a,this.internal.layoutRectYChanged&&this.internal.layoutRectYChanged(a))},get:function(){return this._y}},width:{set:function(a){this._width!==a&&(this._width=a,this.internal.control.width=a,this.internal.layoutRectWidthChanged&&this.internal.layoutRectWidthChanged(a))},get:function(){return this._width}},height:{set:function(a){this._height!==a&&(this._height=a,this.internal.control.height=a,this.internal.layoutRectHeightChanged&&this.internal.layoutRectHeightChanged(a))},get:function(){return this._height}}});var o={screenX:{torpedName:"worldX",displayName:"Screen Position X",group:"Position",type:"number"},screenY:{torpedName:"worldY",displayName:"Screen Position Y",group:"Position",type:"number"}};b.exports={createDefinition:d}},{"../../node":16,"../../nodedefinition":18,"../../torpedwrapper":75}],69:[function(a,b,c){"use strict";function d(a){function b(){console.log("websocket disconnected",a),delete i[a]}if(!i[a]){var c=new WebSocket(a);c.addEventListener("open",function(){console.log("websocket connected",a)}),c.addEventListener("close",b),c.addEventListener("error",b),i[a]=c}return i[a]}function e(a){function b(){e._close(),window.setTimeout(e.connect.bind(e,e.uri),1e3)}function c(){e.eventEmitter.emit("connected"),e.context.eventEmitter.once("applicationDataReloaded",function(){e._close(),e.eventEmitter.removeAllListeners()}),e.socket.addEventListener("message",e._onMessage)}function d(a){var b=JSON.parse(a.data);e.eventEmitter.emit("jsonMessage",b),e.context.update()}this.eventEmitter=new h,this.eventEmitter.setMaxListeners(1e3),this.context=a;var e=this;this._reconnect=b,this._onConnectionOpen=c,this._onMessage=d}function f(a,b){if(a){var c={};for(var d in b)isNaN(Number(b[d]))?c[d]=b[d]:c[d]=Number(b[d]);a.send(JSON.stringify(c))}}var g=a("../nodedefinition"),h=a("events").EventEmitter,i={};e.prototype._close=function(){this.socket&&(this.eventEmitter.emit("disconnected"),this.socket.removeEventListener("close",this.reconnect),this.socket.removeEventListener("error",this.reconnect),this.socket.removeEventListener("open",this._onConnectionOpen),this.socket.removeEventListener("message",this._onMessage),this.socket=void 0)},e.prototype.connect=function(a){this._close(),this.uri=a,this.socket=d(a),this.socket.addEventListener("close",this._reconnect),this.socket.addEventListener("error",this._reconnect),this.socket.readyState===WebSocket.OPEN?this._onConnectionOpen():this.socket.addEventListener("open",this._onConnectionOpen)},e.prototype.addEventListener=function(a,b){this.eventEmitter.on(a,b)},e.prototype.send=function(a){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(a)},b.exports=g.defineNode({name:"Websocket",category:"Communication",initialize:function(){var a=this._internal;a.socket=new e(this.context),a.socket.addEventListener("connected",this.onConnected.bind(this)),a.socket.addEventListener("disconnected",this.onDisconnected.bind(this)),a.socket.addEventListener("jsonMessage",this.onMessageReceived.bind(this)),a.address=void 0,a.connected=!1,a.inputValues={},a.outputValues={},a.outputNames=[],this.context.addToManualUpdateQueue(this)},panels:[{name:"PortEditor",context:["select","connectFrom"],title:"Outputs",plug:"output",type:{name:"*",group:"Output data"}},{name:"PortEditor",context:["select","connectTo"],title:"Data To Send",plug:"input",group:"Data To Send",type:{name:"string"}}],inputs:{address:{group:"Settings",displayName:"Ip Address:Port",type:{name:"string"},set:function(a){this._internal.address=a;var b="ws://"+a+"/";this._internal.socket.connect(b)}},sendData:{group:"Send Data",displayName:"Send Data",valueChangedToTrue:function(){var a=this;this.scheduleAfterInputsHaveUpdated(function(){a._internal.inputValues._nodeId=a.id,f(a._internal.socket,a._internal.inputValues)})}}},outputs:{newDataReceived:{displayName:"New Data Received",type:"signal"},connected:{displayName:"Connected",type:"boolean",getter:function(){return this._internal.connected}}},prototypeExtensions:{registerOutputIfNeeded:function(a){if(!this.hasOutput(a)){this._internal.outputValues[a]=void 0;var b=this;this.registerOutput(a,{getter:function(){return b._internal.outputValues[a]}})}},registerInputIfNeeded:function(a){if(!this.hasInput(a)){var b=this;this.registerInput(a,{set:function(c){b._internal.inputValues[a]=c}})}},onMessageReceived:function(a){if(!a._nodeIds||-1!==a._nodeIds.indexOf(this.id)){var b=!1;for(var c in a)this.hasOutput(c)&&(this._internal.outputValues[c]=a[c],this.flagOutputDirty(c),b=!0);b&&this.sendSignalOnOutput("newDataReceived")}},onConnected:function(){this._internal.connected!==!0&&(this._internal.connected=!0,this.flagOutputDirty("connected"))},onDisconnected:function(){this._internal.connected!==!1&&(this._internal.connected=!1,this.flagOutputDirty("connected"))}}})},{"../nodedefinition":18,events:3}],70:[function(a,b,c){"use strict";function d(a,b){this.context=a,this.nodes={},this.componentOwner=b,this.noodlJavascriptAPI=f(this)}function e(a,b){b.forEach(function(b){if(!a[b])throw new Error("Missing "+b)})}var f=a("./noodl-js-api");d.prototype.addConnection=function(a){try{e(a,["sourceId","sourcePort","targetId","targetPort"])}catch(b){throw new Error("Error in connection: "+b.message)}try{var c=this.getNode(a.sourceId),d=this.getNode(a.targetId);d.registerInputIfNeeded(a.targetPort),c.registerOutputIfNeeded(a.sourcePort),d.connectInput(a.targetPort,c,a.sourcePort)}catch(b){console.error(b.message)}},d.prototype.setNodeParameters=function(a,b){b.expression&&a.setInputValue("expression",b.expression);var c=Object.keys(b).filter(function(a){return"expression"!==a});c.forEach(function(c){function d(){var d=b[c];"object"==typeof d?a.setInputValue(c,d.value,d.unit):a.setInputValue(c,d)}a.registerInputIfNeeded(c),a.hasInput(c)!==!1&&(window.chrome&&navigator&&"Win32"===navigator.platform&&"text"===c?a._internal.setTextHaxTimeout=window.setTimeout(d,200):d())})},d.prototype.addNodeRecursive=function(a,b,c){var d;try{d=this.createNode(a.type,a.id)}catch(e){return void console.error(e.message,e.stack)}a.parameters&&(a.parameters.expression&&d.setInputValue("expression",a.parameters.expression),b.push({node:d,parameters:a.parameters}));var f=this;return a.children&&a.children.forEach(function(a,e){if("Component Children"===a.type)return f.componentOwner._internal.childRoot=d,void(d._internal.componentChildrenIndex=e);var g=f.addNodeRecursive(a,b,c);if(void 0!==g){if(!d.addChild)throw new Error("Node "+d.id+" of type "+d.constructor.name+" can't have children");if(!g.getVisualRoot)throw new Error("Node "+g.id+" of type "+d.constructor.name+" can't be a child");c.push({parent:d,child:g})}}),d},d.prototype.getNode=function(a){if(this.nodes.hasOwnProperty(a)===!1)throw new Error("Unknown node id "+a);return this.nodes[a]},d.prototype.createNode=function(a,b){if(this.nodes.hasOwnProperty(b))throw Error("duplicate id "+b);var c;return this.context.hasComponentDefinitionWithName(a)?c=this.createComponentInstanceNode(a):(c=this.context.nodeRegister.createNode(a),c.nodeScope=this),this.nodes[b]=c,c.id=b,c},d.prototype.findNodesWithIdRecursive=function(b){function c(a,b,e){a.nodes.hasOwnProperty(b)&&e.push(a.nodes[b]);var f=Object.keys(a.nodes).filter(function(b){return a.nodes[b]instanceof d});f.forEach(function(d){c(a.nodes[d].nodeScope,b,e)})}var d=a("./nodes/componentinstance"),e=[];return c(this,b,e),e},d.prototype.findNodesWithNameRecursive=function(b){function c(a,b,e){for(var f in a.nodes)a.nodes[f].name===b&&e.push(a.nodes[f]);var g=Object.keys(a.nodes).filter(function(b){return a.nodes[b]instanceof d});g.forEach(function(d){c(a.nodes[d].nodeScope,b,e)})}var d=a("./nodes/componentinstance"),e=[];return c(this,b,e),e},d.prototype.findNodesWithName=function(a){var b=this,c=Object.keys(this.nodes).filter(function(c){return b.nodes[c].name===a});return c.map(function(a){return b.nodes[a]})},d.prototype.createComponentInstanceNode=function(a){var b=this.context.createComponentInstanceNode(a);return b},d.prototype.addData=function(a){if(a.nodes){var b=this,c=[],d=[];a.nodes.forEach(function(a){b.addNodeRecursive(a,c,d)}),c.forEach(function(a){b.setNodeParameters(a.node,a.parameters)}),a.connections&&a.connections.forEach(function(a){b.addConnection(a)}),d.forEach(function(a){a.parent.addChild(a.child)})}},b.exports=d},{"./nodes/componentinstance":25,"./noodl-js-api":71}],71:[function(a,b,c){"use strict";function d(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function e(a){function b(b){b&&b.length>0&&"/"!==b[0]&&(b="/"+b);var c=a.createNode(b,d());return c}function c(a,b){e.scheduleAfterUpdate(function(){e.setGlobalValue(a,b)})}var e=a.context,f={on:function(a,b){var c=e.eventSenderEmitter;c.on(a,b),e.eventEmitter.once("applicationDataReloaded",function(){c.removeListener(a,b)})},once:function(a,b){e.eventSenderEmitter.once(a,b)},off:function(a,b){e.eventSenderEmitter.removeListener(a,b)},emit:function(a,b){e.eventSenderEmitter.emit(a,b)}};return{createComponent:b,setGlobalValue:c,eventEmitter:f}}b.exports=e},{}],72:[function(a,b,c){"use strict";function d(a){if(!a.owner)throw new Error("Owner must be set");this.getter=a.getter,this.connections=[],this.owner=a.owner,this.name=a.name,this._id=void 0}Object.defineProperties(d.prototype,{value:{get:function(){return this.getter.call(this.owner)}},id:{get:function(){return this._id||(this._id=this.owner.id+this.name),this._id}},registerConnection:{value:function(a,b){this.connections.push({node:a,inputPortName:b})}},flagDependeesDirty:{value:function(a){for(var b=0,c=this.connections.length;c>b;b++)this.connections[b].node.flagDirty()}},sendValue:{value:function(a){for(var b=0,c=this.connections.length;c>b;b++){var d=this.connections[b];d.node.queueInput(d.inputPortName,a)}}},hasConnections:{value:function(){return this.connections.length>0}}}),b.exports=d},{}],73:[function(a,b,c){"use strict";function d(a,b,c){if(!c[a]){if(!g[a])throw new Error("Unknown patch key "+a);var d={nodePatches:[],dismissPatches:[]};for(var e in g[a])d[e]=g[a][e];c[a]=d}c[a].nodePatches.push(b)}function e(a,b){var c=[],e=[h,i,j,k,l];e.forEach(function(b){b.condition(a)&&c.push(b.generatePatch(a))}),c.forEach(function(a){d(a.key,a.patch,b)})}function f(a,b){e(a,b),a.children&&a.children.forEach(function(a){f(a,b)})}var g={LayoutNotSupported:{message:"Group with layout is no longer supported. These have been replaced with the new nodes Stack Layout and Flow Layout",notifyUser:!0,askPermission:!1,key:"LayoutNotSupported"},ImageDefaultUnitChanged:{notifyUser:!1,askPermission:!1,key:"ImageDefaultUnitChanged",message:""},TextMaxLineWidthReplaced:{notifyUser:!0,askPermission:!1,key:"TextMaxLineWidthReplaced",message:"Text max line width is no longer supported. Replaced with size mode content height and explicit width set in pixels"},RemoveValue:{notifyUser:!1,askPermission:!1,key:"RemoveValue",message:""}},h={condition:function(a){return void 0===a.version&&"Group"===a.type&&"none"===a.parameters.layout},generatePatch:function(a){return{key:"RemoveValue",version:2,patch:{nodeId:a.id,params:{layout:null}}}}},i={condition:function(a){return void 0===a.version&&"Group"===a.type&&a.parameters.hasOwnProperty("layout")&&"none"!==a.parameters.layout},generatePatch:function(a){var b,c;if("stackHorizontal"===a.parameters.layout)b="Stack Layout",c="horizontal";else if("stackVertical"===a.parameters.layout)b="Stack Layout",c="vertical";else if("flowHorizontal"===a.parameters.layout)b="Flow Layout",c="horizontal";else{if("flowVertical"!==a.parameters.layout)return void console.error("Can't convert layout",a);b="Flow Layout",c="vertical"}return{key:"LayoutNotSupported",patch:{nodeId:a.id,version:2,typename:b,params:{layout:null,orientation:c}}}}},j={condition:function(a){return void 0!==a.version||"Image"!==a.type?!1:"explicit"!==a.parameters.sizeMode&&"childHeight"!==a.parameters.sizeMode?!1:a.parameters.hasOwnProperty("width")&&"object"==typeof a.parameters.width?!1:!0},generatePatch:function(a){var b=0;return a.parameters.width&&(b=a.parameters.width.value?a.parameters.width.value:a.parameters.width),{key:"ImageDefaultUnitChanged",patch:{nodeId:a.id,version:2,params:{width:{value:b,unit:"px"}}}}}},k={condition:function(a){return void 0!==a.version||"Image"!==a.type?!1:"explicit"!==a.parameters.sizeMode&&"childWidth"!==a.parameters.sizeMode?!1:a.parameters.hasOwnProperty("height")&&"object"==typeof a.parameters.height?!1:!0},generatePatch:function(a){var b=0;return a.parameters.height&&(b=a.parameters.height.value?a.parameters.height.value:a.parameters.height),{key:"ImageDefaultUnitChanged",patch:{nodeId:a.id,version:2,params:{height:{value:b,unit:"px"}}}}}},l={condition:function(a){return void 0===a.version&&"Text"===a.type&&a.parameters.hasOwnProperty("maxWidth")},generatePatch:function(a){return{key:"TextMaxLineWidthReplaced",patch:{nodeId:a.id,version:2,params:{maxWidth:null,sizeMode:"childHeight",width:{value:a.parameters.maxWidth,unit:"px"}}}}}};b.exports={collectPatches:function(a){var b={};return a.components.forEach(function(a){a.nodes.forEach(function(a){f(a,b)})}),b}}},{}],74:[function(a,b,c){"use strict";function d(a,b){this.duration=b.duration||0,this._isRunning=!1,this._hasCalledOnStart=!1,this.scheduler=a,this.repeatCount=1,this.delay=0;for(var c in b)this[c]=b[c]}function e(a){this.requestFrame=a,this.runningTimers=[],this.newTimers=[]}d.prototype.start=function(){return this._isRunning&&this.stop(),this.scheduler.scheduleTimer(this),this},d.prototype.stop=function(){this.scheduler.stopTimer(this),this._hasCalledOnStart=!1,this._isRunning=!1,this._wasStopped=!0},e.prototype.createTimer=function(a){return new d(this,a)},e.prototype.scheduleTimer=function(a){-1===this.newTimers.indexOf(a)&&(0===a.repeatCount&&(a.repeatCount=1e5),this.newTimers.push(a),this.requestFrame())},e.prototype.stopTimer=function(a){var b;a._isRunning?(b=this.runningTimers.indexOf(a),-1!==b&&this.runningTimers.splice(b,1),a.onStop&&!a._wasStopped&&a.onStop()):(b=this.newTimers.indexOf(a),-1!==b&&this.newTimers.splice(b,1))},e.prototype.runTimers=function(a){var b,c,d=[],e=[],f=[],g=this.runningTimers.length;for(b=0;g>b;++b)f[b]=this.runningTimers[b];for(b=0;g>b;++b)if(c=f[b],c&&a>=c._start){c._hasCalledOnStart===!1&&c.onStart&&(c.onStart(),c._hasCalledOnStart=!0);var h;h=c.duration>0?(a-c._start)/(c.duration*c.repeatCount):1;var i=h*c.repeatCount-Math.floor(h*c.repeatCount);h>=1&&(i=1),c.onRunning&&c.onRunning(i),1>h&&c._isRunning?d.push(c):c._wasStopped||e.push(c)}else d.push(c);for(this.runningTimers=d,b=0;b<e.length;++b)e[b]._isRunning=!1,e[b]._hasCalledOnStart=!1,e[b].onFinish&&e[b].onFinish();if(this.newTimers.length>0){for(b=0;b<this.newTimers.length;++b)c=this.newTimers[b],c._start=a+c.delay,c._isRunning=!0,c._wasStopped=!1,this.runningTimers.push(c),0===c.delay&&(c.onStart&&(c.onStart(),c._hasCalledOnStart=!0),c.onRunning&&c.onRunning(0));this.newTimers.length=0}},e.prototype.hasPendingTimers=function(){return this.runningTimers.length>0||this.newTimers.length>0},b.exports=e},{}],75:[function(a,b,c){"use strict";b.exports=Torped},{}]},{},[4])(4)});